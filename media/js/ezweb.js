if(!Object.prototype.toJSONString){Array.prototype.toJSONString=function(C){var B=[],E,A=this.length,D;for(E=0;E<A;E+=1){D=this[E];switch(typeof D){case"object":if(D&&typeof D.toJSONString==="function"){B.push(D.toJSONString(C))}else{B.push("null")}break;case"string":case"number":case"boolean":B.push(D.toJSONString());break;default:B.push("null")}}return"["+B.join(",")+"]"};Boolean.prototype.toJSONString=function(){return String(this)};Date.prototype.toJSONString=function(){function A(B){return B<10?"0"+B:B}return'"'+this.getUTCFullYear()+"-"+A(this.getUTCMonth()+1)+"-"+A(this.getUTCDate())+"T"+A(this.getUTCHours())+":"+A(this.getUTCMinutes())+":"+A(this.getUTCSeconds())+'Z"'};Number.prototype.toJSONString=function(){return isFinite(this)?String(this):"null"};Object.prototype.toJSONString=function(B){var A=[],D,E,C;if(B){for(E=0;E<B.length;E+=1){D=B[E];if(typeof D==="string"){C=this[D];switch(typeof C){case"object":if(C){if(typeof C.toJSONString==="function"){A.push(D.toJSONString()+":"+C.toJSONString(B))}}else{A.push(D.toJSONString()+":null")}break;case"string":case"number":case"boolean":A.push(D.toJSONString()+":"+C.toJSONString())}}}}else{for(D in this){if(typeof D==="string"&&Object.prototype.hasOwnProperty.apply(this,[D])){C=this[D];switch(typeof C){case"object":if(C){if(typeof C.toJSONString==="function"){A.push(D.toJSONString()+":"+C.toJSONString())}}else{A.push(D.toJSONString()+":null")}break;case"string":case"number":case"boolean":A.push(D.toJSONString()+":"+C.toJSONString())}}}}return"{"+A.join(",")+"}"};(function(s){var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};s.parseJSON=function(filter){var j;function walk(k,v){var i;if(v&&typeof v==="object"){for(i in v){if(Object.prototype.hasOwnProperty.apply(v,[i])){v[i]=walk(i,v[i])}}}return filter(k,v)}if(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/.test(this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""))){j=eval("("+this+")");return typeof filter==="function"?walk("",j):j}throw new SyntaxError("parseJSON")};s.toJSONString=function(){if(/["\\\x00-\x1f]/.test(this)){return'"'+this.replace(/[\x00-\x1f\\"]/g,function(a){var c=m[a];if(c){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+this+'"'}})(String.prototype)}var WiringFactory=function(){var A=null;function B(){B.prototype.addInstance=function(D,C){};B.prototype.removeInstance=function(C){};B.prototype.createChannel=function(C){};B.prototype.removeChannel=function(C){};B.prototype.viewValue=function(C){};B.prototype.sendEvent=function(D,C,E){};B.prototype.addChannelInput=function(E,D,C){};B.prototype.addChannelInput=function(D,C){};B.prototype.addChannelOutput=function(E,D,C){};B.prototype.addChannelOutput=function(D,C){};B.prototype.removeChannelInput=function(E,D,C){};B.prototype.removeChannelInput=function(D,C){};B.prototype.removeChannelOutput=function(E,D,C){};B.prototype.removeChannelOutput=function(D,C){}}return new function(){this.getInstance=function(){if(A==null){A=new B();A.constructor=null}return A}}}();var VarManagerFactory=function(){var A=null;function B(){B.prototype.writeSlot=function(D,C,E){};B.prototype.registerVariable=function(C,D){};B.prototype.getVariable=function(C,D){};B.prototype.setVariable=function(C,E,D){}}return new function(){this.getInstance=function(){if(A==null){A=new B();A.constructor=null}return A}}}();var PersitenceEngineFactory=function(){var A=null;function B(){B.prototype.send_get=function(C,D,E){};B.prototype.send_post=function(C,E,D,F){};B.prototype.send_delete=function(C,D,E){};B.prototype.send_update=function(C,E,D,F){}}return new function(){this.getInstance=function(){if(A==null){A=new B();A.constructor=null}return A}}}();var OpManagerFactory=function(){var A=null;function B(){B.prototype.addInstance=function(C){};B.prototype.removeInstance=function(C){}}return new function(){this.getInstance=function(){if(A==null){A=new B();A.constructor=null}return A}}}();var ShowcaseFactory=function(){var A=null;function B(){B.prototype.addGadget=function(C){};B.prototype.deleteGadget=function(C){};B.prototype.updateGadget=function(C,D){};B.prototype.tagGadget=function(C,D){};B.prototype.addInstance=function(C){};B.prototype.repaint=function(){}}return new function(){this.getInstance=function(){if(A==null){A=new B();A.constructor=null}return A}}}();var DragboardFactory=function(){var B=null;function A(){A.prototype.addInstance=function(C){};A.prototype.getUserProperty=function(C){};A.prototype.setUserProperty=function(C,D){};A.prototype.moveInstance=function(D,C){};A.prototype.repaint=function(){}}return new function(){this.getInstance=function(){if(B==null){B=new A();B.constructor=null}return B}}}();var Scriptaculous={Version:"1.7.1_beta3",require:function(A){document.write('<script type="text/javascript" src="'+A+'"><\/script>')},REQUIRED_PROTOTYPE:"1.5.1",load:function(){function A(B){var C=B.split(".");return parseInt(C[0])*100000+parseInt(C[1])*1000+parseInt(C[2])}if((typeof Prototype=="undefined")||(typeof Element=="undefined")||(typeof Element.Methods=="undefined")||(A(Prototype.Version)<A(Scriptaculous.REQUIRED_PROTOTYPE))){throw ("script.aculo.us requires the Prototype JavaScript framework >= "+Scriptaculous.REQUIRED_PROTOTYPE)}$A(document.getElementsByTagName("script")).findAll(function(B){return(B.src&&B.src.match(/scriptaculous\.js(\?.*)?$/))}).each(function(C){var D=C.src.replace(/scriptaculous\.js(\?.*)?$/,"");var B=C.src.match(/\?.*load=([a-z,]*)/);(B?B[1]:"builder,effects,dragdrop,controls,slider").split(",").each(function(E){Scriptaculous.require(D+E+".js")})})}};Scriptaculous.load();Sound={tracks:{},_enabled:true,template:new Template('<embed style="height:0" id="sound_#{track}_#{id}" src="#{url}" loop="false" autostart="true" hidden="true"/>'),enable:function(){Sound._enabled=true},disable:function(){Sound._enabled=false},play:function(B){if(!Sound._enabled){return }var A=Object.extend({track:"global",url:B,replace:false},arguments[1]||{});if(A.replace&&this.tracks[A.track]){$R(0,this.tracks[A.track].id).each(function(E){var D=$("sound_"+A.track+"_"+E);D.Stop&&D.Stop();D.remove()});this.tracks[A.track]=null}if(!this.tracks[A.track]){this.tracks[A.track]={id:0}}else{this.tracks[A.track].id++}A.id=this.tracks[A.track].id;if(Prototype.Browser.IE){var C=document.createElement("bgsound");C.setAttribute("id","sound_"+A.track+"_"+A.id);C.setAttribute("src",A.url);C.setAttribute("loop","1");C.setAttribute("autostart","true");$$("body")[0].appendChild(C)}else{new Insertion.Bottom($$("body")[0],Sound.template.evaluate(A))}}};if(Prototype.Browser.Gecko&&navigator.userAgent.indexOf("Win")>0){if(navigator.plugins&&$A(navigator.plugins).detect(function(A){return A.name.indexOf("QuickTime")!=-1})){Sound.template=new Template('<object id="sound_#{track}_#{id}" width="0" height="0" type="audio/mpeg" data="#{url}"/>')}else{Sound.play=function(){}}}var Builder={NODEMAP:{AREA:"map",CAPTION:"table",COL:"table",COLGROUP:"table",LEGEND:"fieldset",OPTGROUP:"select",OPTION:"select",PARAM:"object",TBODY:"table",TD:"table",TFOOT:"table",TH:"table",THEAD:"table",TR:"table"},node:function(A){A=A.toUpperCase();var F=this.NODEMAP[A]||"div";var B=document.createElement(F);try{B.innerHTML="<"+A+"></"+A+">"}catch(E){}var D=B.firstChild||null;if(D&&(D.tagName.toUpperCase()!=A)){D=D.getElementsByTagName(A)[0]}if(!D){D=document.createElement(A)}if(!D){return }if(arguments[1]){if(this._isStringOrNumber(arguments[1])||(arguments[1] instanceof Array)||arguments[1].tagName){this._children(D,arguments[1])}else{var C=this._attributes(arguments[1]);if(C.length){try{B.innerHTML="<"+A+" "+C+"></"+A+">"}catch(E){}D=B.firstChild||null;if(!D){D=document.createElement(A);for(attr in arguments[1]){D[attr=="class"?"className":attr]=arguments[1][attr]}}if(D.tagName.toUpperCase()!=A){D=B.getElementsByTagName(A)[0]}}}}if(arguments[2]){this._children(D,arguments[2])}return D},_text:function(A){return document.createTextNode(A)},ATTR_MAP:{className:"class",htmlFor:"for"},_attributes:function(A){var B=[];for(attribute in A){B.push((attribute in this.ATTR_MAP?this.ATTR_MAP[attribute]:attribute)+'="'+A[attribute].toString().escapeHTML().gsub(/"/,"&quot;")+'"')}return B.join(" ")},_children:function(B,A){if(A.tagName){B.appendChild(A);return }if(typeof A=="object"){A.flatten().each(function(C){if(typeof C=="object"){B.appendChild(C)}else{if(Builder._isStringOrNumber(C)){B.appendChild(Builder._text(C))}}})}else{if(Builder._isStringOrNumber(A)){B.appendChild(Builder._text(A))}}},_isStringOrNumber:function(A){return(typeof A=="string"||typeof A=="number")},build:function(B){var A=this.node("div");$(A).update(B.strip());return A.down()},dump:function(B){if(typeof B!="object"&&typeof B!="function"){B=window}var A=("A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR").split(/\s+/);A.each(function(C){B[C]=function(){return Builder.node.apply(Builder,[C].concat($A(arguments)))}})}};if(typeof Effect=="undefined"){throw ("controls.js requires including script.aculo.us' effects.js library")}var Autocompleter={};Autocompleter.Base=function(){};Autocompleter.Base.prototype={baseInitialize:function(B,C,A){B=$(B);this.element=B;this.update=$(C);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;if(this.setOptions){this.setOptions(A)}else{this.options=A||{}}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(D,E){if(!E.style.position||E.style.position=="absolute"){E.style.position="absolute";Position.clone(D,E,{setHeight:false,offsetTop:D.offsetHeight})}Effect.Appear(E,{duration:0.15})};this.options.onHide=this.options.onHide||function(D,E){new Effect.Fade(E,{duration:0.15})};if(typeof (this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens)}this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keypress",this.onKeyPress.bindAsEventListener(this));Event.observe(window,"beforeunload",function(){B.setAttribute("autocomplete","on")})},show:function(){if(Element.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update)}if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,"position")=="absolute")){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix")}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),50)}},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:(!this.update.style.height)});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update)}if(this.iefix){Element.hide(this.iefix)}},startIndicator:function(){if(this.options.indicator){Element.show(this.options.indicator)}},stopIndicator:function(){if(this.options.indicator){Element.hide(this.options.indicator)}},onKeyPress:function(A){if(this.active){switch(A.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(A);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(A);return ;case Event.KEY_LEFT:case Event.KEY_RIGHT:return ;case Event.KEY_UP:this.markPrevious();this.render();if(Prototype.Browser.WebKit){Event.stop(A)}return ;case Event.KEY_DOWN:this.markNext();this.render();if(Prototype.Browser.WebKit){Event.stop(A)}return }}else{if(A.keyCode==Event.KEY_TAB||A.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&A.keyCode==0)){return }}this.changed=true;this.hasFocus=true;if(this.observer){clearTimeout(this.observer)}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(B){var A=Event.findElement(B,"LI");if(this.index!=A.autocompleteIndex){this.index=A.autocompleteIndex;this.render()}Event.stop(B)},onClick:function(B){var A=Event.findElement(B,"LI");this.index=A.autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(A){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false},render:function(){if(this.entryCount>0){for(var A=0;A<this.entryCount;A++){this.index==A?Element.addClassName(this.getEntry(A),"selected"):Element.removeClassName(this.getEntry(A),"selected")}if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0){this.index--}else{this.index=this.entryCount-1}this.getEntry(this.index).scrollIntoView(true)},markNext:function(){if(this.index<this.entryCount-1){this.index++}else{this.index=0}this.getEntry(this.index).scrollIntoView(false)},getEntry:function(A){return this.update.firstChild.childNodes[A]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry())},updateElement:function(F){if(this.options.updateElement){this.options.updateElement(F);return }var C="";if(this.options.select){var A=document.getElementsByClassName(this.options.select,F)||[];if(A.length>0){C=Element.collectTextNodes(A[0],this.options.select)}}else{C=Element.collectTextNodesIgnoreClass(F,"informal")}var E=this.findLastToken();if(E!=-1){var D=this.element.value.substr(0,E+1);var B=this.element.value.substr(E+1).match(/^\s+/);if(B){D+=B[0]}this.element.value=D+C}else{this.element.value=C}this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,F)}},updateChoices:function(C){if(!this.changed&&this.hasFocus){this.update.innerHTML=C;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var A=0;A<this.entryCount;A++){var B=this.getEntry(A);B.autocompleteIndex=A;this.addObservers(B)}}else{this.entryCount=0}this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}},addObservers:function(A){Event.observe(A,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(A,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices()}else{this.active=false;this.hide()}},getToken:function(){var B=this.findLastToken();if(B!=-1){var A=this.element.value.substr(B+1).replace(/^\s+/,"").replace(/\s+$/,"")}else{var A=this.element.value}return/\n/.test(A)?"":A},findLastToken:function(){var C=-1;for(var B=0;B<this.options.tokens.length;B++){var A=this.element.value.lastIndexOf(this.options.tokens[B]);if(A>C){C=A}}return C}};Ajax.Autocompleter=Class.create();Object.extend(Object.extend(Ajax.Autocompleter.prototype,Autocompleter.Base.prototype),{initialize:function(C,D,B,A){this.baseInitialize(C,D,A);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=B},getUpdatedChoices:function(){this.startIndicator();var A=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,A):A;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(A){this.updateChoices(A.responseText)}});Autocompleter.Local=Class.create();Autocompleter.Local.prototype=Object.extend(new Autocompleter.Base(),{initialize:function(B,D,C,A){this.baseInitialize(B,D,A);this.options.array=C},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(A){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(B){var D=[];var C=[];var H=B.getToken();var G=0;for(var E=0;E<B.options.array.length&&D.length<B.options.choices;E++){var F=B.options.array[E];var I=B.options.ignoreCase?F.toLowerCase().indexOf(H.toLowerCase()):F.indexOf(H);while(I!=-1){if(I==0&&F.length!=H.length){D.push("<li><strong>"+F.substr(0,H.length)+"</strong>"+F.substr(H.length)+"</li>");break}else{if(H.length>=B.options.partialChars&&B.options.partialSearch&&I!=-1){if(B.options.fullSearch||/\s/.test(F.substr(I-1,1))){C.push("<li>"+F.substr(0,I)+"<strong>"+F.substr(I,H.length)+"</strong>"+F.substr(I+H.length)+"</li>");break}}}I=B.options.ignoreCase?F.toLowerCase().indexOf(H.toLowerCase(),I+1):F.indexOf(H,I+1)}}if(C.length){D=D.concat(C.slice(0,B.options.choices-D.length))}return"<ul>"+D.join("")+"</ul>"}},A||{})}});Field.scrollFreeActivate=function(A){setTimeout(function(){Field.activate(A)},1)};Ajax.InPlaceEditor=Class.create();Ajax.InPlaceEditor.defaultHighlightColor="#FFFF99";Ajax.InPlaceEditor.prototype={initialize:function(C,B,A){this.url=B;this.element=$(C);this.options=Object.extend({paramName:"value",okButton:true,okLink:false,okText:"ok",cancelButton:false,cancelLink:true,cancelText:"cancel",textBeforeControls:"",textBetweenControls:"",textAfterControls:"",savingText:"Saving...",clickToEditText:"Click to edit",okText:"ok",rows:1,onComplete:function(E,D){new Effect.Highlight(D,{startcolor:this.options.highlightcolor})},onFailure:function(D){alert("Error communicating with the server: "+D.responseText.stripTags())},callback:function(D){return Form.serialize(D)},handleLineBreaks:true,loadingText:"Loading...",savingClassName:"inplaceeditor-saving",loadingClassName:"inplaceeditor-loading",formClassName:"inplaceeditor-form",highlightcolor:Ajax.InPlaceEditor.defaultHighlightColor,highlightendcolor:"#FFFFFF",externalControl:null,submitOnBlur:false,ajaxOptions:{},evalScripts:false},A||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId)){this.options.formId=null}}if(this.options.externalControl){this.options.externalControl=$(this.options.externalControl)}this.originalBackground=Element.getStyle(this.element,"background-color");if(!this.originalBackground){this.originalBackground="transparent"}this.element.title=this.options.clickToEditText;this.onclickListener=this.enterEditMode.bindAsEventListener(this);this.mouseoverListener=this.enterHover.bindAsEventListener(this);this.mouseoutListener=this.leaveHover.bindAsEventListener(this);Event.observe(this.element,"click",this.onclickListener);Event.observe(this.element,"mouseover",this.mouseoverListener);Event.observe(this.element,"mouseout",this.mouseoutListener);if(this.options.externalControl){Event.observe(this.options.externalControl,"click",this.onclickListener);Event.observe(this.options.externalControl,"mouseover",this.mouseoverListener);Event.observe(this.options.externalControl,"mouseout",this.mouseoutListener)}},enterEditMode:function(A){if(this.saving){return }if(this.editing){return }this.editing=true;this.onEnterEditMode();if(this.options.externalControl){Element.hide(this.options.externalControl)}Element.hide(this.element);this.createForm();this.element.parentNode.insertBefore(this.form,this.element);if(!this.options.loadTextURL){Field.scrollFreeActivate(this.editField)}if(A){Event.stop(A)}return false},createForm:function(){this.form=document.createElement("form");this.form.id=this.options.formId;Element.addClassName(this.form,this.options.formClassName);this.form.onsubmit=this.onSubmit.bind(this);this.createEditField();if(this.options.textarea){var B=document.createElement("br");this.form.appendChild(B)}if(this.options.textBeforeControls){this.form.appendChild(document.createTextNode(this.options.textBeforeControls))}if(this.options.okButton){var E=document.createElement("input");E.type="submit";E.value=this.options.okText;E.className="editor_ok_button";this.form.appendChild(E)}if(this.options.okLink){var C=document.createElement("a");C.href="#";C.appendChild(document.createTextNode(this.options.okText));C.onclick=this.onSubmit.bind(this);C.className="editor_ok_link";this.form.appendChild(C)}if(this.options.textBetweenControls&&(this.options.okLink||this.options.okButton)&&(this.options.cancelLink||this.options.cancelButton)){this.form.appendChild(document.createTextNode(this.options.textBetweenControls))}if(this.options.cancelButton){var D=document.createElement("input");D.type="submit";D.value=this.options.cancelText;D.onclick=this.onclickCancel.bind(this);D.className="editor_cancel_button";this.form.appendChild(D)}if(this.options.cancelLink){var A=document.createElement("a");A.href="#";A.appendChild(document.createTextNode(this.options.cancelText));A.onclick=this.onclickCancel.bind(this);A.className="editor_cancel editor_cancel_link";this.form.appendChild(A)}if(this.options.textAfterControls){this.form.appendChild(document.createTextNode(this.options.textAfterControls))}},hasHTMLLineBreaks:function(A){if(!this.options.handleLineBreaks){return false}return A.match(/<br/i)||A.match(/<p>/i)},convertHTMLLineBreaks:function(A){return A.replace(/<br>/gi,"\n").replace(/<br\/>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<p>/gi,"")},createEditField:function(){var E;if(this.options.loadTextURL){E=this.options.loadingText}else{E=this.getText()}var C=this;if(this.options.rows==1&&!this.hasHTMLLineBreaks(E)){this.options.textarea=false;var A=document.createElement("input");A.obj=this;A.type="text";A.name=this.options.paramName;A.value=E;A.style.backgroundColor=this.options.highlightcolor;A.className="editor_field";var B=this.options.size||this.options.cols||0;if(B!=0){A.size=B}if(this.options.submitOnBlur){A.onblur=this.onSubmit.bind(this)}this.editField=A}else{this.options.textarea=true;var D=document.createElement("textarea");D.obj=this;D.name=this.options.paramName;D.value=this.convertHTMLLineBreaks(E);D.rows=this.options.rows;D.cols=this.options.cols||40;D.className="editor_field";if(this.options.submitOnBlur){D.onblur=this.onSubmit.bind(this)}this.editField=D}if(this.options.loadTextURL){this.loadExternalText()}this.form.appendChild(this.editField)},getText:function(){return this.element.innerHTML},loadExternalText:function(){Element.addClassName(this.form,this.options.loadingClassName);this.editField.disabled=true;new Ajax.Request(this.options.loadTextURL,Object.extend({asynchronous:true,onComplete:this.onLoadedExternalText.bind(this)},this.options.ajaxOptions))},onLoadedExternalText:function(A){Element.removeClassName(this.form,this.options.loadingClassName);this.editField.disabled=false;this.editField.value=A.responseText.stripTags();Field.scrollFreeActivate(this.editField)},onclickCancel:function(){this.onComplete();this.leaveEditMode();return false},onFailure:function(A){this.options.onFailure(A);if(this.oldInnerHTML){this.element.innerHTML=this.oldInnerHTML;this.oldInnerHTML=null}return false},onSubmit:function(){var A=this.form;var B=this.editField.value;this.onLoading();if(this.options.evalScripts){new Ajax.Request(this.url,Object.extend({parameters:this.options.callback(A,B),onComplete:this.onComplete.bind(this),onFailure:this.onFailure.bind(this),asynchronous:true,evalScripts:true},this.options.ajaxOptions))}else{new Ajax.Updater({success:this.element,failure:null},this.url,Object.extend({parameters:this.options.callback(A,B),onComplete:this.onComplete.bind(this),onFailure:this.onFailure.bind(this)},this.options.ajaxOptions))}if(arguments.length>1){Event.stop(arguments[0])}return false},onLoading:function(){this.saving=true;this.removeForm();this.leaveHover();this.showSaving()},showSaving:function(){this.oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;Element.addClassName(this.element,this.options.savingClassName);this.element.style.backgroundColor=this.originalBackground;Element.show(this.element)},removeForm:function(){if(this.form){if(this.form.parentNode){Element.remove(this.form)}this.form=null}},enterHover:function(){if(this.saving){return }this.element.style.backgroundColor=this.options.highlightcolor;if(this.effect){this.effect.cancel()}Element.addClassName(this.element,this.options.hoverClassName)},leaveHover:function(){if(this.options.backgroundColor){this.element.style.backgroundColor=this.oldBackground}Element.removeClassName(this.element,this.options.hoverClassName);if(this.saving){return }this.effect=new Effect.Highlight(this.element,{startcolor:this.options.highlightcolor,endcolor:this.options.highlightendcolor,restorecolor:this.originalBackground})},leaveEditMode:function(){Element.removeClassName(this.element,this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this.originalBackground;Element.show(this.element);if(this.options.externalControl){Element.show(this.options.externalControl)}this.editing=false;this.saving=false;this.oldInnerHTML=null;this.onLeaveEditMode()},onComplete:function(A){this.leaveEditMode();this.options.onComplete.bind(this)(A,this.element)},onEnterEditMode:function(){},onLeaveEditMode:function(){},dispose:function(){if(this.oldInnerHTML){this.element.innerHTML=this.oldInnerHTML}this.leaveEditMode();Event.stopObserving(this.element,"click",this.onclickListener);Event.stopObserving(this.element,"mouseover",this.mouseoverListener);Event.stopObserving(this.element,"mouseout",this.mouseoutListener);if(this.options.externalControl){Event.stopObserving(this.options.externalControl,"click",this.onclickListener);Event.stopObserving(this.options.externalControl,"mouseover",this.mouseoverListener);Event.stopObserving(this.options.externalControl,"mouseout",this.mouseoutListener)}}};Ajax.InPlaceCollectionEditor=Class.create();Object.extend(Ajax.InPlaceCollectionEditor.prototype,Ajax.InPlaceEditor.prototype);Object.extend(Ajax.InPlaceCollectionEditor.prototype,{createEditField:function(){if(!this.cached_selectTag){var A=document.createElement("select");var C=this.options.collection||[];var B;C.each(function(E,D){B=document.createElement("option");B.value=(E instanceof Array)?E[0]:E;if((typeof this.options.value=="undefined")&&((E instanceof Array)?this.element.innerHTML==E[1]:E==B.value)){B.selected=true}if(this.options.value==B.value){B.selected=true}B.appendChild(document.createTextNode((E instanceof Array)?E[1]:E));A.appendChild(B)}.bind(this));this.cached_selectTag=A}this.editField=this.cached_selectTag;if(this.options.loadTextURL){this.loadExternalText()}this.form.appendChild(this.editField);this.options.callback=function(D,E){return"value="+encodeURIComponent(E)}}});Form.Element.DelayedObserver=Class.create();Form.Element.DelayedObserver.prototype={initialize:function(B,A,C){this.delay=A||0.5;this.element=$(B);this.callback=C;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(A){if(this.lastValue==$F(this.element)){return }if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000);this.lastValue=$F(this.element)},onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element))}};Event.simulateMouse=function(D,B){var C=Object.extend({pointerX:0,pointerY:0,buttons:0,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false},arguments[2]||{});var A=document.createEvent("MouseEvents");A.initMouseEvent(B,true,true,document.defaultView,C.buttons,C.pointerX,C.pointerY,C.pointerX,C.pointerY,C.ctrlKey,C.altKey,C.shiftKey,C.metaKey,0,$(D));if(this.mark){Element.remove(this.mark)}this.mark=document.createElement("div");this.mark.appendChild(document.createTextNode(" "));document.body.appendChild(this.mark);this.mark.style.position="absolute";this.mark.style.top=C.pointerY+"px";this.mark.style.left=C.pointerX+"px";this.mark.style.width="5px";this.mark.style.height="5px;";this.mark.style.borderTop="1px solid red;";this.mark.style.borderLeft="1px solid red;";if(this.step){alert("["+new Date().getTime().toString()+"] "+B+"/"+Test.Unit.inspect(C))}$(D).dispatchEvent(A)};Event.simulateKey=function(D,B){var C=Object.extend({ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:0,charCode:0},arguments[2]||{});var A=document.createEvent("KeyEvents");A.initKeyEvent(B,true,true,window,C.ctrlKey,C.altKey,C.shiftKey,C.metaKey,C.keyCode,C.charCode);$(D).dispatchEvent(A)};Event.simulateKeys=function(B,C){for(var A=0;A<C.length;A++){Event.simulateKey(B,"keypress",{charCode:C.charCodeAt(A)})}};var Test={};Test.Unit={};Test.Unit.inspect=Object.inspect;Test.Unit.Logger=Class.create();Test.Unit.Logger.prototype={initialize:function(A){this.log=$(A);if(this.log){this._createLogTable()}},start:function(A){if(!this.log){return }this.testName=A;this.lastLogLine=document.createElement("tr");this.statusCell=document.createElement("td");this.nameCell=document.createElement("td");this.nameCell.className="nameCell";this.nameCell.appendChild(document.createTextNode(A));this.messageCell=document.createElement("td");this.lastLogLine.appendChild(this.statusCell);this.lastLogLine.appendChild(this.nameCell);this.lastLogLine.appendChild(this.messageCell);this.loglines.appendChild(this.lastLogLine)},finish:function(A,B){if(!this.log){return }this.lastLogLine.className=A;this.statusCell.innerHTML=A;this.messageCell.innerHTML=this._toHTML(B);this.addLinksToResults()},message:function(A){if(!this.log){return }this.messageCell.innerHTML=this._toHTML(A)},summary:function(A){if(!this.log){return }this.logsummary.innerHTML=this._toHTML(A)},_createLogTable:function(){this.log.innerHTML='<div id="logsummary"></div><table id="logtable"><thead><tr><th>Status</th><th>Test</th><th>Message</th></tr></thead><tbody id="loglines"></tbody></table>';this.logsummary=$("logsummary");this.loglines=$("loglines")},_toHTML:function(A){return A.escapeHTML().replace(/\n/g,"<br/>")},addLinksToResults:function(){$$("tr.failed .nameCell").each(function(A){A.title="Run only this test";Event.observe(A,"click",function(){window.location.search="?tests="+A.innerHTML})});$$("tr.passed .nameCell").each(function(A){A.title="Run all tests";Event.observe(A,"click",function(){window.location.search=""})})}};Test.Unit.Runner=Class.create();Test.Unit.Runner.prototype={initialize:function(A){this.options=Object.extend({testLog:"testlog"},arguments[1]||{});this.options.resultsURL=this.parseResultsURLQueryParameter();this.options.tests=this.parseTestsQueryParameter();if(this.options.testLog){this.options.testLog=$(this.options.testLog)||null}if(this.options.tests){this.tests=[];for(var C=0;C<this.options.tests.length;C++){if(/^test/.test(this.options.tests[C])){this.tests.push(new Test.Unit.Testcase(this.options.tests[C],A[this.options.tests[C]],A.setup,A.teardown))}}}else{if(this.options.test){this.tests=[new Test.Unit.Testcase(this.options.test,A[this.options.test],A.setup,A.teardown)]}else{this.tests=[];for(var B in A){if(/^test/.test(B)){this.tests.push(new Test.Unit.Testcase(this.options.context?" -> "+this.options.titles[B]:B,A[B],A.setup,A.teardown))}}}}this.currentTest=0;this.logger=new Test.Unit.Logger(this.options.testLog);setTimeout(this.runTests.bind(this),1000)},parseResultsURLQueryParameter:function(){return window.location.search.parseQuery()["resultsURL"]},parseTestsQueryParameter:function(){if(window.location.search.parseQuery()["tests"]){return window.location.search.parseQuery()["tests"].split(",")}},getResult:function(){var B=false;for(var A=0;A<this.tests.length;A++){if(this.tests[A].errors>0){return"ERROR"}if(this.tests[A].failures>0){B=true}}if(B){return"FAILURE"}else{return"SUCCESS"}},postResults:function(){if(this.options.resultsURL){new Ajax.Request(this.options.resultsURL,{method:"get",parameters:"result="+this.getResult(),asynchronous:false})}},runTests:function(){var A=this.tests[this.currentTest];if(!A){this.postResults();this.logger.summary(this.summary());return }if(!A.isWaiting){this.logger.start(A.name)}A.run();if(A.isWaiting){this.logger.message("Waiting for "+A.timeToWait+"ms");setTimeout(this.runTests.bind(this),A.timeToWait||1000)}else{this.logger.finish(A.status(),A.summary());this.currentTest++;this.runTests()}},summary:function(){var D=0;var B=0;var E=0;var C=[];for(var A=0;A<this.tests.length;A++){D+=this.tests[A].assertions;B+=this.tests[A].failures;E+=this.tests[A].errors}return((this.options.context?this.options.context+": ":"")+this.tests.length+" tests, "+D+" assertions, "+B+" failures, "+E+" errors")}};Test.Unit.Assertions=Class.create();Test.Unit.Assertions.prototype={initialize:function(){this.assertions=0;this.failures=0;this.errors=0;this.messages=[]},summary:function(){return(this.assertions+" assertions, "+this.failures+" failures, "+this.errors+" errors\n"+this.messages.join("\n"))},pass:function(){this.assertions++},fail:function(A){this.failures++;this.messages.push("Failure: "+A)},info:function(A){this.messages.push("Info: "+A)},error:function(A){this.errors++;this.messages.push(A.name+": "+A.message+"("+Test.Unit.inspect(A)+")")},status:function(){if(this.failures>0){return"failed"}if(this.errors>0){return"error"}return"passed"},assert:function(C){var A=arguments[1]||'assert: got "'+Test.Unit.inspect(C)+'"';try{C?this.pass():this.fail(A)}catch(B){this.error(B)}},assertEqual:function(B,D){var A=arguments[2]||"assertEqual";try{(B==D)?this.pass():this.fail(A+': expected "'+Test.Unit.inspect(B)+'", actual "'+Test.Unit.inspect(D)+'"')}catch(C){this.error(C)}},assertInspect:function(B,D){var A=arguments[2]||"assertInspect";try{(B==D.inspect())?this.pass():this.fail(A+': expected "'+Test.Unit.inspect(B)+'", actual "'+Test.Unit.inspect(D)+'"')}catch(C){this.error(C)}},assertEnumEqual:function(B,D){var A=arguments[2]||"assertEnumEqual";try{$A(B).length==$A(D).length&&B.zip(D).all(function(E){return E[0]==E[1]})?this.pass():this.fail(A+": expected "+Test.Unit.inspect(B)+", actual "+Test.Unit.inspect(D))}catch(C){this.error(C)}},assertNotEqual:function(B,D){var A=arguments[2]||"assertNotEqual";try{(B!=D)?this.pass():this.fail(A+': got "'+Test.Unit.inspect(D)+'"')}catch(C){this.error(C)}},assertIdentical:function(B,D){var A=arguments[2]||"assertIdentical";try{(B===D)?this.pass():this.fail(A+': expected "'+Test.Unit.inspect(B)+'", actual "'+Test.Unit.inspect(D)+'"')}catch(C){this.error(C)}},assertNotIdentical:function(B,D){var A=arguments[2]||"assertNotIdentical";try{!(B===D)?this.pass():this.fail(A+': expected "'+Test.Unit.inspect(B)+'", actual "'+Test.Unit.inspect(D)+'"')}catch(C){this.error(C)}},assertNull:function(C){var A=arguments[1]||"assertNull";try{(C==null)?this.pass():this.fail(A+': got "'+Test.Unit.inspect(C)+'"')}catch(B){this.error(B)}},assertMatch:function(C,E){var B=arguments[2]||"assertMatch";var A=new RegExp(C);try{(A.exec(E))?this.pass():this.fail(B+' : regex: "'+Test.Unit.inspect(C)+" did not match: "+Test.Unit.inspect(E)+'"')}catch(D){this.error(D)}},assertHidden:function(A){var B=arguments[1]||"assertHidden";this.assertEqual("none",A.style.display,B)},assertNotNull:function(A){var B=arguments[1]||"assertNotNull";this.assert(A!=null,B)},assertType:function(B,D){var A=arguments[2]||"assertType";try{(D.constructor==B)?this.pass():this.fail(A+': expected "'+Test.Unit.inspect(B)+'", actual "'+(D.constructor)+'"')}catch(C){this.error(C)}},assertNotOfType:function(B,D){var A=arguments[2]||"assertNotOfType";try{(D.constructor!=B)?this.pass():this.fail(A+': expected "'+Test.Unit.inspect(B)+'", actual "'+(D.constructor)+'"')}catch(C){this.error(C)}},assertInstanceOf:function(B,D){var A=arguments[2]||"assertInstanceOf";try{(D instanceof B)?this.pass():this.fail(A+": object was not an instance of the expected type")}catch(C){this.error(C)}},assertNotInstanceOf:function(B,D){var A=arguments[2]||"assertNotInstanceOf";try{!(D instanceof B)?this.pass():this.fail(A+": object was an instance of the not expected type")}catch(C){this.error(C)}},assertRespondsTo:function(D,C){var A=arguments[2]||"assertRespondsTo";try{(C[D]&&typeof C[D]=="function")?this.pass():this.fail(A+": object doesn't respond to ["+D+"]")}catch(B){this.error(B)}},assertReturnsTrue:function(E,D){var B=arguments[2]||"assertReturnsTrue";try{var A=D[E];if(!A){A=D["is"+E.charAt(0).toUpperCase()+E.slice(1)]}A()?this.pass():this.fail(B+": method returned false")}catch(C){this.error(C)}},assertReturnsFalse:function(E,D){var B=arguments[2]||"assertReturnsFalse";try{var A=D[E];if(!A){A=D["is"+E.charAt(0).toUpperCase()+E.slice(1)]}!A()?this.pass():this.fail(B+": method returned true")}catch(C){this.error(C)}},assertRaise:function(A,D){var B=arguments[2]||"assertRaise";try{D();this.fail(B+": exception expected but none was raised")}catch(C){((A==null)||(C.name==A))?this.pass():this.error(C)}},assertElementsMatch:function(){var A=$A(arguments),B=$A(A.shift());if(B.length!=A.length){this.fail("assertElementsMatch: size mismatch: "+B.length+" elements, "+A.length+" expressions");return false}B.zip(A).all(function(F,C){var D=$(F.first()),E=F.last();if(D.match(E)){return true}this.fail("assertElementsMatch: (in index "+C+") expected "+E.inspect()+" but got "+D.inspect())}.bind(this))&&this.pass()},assertElementMatches:function(A,B){this.assertElementsMatch([A],B)},benchmark:function(C,D){var B=new Date();(D||1).times(C);var A=((new Date())-B);this.info((arguments[2]||"Operation")+" finished "+D+" iterations in "+(A/1000)+"s");return A},_isVisible:function(A){A=$(A);if(!A.parentNode){return true}this.assertNotNull(A);if(A.style&&Element.getStyle(A,"display")=="none"){return false}return this._isVisible(A.parentNode)},assertNotVisible:function(A){this.assert(!this._isVisible(A),Test.Unit.inspect(A)+" was not hidden and didn't have a hidden parent either. "+(""||arguments[1]))},assertVisible:function(A){this.assert(this._isVisible(A),Test.Unit.inspect(A)+" was not visible. "+(""||arguments[1]))},benchmark:function(C,D){var B=new Date();(D||1).times(C);var A=((new Date())-B);this.info((arguments[2]||"Operation")+" finished "+D+" iterations in "+(A/1000)+"s");return A}};Test.Unit.Testcase=Class.create();Object.extend(Object.extend(Test.Unit.Testcase.prototype,Test.Unit.Assertions.prototype),{initialize:function(name,test,setup,teardown){Test.Unit.Assertions.prototype.initialize.bind(this)();this.name=name;if(typeof test=="string"){test=test.gsub(/(\.should[^\(]+\()/,"#{0}this,");test=test.gsub(/(\.should[^\(]+)\(this,\)/,"#{1}(this)");this.test=function(){eval("with(this){"+test+"}")}}else{this.test=test||function(){}}this.setup=setup||function(){};this.teardown=teardown||function(){};this.isWaiting=false;this.timeToWait=1000},wait:function(B,A){this.isWaiting=true;this.test=A;this.timeToWait=B},run:function(){try{try{if(!this.isWaiting){this.setup.bind(this)()}this.isWaiting=false;this.test.bind(this)()}finally{if(!this.isWaiting){this.teardown.bind(this)()}}}catch(A){this.error(A)}}});Test.setupBDDExtensionMethods=function(){var METHODMAP={shouldEqual:"assertEqual",shouldNotEqual:"assertNotEqual",shouldEqualEnum:"assertEnumEqual",shouldBeA:"assertType",shouldNotBeA:"assertNotOfType",shouldBeAn:"assertType",shouldNotBeAn:"assertNotOfType",shouldBeNull:"assertNull",shouldNotBeNull:"assertNotNull",shouldBe:"assertReturnsTrue",shouldNotBe:"assertReturnsFalse",shouldRespondTo:"assertRespondsTo"};Test.BDDMethods={};for(m in METHODMAP){Test.BDDMethods[m]=eval("function(){var args = $A(arguments);var scope = args.shift();scope."+METHODMAP[m]+".apply(scope,(args || []).concat([this])); }")}[Array.prototype,String.prototype,Number.prototype].each(function(p){Object.extend(p,Test.BDDMethods)})};Test.context=function(D,C,F){Test.setupBDDExtensionMethods();var E={};var G={};for(specName in C){switch(specName){case"setup":case"teardown":E[specName]=C[specName];break;default:var B="test"+specName.gsub(/\s+/,"-").camelize();var A=C[specName].toString().split("\n").slice(1);if(/^\{/.test(A[0])){A=A.slice(1)}A.pop();A=A.map(function(H){return H.strip()});E[B]=A.join("\n");G[B]=specName}}new Test.Unit.Runner(E,{titles:G,testLog:F||"testlog",context:D})};String.prototype.parseColor=function(){var A="#";if(this.slice(0,4)=="rgb("){var C=this.slice(4,this.length-1).split(",");var B=0;do{A+=parseInt(C[B]).toColorPart()}while(++B<3)}else{if(this.slice(0,1)=="#"){if(this.length==4){for(var B=1;B<4;B++){A+=(this.charAt(B)+this.charAt(B)).toLowerCase()}}if(this.length==7){A=this.toLowerCase()}}}return(A.length==7?A:(arguments[0]||this))};Element.collectTextNodes=function(A){return $A($(A).childNodes).collect(function(B){return(B.nodeType==3?B.nodeValue:(B.hasChildNodes()?Element.collectTextNodes(B):""))}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(A,B){return $A($(A).childNodes).collect(function(C){return(C.nodeType==3?C.nodeValue:((C.hasChildNodes()&&!Element.hasClassName(C,B))?Element.collectTextNodesIgnoreClass(C,B):""))}).flatten().join("")};Element.setContentZoom=function(A,B){A=$(A);A.setStyle({fontSize:(B/100)+"em"});if(Prototype.Browser.WebKit){window.scrollBy(0,0)}return A};Element.getInlineOpacity=function(A){return $(A).style.opacity||""};Element.forceRerendering=function(A){try{A=$(A);var C=document.createTextNode(" ");A.appendChild(C);A.removeChild(C)}catch(B){}};Array.prototype.call=function(){var A=arguments;this.each(function(B){B.apply(this,A)})};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},tagifyText:function(A){if(typeof Builder=="undefined"){throw ("Effect.tagifyText requires including script.aculo.us' builder.js library")}var B="position:relative";if(Prototype.Browser.IE){B+=";zoom:1"}A=$(A);$A(A.childNodes).each(function(C){if(C.nodeType==3){C.nodeValue.toArray().each(function(D){A.insertBefore(Builder.node("span",{style:B},D==" "?String.fromCharCode(160):D),C)});Element.remove(C)}})},multiple:function(B,C){var E;if(((typeof B=="object")||(typeof B=="function"))&&(B.length)){E=B}else{E=$(B).childNodes}var A=Object.extend({speed:0.1,delay:0},arguments[2]||{});var D=A.delay;$A(E).each(function(G,F){new C(G,Object.extend(A,{delay:F*A.speed+D}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(B,C){B=$(B);C=(C||"appear").toLowerCase();var A=Object.extend({queue:{position:"end",scope:(B.id||"global"),limit:1}},arguments[2]||{});Effect[B.visible()?Effect.PAIRS[C][1]:Effect.PAIRS[C][0]](B,A)}};var Effect2=Effect;Effect.Transitions={linear:Prototype.K,sinoidal:function(A){return(-Math.cos(A*Math.PI)/2)+0.5},reverse:function(A){return 1-A},flicker:function(A){var A=((-Math.cos(A*Math.PI)/4)+0.75)+Math.random()/4;return(A>1?1:A)},wobble:function(A){return(-Math.cos(A*Math.PI*(9*A))/2)+0.5},pulse:function(B,A){A=A||5;return(Math.round((B%(1/A))*A)==0?((B*A*2)-Math.floor(B*A*2)):1-((B*A*2)-Math.floor(B*A*2)))},none:function(A){return 0},full:function(A){return 1}};Effect.ScopedQueue=Class.create();Object.extend(Object.extend(Effect.ScopedQueue.prototype,Enumerable),{initialize:function(){this.effects=[];this.interval=null},_each:function(A){this.effects._each(A)},add:function(B){var C=new Date().getTime();var A=(typeof B.options.queue=="string")?B.options.queue:B.options.queue.position;switch(A){case"front":this.effects.findAll(function(D){return D.state=="idle"}).each(function(D){D.startOn+=B.finishOn;D.finishOn+=B.finishOn});break;case"with-last":C=this.effects.pluck("startOn").max()||C;break;case"end":C=this.effects.pluck("finishOn").max()||C;break}B.startOn+=C;B.finishOn+=C;if(!B.options.queue.limit||(this.effects.length<B.options.queue.limit)){this.effects.push(B)}if(!this.interval){this.interval=setInterval(this.loop.bind(this),15)}},remove:function(A){this.effects=this.effects.reject(function(B){return B==A});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){var C=new Date().getTime();for(var B=0,A=this.effects.length;B<A;B++){this.effects[B]&&this.effects[B].loop(C)}}});Effect.Queues={instances:$H(),get:function(A){if(typeof A!="string"){return A}if(!this.instances[A]){this.instances[A]=new Effect.ScopedQueue()}return this.instances[A]}};Effect.Queue=Effect.Queues.get("global");Effect.DefaultOptions={transition:Effect.Transitions.sinoidal,duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"};Effect.Base=function(){};Effect.Base.prototype={position:null,start:function(options){function codeForEvent(options,eventName){return((options[eventName+"Internal"]?"this.options."+eventName+"Internal(this);":"")+(options[eventName]?"this.options."+eventName+"(this);":""))}if(options.transition===false){options.transition=Effect.Transitions.linear}this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;eval('this.render = function(pos){ if(this.state=="idle"){this.state="running";'+codeForEvent(options,"beforeSetup")+(this.setup?"this.setup();":"")+codeForEvent(options,"afterSetup")+'};if(this.state=="running"){pos=this.options.transition(pos)*'+this.fromToDelta+"+"+this.options.from+";this.position=pos;"+codeForEvent(options,"beforeUpdate")+(this.update?"this.update(pos);":"")+codeForEvent(options,"afterUpdate")+"}}");this.event("beforeStart");if(!this.options.sync){Effect.Queues.get(typeof this.options.queue=="string"?"global":this.options.queue.scope).add(this)}},loop:function(C){if(C>=this.startOn){if(C>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");if(this.finish){this.finish()}this.event("afterFinish");return }var B=(C-this.startOn)/this.totalTime,A=Math.round(B*this.totalFrames);if(A>this.currentFrame){this.render(B);this.currentFrame=A}}},cancel:function(){if(!this.options.sync){Effect.Queues.get(typeof this.options.queue=="string"?"global":this.options.queue.scope).remove(this)}this.state="finished"},event:function(A){if(this.options[A+"Internal"]){this.options[A+"Internal"](this)}if(this.options[A]){this.options[A](this)}},inspect:function(){var A=$H();for(property in this){if(typeof this[property]!="function"){A[property]=this[property]}}return"#<Effect:"+A.inspect()+",options:"+$H(this.options).inspect()+">"}};Effect.Parallel=Class.create();Object.extend(Object.extend(Effect.Parallel.prototype,Effect.Base.prototype),{initialize:function(A){this.effects=A||[];this.start(arguments[1])},update:function(A){this.effects.invoke("render",A)},finish:function(A){this.effects.each(function(B){B.render(1);B.cancel();B.event("beforeFinish");if(B.finish){B.finish(A)}B.event("afterFinish")})}});Effect.Event=Class.create();Object.extend(Object.extend(Effect.Event.prototype,Effect.Base.prototype),{initialize:function(){var A=Object.extend({duration:0},arguments[0]||{});this.start(A)},update:Prototype.emptyFunction});Effect.Opacity=Class.create();Object.extend(Object.extend(Effect.Opacity.prototype,Effect.Base.prototype),{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError)}if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}var A=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(A)},update:function(A){this.element.setOpacity(A)}});Effect.Move=Class.create();Object.extend(Object.extend(Effect.Move.prototype,Effect.Base.prototype),{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError)}var A=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(A)},setup:function(){this.element.makePositioned();this.originalLeft=this.element.offsetLeft;this.originalTop=this.element.offsetTop;if(this.options.mode=="absolute"){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop}},update:function(A){this.element.setStyle({left:Math.round(this.options.x*A+this.originalLeft)+"px",top:Math.round(this.options.y*A+this.originalTop)+"px"})}});Effect.MoveBy=function(B,A,C){return new Effect.Move(B,Object.extend({x:C,y:A},arguments[3]||{}))};Effect.Scale=Class.create();Object.extend(Object.extend(Effect.Scale.prototype,Effect.Base.prototype),{initialize:function(B,C){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError)}var A=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:C},arguments[2]||{});this.start(A)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(B){this.originalStyle[B]=this.element.style[B]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var A=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(B){if(A.indexOf(B)>0){this.fontSize=parseFloat(A);this.fontSizeType=B}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box"){this.dims=[this.element.offsetHeight,this.element.offsetWidth]}if(/^content/.test(this.options.scaleMode)){this.dims=[this.element.scrollHeight,this.element.scrollWidth]}if(!this.dims){this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]}},update:function(A){var B=(this.options.scaleFrom/100)+(this.factor*A);if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*B+this.fontSizeType})}this.setDimensions(this.dims[0]*B,this.dims[1]*B)},finish:function(A){if(this.restoreAfterFinish){this.element.setStyle(this.originalStyle)}},setDimensions:function(A,D){var E={};if(this.options.scaleX){E.width=Math.round(D)+"px"}if(this.options.scaleY){E.height=Math.round(A)+"px"}if(this.options.scaleFromCenter){var C=(A-this.dims[0])/2;var B=(D-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY){E.top=this.originalTop-C+"px"}if(this.options.scaleX){E.left=this.originalLeft-B+"px"}}else{if(this.options.scaleY){E.top=-C+"px"}if(this.options.scaleX){E.left=-B+"px"}}}this.element.setStyle(E)}});Effect.Highlight=Class.create();Object.extend(Object.extend(Effect.Highlight.prototype,Effect.Base.prototype),{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError)}var A=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(A)},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return }this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color")}this._base=$R(0,2).map(function(A){return parseInt(this.options.startcolor.slice(A*2+1,A*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(A){return parseInt(this.options.endcolor.slice(A*2+1,A*2+3),16)-this._base[A]}.bind(this))},update:function(A){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(B,C,D){return B+(Math.round(this._base[D]+(this._delta[D]*A)).toColorPart())}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=Class.create();Object.extend(Object.extend(Effect.ScrollTo.prototype,Effect.Base.prototype),{initialize:function(A){this.element=$(A);this.start(arguments[1]||{})},setup:function(){Position.prepare();var B=Position.cumulativeOffset(this.element);if(this.options.offset){B[1]+=this.options.offset}var A=window.innerHeight?window.height-window.innerHeight:document.body.scrollHeight-(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight);this.scrollStart=Position.deltaY;this.delta=(B[1]>A?A:B[1])-this.scrollStart},update:function(A){Position.prepare();window.scrollTo(Position.deltaX,this.scrollStart+(A*this.delta))}});Effect.Fade=function(C){C=$(C);var A=C.getInlineOpacity();var B=Object.extend({from:C.getOpacity()||1,to:0,afterFinishInternal:function(D){if(D.options.to!=0){return }D.element.hide().setStyle({opacity:A})}},arguments[1]||{});return new Effect.Opacity(C,B)};Effect.Appear=function(B){B=$(B);var A=Object.extend({from:(B.getStyle("display")=="none"?0:B.getOpacity()||0),to:1,afterFinishInternal:function(C){C.element.forceRerendering()},beforeSetup:function(C){C.element.setOpacity(C.options.from).show()}},arguments[1]||{});return new Effect.Opacity(B,A)};Effect.Puff=function(B){B=$(B);var A={opacity:B.getInlineOpacity(),position:B.getStyle("position"),top:B.style.top,left:B.style.left,width:B.style.width,height:B.style.height};return new Effect.Parallel([new Effect.Scale(B,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(B,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(C){Position.absolutize(C.effects[0].element)},afterFinishInternal:function(C){C.effects[0].element.hide().setStyle(A)}},arguments[1]||{}))};Effect.BlindUp=function(A){A=$(A);A.makeClipping();return new Effect.Scale(A,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(B){B.element.hide().undoClipping()}},arguments[1]||{}))};Effect.BlindDown=function(B){B=$(B);var A=B.getDimensions();return new Effect.Scale(B,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:A.height,originalWidth:A.width},restoreAfterFinish:true,afterSetup:function(C){C.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(C){C.element.undoClipping()}},arguments[1]||{}))};Effect.SwitchOff=function(B){B=$(B);var A=B.getInlineOpacity();return new Effect.Appear(B,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(C){new Effect.Scale(C.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(D){D.element.makePositioned().makeClipping()},afterFinishInternal:function(D){D.element.hide().undoClipping().undoPositioned().setStyle({opacity:A})}})}},arguments[1]||{}))};Effect.DropOut=function(B){B=$(B);var A={top:B.getStyle("top"),left:B.getStyle("left"),opacity:B.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(B,{x:0,y:100,sync:true}),new Effect.Opacity(B,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(C){C.effects[0].element.makePositioned()},afterFinishInternal:function(C){C.effects[0].element.hide().undoPositioned().setStyle(A)}},arguments[1]||{}))};Effect.Shake=function(B){B=$(B);var A={top:B.getStyle("top"),left:B.getStyle("left")};return new Effect.Move(B,{x:20,y:0,duration:0.05,afterFinishInternal:function(C){new Effect.Move(C.element,{x:-40,y:0,duration:0.1,afterFinishInternal:function(D){new Effect.Move(D.element,{x:40,y:0,duration:0.1,afterFinishInternal:function(E){new Effect.Move(E.element,{x:-40,y:0,duration:0.1,afterFinishInternal:function(F){new Effect.Move(F.element,{x:40,y:0,duration:0.1,afterFinishInternal:function(G){new Effect.Move(G.element,{x:-20,y:0,duration:0.05,afterFinishInternal:function(H){H.element.undoPositioned().setStyle(A)}})}})}})}})}})}})};Effect.SlideDown=function(C){C=$(C).cleanWhitespace();var A=C.down().getStyle("bottom");var B=C.getDimensions();return new Effect.Scale(C,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:B.height,originalWidth:B.width},restoreAfterFinish:true,afterSetup:function(D){D.element.makePositioned();D.element.down().makePositioned();if(window.opera){D.element.setStyle({top:""})}D.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(D){D.element.down().setStyle({bottom:(D.dims[0]-D.element.clientHeight)+"px"})},afterFinishInternal:function(D){D.element.undoClipping().undoPositioned();D.element.down().undoPositioned().setStyle({bottom:A})}},arguments[1]||{}))};Effect.SlideUp=function(B){B=$(B).cleanWhitespace();var A=B.down().getStyle("bottom");return new Effect.Scale(B,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,restoreAfterFinish:true,beforeStartInternal:function(C){C.element.makePositioned();C.element.down().makePositioned();if(window.opera){C.element.setStyle({top:""})}C.element.makeClipping().show()},afterUpdateInternal:function(C){C.element.down().setStyle({bottom:(C.dims[0]-C.element.clientHeight)+"px"})},afterFinishInternal:function(C){C.element.hide().undoClipping().undoPositioned().setStyle({bottom:A});C.element.down().undoPositioned()}},arguments[1]||{}))};Effect.Squish=function(A){return new Effect.Scale(A,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(B){B.element.makeClipping()},afterFinishInternal:function(B){B.element.hide().undoClipping()}})};Effect.Grow=function(C){C=$(C);var B=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var A={top:C.style.top,left:C.style.left,height:C.style.height,width:C.style.width,opacity:C.getInlineOpacity()};var G=C.getDimensions();var H,F;var E,D;switch(B.direction){case"top-left":H=F=E=D=0;break;case"top-right":H=G.width;F=D=0;E=-G.width;break;case"bottom-left":H=E=0;F=G.height;D=-G.height;break;case"bottom-right":H=G.width;F=G.height;E=-G.width;D=-G.height;break;case"center":H=G.width/2;F=G.height/2;E=-G.width/2;D=-G.height/2;break}return new Effect.Move(C,{x:H,y:F,duration:0.01,beforeSetup:function(I){I.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(I){new Effect.Parallel([new Effect.Opacity(I.element,{sync:true,to:1,from:0,transition:B.opacityTransition}),new Effect.Move(I.element,{x:E,y:D,sync:true,transition:B.moveTransition}),new Effect.Scale(I.element,100,{scaleMode:{originalHeight:G.height,originalWidth:G.width},sync:true,scaleFrom:window.opera?1:0,transition:B.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(J){J.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(J){J.effects[0].element.undoClipping().undoPositioned().setStyle(A)}},B))}})};Effect.Shrink=function(C){C=$(C);var B=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var A={top:C.style.top,left:C.style.left,height:C.style.height,width:C.style.width,opacity:C.getInlineOpacity()};var F=C.getDimensions();var E,D;switch(B.direction){case"top-left":E=D=0;break;case"top-right":E=F.width;D=0;break;case"bottom-left":E=0;D=F.height;break;case"bottom-right":E=F.width;D=F.height;break;case"center":E=F.width/2;D=F.height/2;break}return new Effect.Parallel([new Effect.Opacity(C,{sync:true,to:0,from:1,transition:B.opacityTransition}),new Effect.Scale(C,window.opera?1:0,{sync:true,transition:B.scaleTransition,restoreAfterFinish:true}),new Effect.Move(C,{x:E,y:D,sync:true,transition:B.moveTransition})],Object.extend({beforeStartInternal:function(G){G.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(G){G.effects[0].element.hide().undoClipping().undoPositioned().setStyle(A)}},B))};Effect.Pulsate=function(C){C=$(C);var B=arguments[1]||{};var A=C.getInlineOpacity();var E=B.transition||Effect.Transitions.sinoidal;var D=function(F){return E(1-Effect.Transitions.pulse(F,B.pulses))};D.bind(E);return new Effect.Opacity(C,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(F){F.element.setStyle({opacity:A})}},B),{transition:D}))};Effect.Fold=function(B){B=$(B);var A={top:B.style.top,left:B.style.left,width:B.style.width,height:B.style.height};B.makeClipping();return new Effect.Scale(B,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(C){new Effect.Scale(B,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(D){D.element.hide().undoClipping().setStyle(A)}})}},arguments[1]||{}))};Effect.Morph=Class.create();Object.extend(Object.extend(Effect.Morph.prototype,Effect.Base.prototype),{initialize:function(C){this.element=$(C);if(!this.element){throw (Effect._elementDoesNotExistError)}var B=Object.extend({style:{}},arguments[1]||{});if(typeof B.style=="string"){if(B.style.indexOf(":")==-1){var D="",A="."+B.style;$A(document.styleSheets).reverse().each(function(E){if(E.cssRules){cssRules=E.cssRules}else{if(E.rules){cssRules=E.rules}}$A(cssRules).reverse().each(function(F){if(A==F.selectorText){D=F.style.cssText;throw $break}});if(D){throw $break}});this.style=D.parseStyle();B.afterFinishInternal=function(E){E.element.addClassName(E.options.style);E.transforms.each(function(F){if(F.style!="opacity"){E.element.style[F.style]=""}})}}else{this.style=B.style.parseStyle()}}else{this.style=$H(B.style)}this.start(B)},setup:function(){function A(B){if(!B||["rgba(0, 0, 0, 0)","transparent"].include(B)){B="#ffffff"}B=B.parseColor();return $R(0,2).map(function(C){return parseInt(B.slice(C*2+1,C*2+3),16)})}this.transforms=this.style.map(function(G){var F=G[0],E=G[1],D=null;if(E.parseColor("#zzzzzz")!="#zzzzzz"){E=E.parseColor();D="color"}else{if(F=="opacity"){E=parseFloat(E);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}}else{if(Element.CSS_LENGTH.test(E)){var C=E.match(/^([\+\-]?[0-9\.]+)(.*)$/);E=parseFloat(C[1]);D=(C.length==3)?C[2]:null}}}var B=this.element.getStyle(F);return{style:F.camelize(),originalValue:D=="color"?A(B):parseFloat(B||0),targetValue:D=="color"?A(E):E,unit:D}}.bind(this)).reject(function(B){return((B.originalValue==B.targetValue)||(B.unit!="color"&&(isNaN(B.originalValue)||isNaN(B.targetValue))))})},update:function(A){var D={},B,C=this.transforms.length;while(C--){D[(B=this.transforms[C]).style]=B.unit=="color"?"#"+(Math.round(B.originalValue[0]+(B.targetValue[0]-B.originalValue[0])*A)).toColorPart()+(Math.round(B.originalValue[1]+(B.targetValue[1]-B.originalValue[1])*A)).toColorPart()+(Math.round(B.originalValue[2]+(B.targetValue[2]-B.originalValue[2])*A)).toColorPart():B.originalValue+Math.round(((B.targetValue-B.originalValue)*A)*1000)/1000+B.unit}this.element.setStyle(D,true)}});Effect.Transform=Class.create();Object.extend(Effect.Transform.prototype,{initialize:function(A){this.tracks=[];this.options=arguments[1]||{};this.addTracks(A)},addTracks:function(A){A.each(function(B){var C=$H(B).values().first();this.tracks.push($H({ids:$H(B).keys().first(),effect:Effect.Morph,options:{style:C}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(A){var B=[$(A.ids)||$$(A.ids)].flatten();return B.map(function(C){return new A.effect(C,Object.extend({sync:true},A.options))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.prototype.parseStyle=function(){var B=document.createElement("div");B.innerHTML='<div style="'+this+'"></div>';var C=B.childNodes[0].style,A=$H();Element.CSS_PROPERTIES.each(function(D){if(C[D]){A[D]=C[D]}});if(Prototype.Browser.IE&&this.indexOf("opacity")>-1){A.opacity=this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]}return A};Element.morph=function(A,B){new Effect.Morph(A,Object.extend({style:B},arguments[2]||{}));return A};["getInlineOpacity","forceRerendering","setContentZoom","collectTextNodes","collectTextNodesIgnoreClass","morph"].each(function(A){Element.Methods[A]=Element[A]});Element.Methods.visualEffect=function(B,C,A){s=C.dasherize().camelize();effect_class=s.charAt(0).toUpperCase()+s.substring(1);new Effect[effect_class](B,A);return $(B)};Element.addMethods();if(typeof Effect=="undefined"){throw ("dragdrop.js requires including script.aculo.us' effects.js library")}var Droppables={drops:[],remove:function(A){this.drops=this.drops.reject(function(B){return B.element==$(A)})},add:function(B){B=$(B);var A=Object.extend({greedy:true,hoverclass:null,tree:false},arguments[1]||{});if(A.containment){A._containers=[];var C=A.containment;if((typeof C=="object")&&(C.constructor==Array)){C.each(function(D){A._containers.push($(D))})}else{A._containers.push($(C))}}if(A.accept){A.accept=[A.accept].flatten()}Element.makePositioned(B);A.element=B;this.drops.push(A)},findDeepestChild:function(A){deepest=A[0];for(i=1;i<A.length;++i){if(Element.isParent(A[i].element,deepest.element)){deepest=A[i]}}return deepest},isContained:function(B,A){var C;if(A.tree){C=B.treeNode}else{C=B.parentNode}return A._containers.detect(function(D){return C==D})},isAffected:function(A,C,B){return((B.element!=C)&&((!B._containers)||this.isContained(C,B))&&((!B.accept)||(Element.classNames(C).detect(function(D){return B.accept.include(D)})))&&Position.within(B.element,A[0],A[1]))},deactivate:function(A){if(A.hoverclass){Element.removeClassName(A.element,A.hoverclass)}this.last_active=null},activate:function(A){if(A.hoverclass){Element.addClassName(A.element,A.hoverclass)}this.last_active=A},show:function(A,B){if(!this.drops.length){return }var C=[];if(this.last_active){this.deactivate(this.last_active)}this.drops.each(function(D){if(Droppables.isAffected(A,B,D)){C.push(D)}});if(C.length>0){drop=Droppables.findDeepestChild(C);Position.within(drop.element,A[0],A[1]);if(drop.onHover){drop.onHover(B,drop.element,Position.overlap(drop.overlap,drop.element))}Droppables.activate(drop)}},fire:function(B,A){if(!this.last_active){return }Position.prepare();if(this.isAffected([Event.pointerX(B),Event.pointerY(B)],A,this.last_active)){if(this.last_active.onDrop){this.last_active.onDrop(A,this.last_active.element,B);return true}}},reset:function(){if(this.last_active){this.deactivate(this.last_active)}}};var Draggables={drags:[],observers:[],register:function(A){if(this.drags.length==0){this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress)}this.drags.push(A)},unregister:function(A){this.drags=this.drags.reject(function(B){return B==A});if(this.drags.length==0){Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress)}},activate:function(A){if(A.options.delay){this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=A}.bind(this),A.options.delay)}else{window.focus();this.activeDraggable=A}},deactivate:function(){this.activeDraggable=null},updateDrag:function(A){if(!this.activeDraggable){return }var B=[Event.pointerX(A),Event.pointerY(A)];if(this._lastPointer&&(this._lastPointer.inspect()==B.inspect())){return }this._lastPointer=B;this.activeDraggable.updateDrag(A,B)},endDrag:function(A){if(this._timeout){clearTimeout(this._timeout);this._timeout=null}if(!this.activeDraggable){return }this._lastPointer=null;this.activeDraggable.endDrag(A);this.activeDraggable=null},keyPress:function(A){if(this.activeDraggable){this.activeDraggable.keyPress(A)}},addObserver:function(A){this.observers.push(A);this._cacheObserverCallbacks()},removeObserver:function(A){this.observers=this.observers.reject(function(B){return B.element==A});this._cacheObserverCallbacks()},notify:function(B,A,C){if(this[B+"Count"]>0){this.observers.each(function(D){if(D[B]){D[B](B,A,C)}})}if(A.options[B]){A.options[B](A,C)}},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(A){Draggables[A+"Count"]=Draggables.observers.select(function(B){return B[A]}).length})}};var Draggable=Class.create();Draggable._dragging={};Draggable.prototype={initialize:function(B){var C={handle:false,reverteffect:function(F,E,D){var G=Math.sqrt(Math.abs(E^2)+Math.abs(D^2))*0.02;new Effect.Move(F,{x:-D,y:-E,duration:G,queue:{scope:"_draggable",position:"end"}})},endeffect:function(E){var D=typeof E._opacity=="number"?E._opacity:1;new Effect.Opacity(E,{duration:0.2,from:0.7,to:D,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[E]=false}})},zindex:1000,revert:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false,delay:0};if(!arguments[1]||typeof arguments[1].endeffect=="undefined"){Object.extend(C,{starteffect:function(D){D._opacity=Element.getOpacity(D);Draggable._dragging[D]=true;new Effect.Opacity(D,{duration:0.2,from:D._opacity,to:0.7})}})}var A=Object.extend(C,arguments[1]||{});this.element=$(B);if(A.handle&&(typeof A.handle=="string")){this.handle=this.element.down("."+A.handle,0)}if(!this.handle){this.handle=$(A.handle)}if(!this.handle){this.handle=this.element}if(A.scroll&&!A.scroll.scrollTo&&!A.scroll.outerHTML){A.scroll=$(A.scroll);this._isScrollChild=Element.childOf(this.element,A.scroll)}Element.makePositioned(this.element);this.delta=this.currentDelta();this.options=A;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this)},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Draggables.unregister(this)},currentDelta:function(){return([parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")])},initDrag:function(A){if(typeof Draggable._dragging[this.element]!="undefined"&&Draggable._dragging[this.element]){return }if(Event.isLeftClick(A)){var C=Event.element(A);if((tag_name=C.tagName.toUpperCase())&&(tag_name=="INPUT"||tag_name=="SELECT"||tag_name=="OPTION"||tag_name=="BUTTON"||tag_name=="TEXTAREA")){return }var B=[Event.pointerX(A),Event.pointerY(A)];var D=Position.cumulativeOffset(this.element);this.offset=[0,1].map(function(E){return(B[E]-D[E])});Draggables.activate(this);Event.stop(A)}},startDrag:function(B){this.dragging=true;if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0);this.element.style.zIndex=this.options.zindex}if(this.options.ghosting){this._clone=this.element.cloneNode(true);Position.absolutize(this.element);this.element.parentNode.insertBefore(this._clone,this.element)}if(this.options.scroll){if(this.options.scroll==window){var A=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=A.left;this.originalScrollTop=A.top}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop}}Draggables.notify("onStart",this,B);if(this.options.starteffect){this.options.starteffect(this.element)}},updateDrag:function(event,pointer){if(!this.dragging){this.startDrag(event)}if(!this.options.quiet){Position.prepare();Droppables.show(pointer,this.element)}Draggables.notify("onDrag",this,event);this.draw(pointer);if(this.options.change){this.options.change(this)}if(this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){p=[left,top,left+width,top+height]}}else{p=Position.page(this.options.scroll);p[0]+=this.options.scroll.scrollLeft+Position.deltaX;p[1]+=this.options.scroll.scrollTop+Position.deltaY;p.push(p[0]+this.options.scroll.offsetWidth);p.push(p[1]+this.options.scroll.offsetHeight)}var speed=[0,0];if(pointer[0]<(p[0]+this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[0]+this.options.scrollSensitivity)}if(pointer[1]<(p[1]+this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[1]+this.options.scrollSensitivity)}if(pointer[0]>(p[2]-this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[2]-this.options.scrollSensitivity)}if(pointer[1]>(p[3]-this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[3]-this.options.scrollSensitivity)}this.startScrolling(speed)}if(Prototype.Browser.WebKit){window.scrollBy(0,0)}Event.stop(event)},finishDrag:function(B,E){this.dragging=false;if(this.options.quiet){Position.prepare();var D=[Event.pointerX(B),Event.pointerY(B)];Droppables.show(D,this.element)}if(this.options.ghosting){Position.relativize(this.element);Element.remove(this._clone);this._clone=null}var F=false;if(E){F=Droppables.fire(B,this.element);if(!F){F=false}}if(F&&this.options.onDropped){this.options.onDropped(this.element)}Draggables.notify("onEnd",this,B);var A=this.options.revert;if(A&&typeof A=="function"){A=A(this.element)}var C=this.currentDelta();if(A&&this.options.reverteffect){if(F==0||A!="failure"){this.options.reverteffect(this.element,C[1]-this.delta[1],C[0]-this.delta[0])}}else{this.delta=C}if(this.options.zindex){this.element.style.zIndex=this.originalZ}if(this.options.endeffect){this.options.endeffect(this.element)}Draggables.deactivate(this);Droppables.reset()},keyPress:function(A){if(A.keyCode!=Event.KEY_ESC){return }this.finishDrag(A,false);Event.stop(A)},endDrag:function(A){if(!this.dragging){return }this.stopScrolling();this.finishDrag(A,true);Event.stop(A)},draw:function(A){var F=Position.cumulativeOffset(this.element);if(this.options.ghosting){var C=Position.realOffset(this.element);F[0]+=C[0]-Position.deltaX;F[1]+=C[1]-Position.deltaY}var E=this.currentDelta();F[0]-=E[0];F[1]-=E[1];if(this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)){F[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;F[1]-=this.options.scroll.scrollTop-this.originalScrollTop}var D=[0,1].map(function(G){return(A[G]-F[G]-this.offset[G])}.bind(this));if(this.options.snap){if(typeof this.options.snap=="function"){D=this.options.snap(D[0],D[1],this)}else{if(this.options.snap instanceof Array){D=D.map(function(G,H){return Math.round(G/this.options.snap[H])*this.options.snap[H]}.bind(this))}else{D=D.map(function(G){return Math.round(G/this.options.snap)*this.options.snap}.bind(this))}}}var B=this.element.style;if((!this.options.constraint)||(this.options.constraint=="horizontal")){B.left=D[0]+"px"}if((!this.options.constraint)||(this.options.constraint=="vertical")){B.top=D[1]+"px"}if(B.visibility=="hidden"){B.visibility=""}},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null;Draggables._lastScrollPointer=null}},startScrolling:function(A){if(!(A[0]||A[1])){return }this.scrollSpeed=[A[0]*this.options.scrollSpeed,A[1]*this.options.scrollSpeed];this.lastScrolled=new Date();this.scrollInterval=setInterval(this.scroll.bind(this),10)},scroll:function(){var current=new Date();var delta=current-this.lastScrolled;this.lastScrolled=current;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=delta/1000;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1])}}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*delta/1000;this.options.scroll.scrollTop+=this.scrollSpeed[1]*delta/1000}Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify("onDrag",this);if(this._isScrollChild){Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer);Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*delta/1000;Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*delta/1000;if(Draggables._lastScrollPointer[0]<0){Draggables._lastScrollPointer[0]=0}if(Draggables._lastScrollPointer[1]<0){Draggables._lastScrollPointer[1]=0}this.draw(Draggables._lastScrollPointer)}if(this.options.change){this.options.change(this)}},_getWindowScroll:function(w){var T,L,W,H;with(w.document){if(w.document.documentElement&&documentElement.scrollTop){T=documentElement.scrollTop;L=documentElement.scrollLeft}else{if(w.document.body){T=body.scrollTop;L=body.scrollLeft}}if(w.innerWidth){W=w.innerWidth;H=w.innerHeight}else{if(w.document.documentElement&&documentElement.clientWidth){W=documentElement.clientWidth;H=documentElement.clientHeight}else{W=body.offsetWidth;H=body.offsetHeight}}}return{top:T,left:L,width:W,height:H}}};var SortableObserver=Class.create();SortableObserver.prototype={initialize:function(B,A){this.element=$(B);this.observer=A;this.lastValue=Sortable.serialize(this.element)},onStart:function(){this.lastValue=Sortable.serialize(this.element)},onEnd:function(){Sortable.unmark();if(this.lastValue!=Sortable.serialize(this.element)){this.observer(this.element)}}};var Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(A){while(A.tagName.toUpperCase()!="BODY"){if(A.id&&Sortable.sortables[A.id]){return A}A=A.parentNode}},options:function(A){A=Sortable._findRootElement($(A));if(!A){return }return Sortable.sortables[A.id]},destroy:function(A){var B=Sortable.options(A);if(B){Draggables.removeObserver(B.element);B.droppables.each(function(C){Droppables.remove(C)});B.draggables.invoke("destroy");delete Sortable.sortables[B.element.id]}},create:function(C){C=$(C);var B=Object.extend({element:C,tag:"li",dropOnEmpty:false,tree:false,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:C,handle:false,only:false,delay:0,hoverclass:null,ghosting:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:false,handles:false,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(C);var A={revert:true,quiet:B.quiet,scroll:B.scroll,scrollSpeed:B.scrollSpeed,scrollSensitivity:B.scrollSensitivity,delay:B.delay,ghosting:B.ghosting,constraint:B.constraint,handle:B.handle};if(B.starteffect){A.starteffect=B.starteffect}if(B.reverteffect){A.reverteffect=B.reverteffect}else{if(B.ghosting){A.reverteffect=function(F){F.style.top=0;F.style.left=0}}}if(B.endeffect){A.endeffect=B.endeffect}if(B.zindex){A.zindex=B.zindex}var D={overlap:B.overlap,containment:B.containment,tree:B.tree,hoverclass:B.hoverclass,onHover:Sortable.onHover};var E={onHover:Sortable.onEmptyHover,overlap:B.overlap,containment:B.containment,hoverclass:B.hoverclass};Element.cleanWhitespace(C);B.draggables=[];B.droppables=[];if(B.dropOnEmpty||B.tree){Droppables.add(C,E);B.droppables.push(C)}(B.elements||this.findElements(C,B)||[]).each(function(H,F){var G=B.handles?$(B.handles[F]):(B.handle?$(H).getElementsByClassName(B.handle)[0]:H);B.draggables.push(new Draggable(H,Object.extend(A,{handle:G})));Droppables.add(H,D);if(B.tree){H.treeNode=C}B.droppables.push(H)});if(B.tree){(Sortable.findTreeElements(C,B)||[]).each(function(F){Droppables.add(F,E);F.treeNode=C;B.droppables.push(F)})}this.sortables[C.id]=B;Draggables.addObserver(new SortableObserver(C,B.onUpdate))},findElements:function(B,A){return Element.findChildren(B,A.only,A.tree?true:false,A.tag)},findTreeElements:function(B,A){return Element.findChildren(B,A.only,A.tree?true:false,A.treeTag)},onHover:function(E,D,A){if(Element.isParent(D,E)){return }if(A>0.33&&A<0.66&&Sortable.options(D).tree){return }else{if(A>0.5){Sortable.mark(D,"before");if(D.previousSibling!=E){var B=E.parentNode;E.style.visibility="hidden";D.parentNode.insertBefore(E,D);if(D.parentNode!=B){Sortable.options(B).onChange(E)}Sortable.options(D.parentNode).onChange(E)}}else{Sortable.mark(D,"after");var C=D.nextSibling||null;if(C!=E){var B=E.parentNode;E.style.visibility="hidden";D.parentNode.insertBefore(E,C);if(D.parentNode!=B){Sortable.options(B).onChange(E)}Sortable.options(D.parentNode).onChange(E)}}}},onEmptyHover:function(E,G,H){var I=E.parentNode;var A=Sortable.options(G);if(!Element.isParent(G,E)){var F;var C=Sortable.findElements(G,{tag:A.tag,only:A.only});var B=null;if(C){var D=Element.offsetSize(G,A.overlap)*(1-H);for(F=0;F<C.length;F+=1){if(D-Element.offsetSize(C[F],A.overlap)>=0){D-=Element.offsetSize(C[F],A.overlap)}else{if(D-(Element.offsetSize(C[F],A.overlap)/2)>=0){B=F+1<C.length?C[F+1]:null;break}else{B=C[F];break}}}}G.insertBefore(E,B);Sortable.options(I).onChange(E);A.onChange(E)}},unmark:function(){if(Sortable._marker){Sortable._marker.hide()}},mark:function(B,A){var D=Sortable.options(B.parentNode);if(D&&!D.ghosting){return }if(!Sortable._marker){Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"});document.getElementsByTagName("body").item(0).appendChild(Sortable._marker)}var C=Position.cumulativeOffset(B);Sortable._marker.setStyle({left:C[0]+"px",top:C[1]+"px"});if(A=="after"){if(D.overlap=="horizontal"){Sortable._marker.setStyle({left:(C[0]+B.clientWidth)+"px"})}else{Sortable._marker.setStyle({top:(C[1]+B.clientHeight)+"px"})}}Sortable._marker.show()},_tree:function(E,B,F){var D=Sortable.findElements(E,B)||[];for(var C=0;C<D.length;++C){var A=D[C].id.match(B.format);if(!A){continue}var G={id:encodeURIComponent(A?A[1]:null),element:E,parent:F,children:[],position:F.children.length,container:$(D[C]).down(B.treeTag)};if(G.container){this._tree(G.container,B,G)}F.children.push(G)}return F},tree:function(D){D=$(D);var C=this.options(D);var B=Object.extend({tag:C.tag,treeTag:C.treeTag,only:C.only,name:D.id,format:C.format},arguments[1]||{});var A={id:null,parent:null,children:[],container:D,position:0};return Sortable._tree(D,B,A)},_constructIndex:function(B){var A="";do{if(B.id){A="["+B.position+"]"+A}}while((B=B.parent)!=null);return A},sequence:function(B){B=$(B);var A=Object.extend(this.options(B),arguments[1]||{});return $(this.findElements(B,A)||[]).map(function(C){return C.id.match(A.format)?C.id.match(A.format)[1]:""})},setSequence:function(B,C){B=$(B);var A=Object.extend(this.options(B),arguments[2]||{});var D={};this.findElements(B,A).each(function(E){if(E.id.match(A.format)){D[E.id.match(A.format)[1]]=[E,E.parentNode]}E.parentNode.removeChild(E)});C.each(function(E){var F=D[E];if(F){F[1].appendChild(F[0]);delete D[E]}})},serialize:function(C){C=$(C);var B=Object.extend(Sortable.options(C),arguments[1]||{});var A=encodeURIComponent((arguments[1]&&arguments[1].name)?arguments[1].name:C.id);if(B.tree){return Sortable.tree(C,arguments[1]).children.map(function(D){return[A+Sortable._constructIndex(D)+"[id]="+encodeURIComponent(D.id)].concat(D.children.map(arguments.callee))}).flatten().join("&")}else{return Sortable.sequence(C,arguments[1]).map(function(D){return A+"[]="+encodeURIComponent(D)}).join("&")}}};Element.isParent=function(B,A){if(!B.parentNode||B==A){return false}if(B.parentNode==A){return true}return Element.isParent(B.parentNode,A)};Element.findChildren=function(D,B,A,C){if(!D.hasChildNodes()){return null}C=C.toUpperCase();if(B){B=[B].flatten()}var E=[];$A(D.childNodes).each(function(G){if(G.tagName&&G.tagName.toUpperCase()==C&&(!B||(Element.classNames(G).detect(function(H){return B.include(H)})))){E.push(G)}if(A){var F=Element.findChildren(G,B,A,C);if(F){E.push(F)}}});return(E.length>0?E.flatten():[])};Element.offsetSize=function(A,B){return A["offset"+((B=="vertical"||B=="height")?"Height":"Width")]};if(!Control){var Control={}}Control.Slider=Class.create();Control.Slider.prototype={initialize:function(D,A,B){var C=this;if(D instanceof Array){this.handles=D.collect(function(E){return $(E)})}else{this.handles=[$(D)]}this.track=$(A);this.options=B||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1");this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(E){return $(E)}):false;this.options.startSpan=$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0");this.alignY=parseInt(this.options.alignY||"0");this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled()}this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false;if(this.allowedValues){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max()}this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.handles.each(function(F,E){E=C.handles.length-1-E;C.setValue(parseFloat((C.options.sliderValue instanceof Array?C.options.sliderValue[E]:C.options.sliderValue)||C.range.start),E);Element.makePositioned(F);Event.observe(F,"mousedown",C.eventMouseDown)});Event.observe(this.track,"mousedown",this.eventMouseDown);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);this.initialized=true},dispose:function(){var A=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(B){Event.stopObserving(B,"mousedown",A.eventMouseDown)})},setDisabled:function(){this.disabled=true},setEnabled:function(){this.disabled=false},getNearestValue:function(A){if(this.allowedValues){if(A>=this.allowedValues.max()){return(this.allowedValues.max())}if(A<=this.allowedValues.min()){return(this.allowedValues.min())}var C=Math.abs(this.allowedValues[0]-A);var B=this.allowedValues[0];this.allowedValues.each(function(D){var E=Math.abs(D-A);if(E<=C){B=D;C=E}});return B}if(A>this.range.end){return this.range.end}if(A<this.range.start){return this.range.start}return A},setValue:function(B,A){if(!this.active){this.activeHandleIdx=A||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles()}A=A||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((A>0)&&(B<this.values[A-1])){B=this.values[A-1]}if((A<(this.handles.length-1))&&(B>this.values[A+1])){B=this.values[A+1]}}B=this.getNearestValue(B);this.values[A]=B;this.value=this.values[0];this.handles[A].style[this.isVertical()?"top":"left"]=this.translateToPx(B);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished()}},setValueBy:function(B,A){this.setValue(this.values[A||this.activeHandleIdx||0]+B,A||this.activeHandleIdx||0)},translateToPx:function(A){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(A-this.range.start))+"px"},translateToValue:function(A){return((A/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start)},getRange:function(B){var A=this.values.sortBy(Prototype.K);B=B||0;return $R(A[B],A[B+1])},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX)},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignY)},isVertical:function(){return(this.axis=="vertical")},drawSpans:function(){var A=this;if(this.spans){$R(0,this.spans.length-1).each(function(B){A.setSpan(A.spans[B],A.getRange(B))})}if(this.options.startSpan){this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value))}if(this.options.endSpan){this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))}},setSpan:function(B,A){if(this.isVertical()){B.style.top=this.translateToPx(A.start);B.style.height=this.translateToPx(A.end-A.start+this.range.start)}else{B.style.left=this.translateToPx(A.start);B.style.width=this.translateToPx(A.end-A.start+this.range.start)}},updateStyles:function(){this.handles.each(function(A){Element.removeClassName(A,"selected")});Element.addClassName(this.activeHandle,"selected")},startDrag:function(C){if(Event.isLeftClick(C)){if(!this.disabled){this.active=true;var D=Event.element(C);var E=[Event.pointerX(C),Event.pointerY(C)];var A=D;if(A==this.track){var B=Position.cumulativeOffset(this.track);this.event=C;this.setValue(this.translateToValue((this.isVertical()?E[1]-B[1]:E[0]-B[0])-(this.handleLength/2)));var B=Position.cumulativeOffset(this.activeHandle);this.offsetX=(E[0]-B[0]);this.offsetY=(E[1]-B[1])}else{while((this.handles.indexOf(D)==-1)&&D.parentNode){D=D.parentNode}if(this.handles.indexOf(D)!=-1){this.activeHandle=D;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var B=Position.cumulativeOffset(this.activeHandle);this.offsetX=(E[0]-B[0]);this.offsetY=(E[1]-B[1])}}}Event.stop(C)}},update:function(A){if(this.active){if(!this.dragging){this.dragging=true}this.draw(A);if(Prototype.Browser.WebKit){window.scrollBy(0,0)}Event.stop(A)}},draw:function(B){var C=[Event.pointerX(B),Event.pointerY(B)];var A=Position.cumulativeOffset(this.track);C[0]-=this.offsetX+A[0];C[1]-=this.offsetY+A[1];this.event=B;this.setValue(this.translateToValue(this.isVertical()?C[1]:C[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this)}},endDrag:function(A){if(this.active&&this.dragging){this.finishDrag(A,true);Event.stop(A)}this.active=false;this.dragging=false},finishDrag:function(A,B){this.active=false;this.dragging=false;this.updateFinished()},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this)}this.event=null}};var MyClassFactory=function(){var A=null;function B(){var D="private variable accessed";function C(){alert("private method accessed")}this.getMyPrivateVar=function(){return D};this.myPublicVar="public var accessed";B.prototype.myPublicMethod=function(){alert("public method accessed")}}return new function(){this.getInstance=function(){if(A==null){A=new B();A.constructor=null}return A}}}();var myInstance=MyClassFactory.getInstance();myInstance.myPublicMethod();alert(myInstance.myPublicVar);alert(myInstance.getMyPrivateVar());myInstance.myPrivateMethod();alert(myInstance.myPrivateVar);var HelpBalloon=Class.create();HelpBalloon.prototype={initialize:function(A){this.options=Object.extend({returnElement:false,icon:"images/icon_info.gif",altText:"Click here for help with this topic",dataURL:null,title:"Title",content:"Content",duration:0.2,useEvent:["click"],imagePath:"images/",method:"get"},A||{});this._elements={container:null,inner:null,icon:null,content:null,button:null,title:null,bgContainer:null};this._properties={id:"HelpBalloon_"+Object.genGUID(),balloons:[this.options.imagePath+"balloon-tl.png",this.options.imagePath+"balloon-tr.png",this.options.imagePath+"balloon-bl.png",this.options.imagePath+"balloon-br.png"],balloonStyle:{position:"absolute",border:"none",background:"white",width:"300px",height:"240px",display:"none",zIndex:"3"},button:this.options.imagePath+"button.png",visible:false,balloonCoords:null,innerDims:[230,170],outerDims:[300,240],pointerDims:[20,20],innerMargin:15,buttonHeight:20,drawn:false,renderXY:[0,0]};for(var B=0;B<this._properties.balloons.length;B++){var C=document.createElement("img");C.src=this._properties.balloons[B]}this._elements.icon=document.createElement("img");this._elements.icon.src=this.options.icon;this._elements.icon.id=this._properties.id+"_icon";this._elements.icon._HelpBalloon=this;if(!this._elements.icon){return false}for(B=0;B<this.options.useEvent.length;B++){Event.observe(this._elements.icon,this.options.useEvent[B],this.toggle.bindAsEventListener(this))}this._elements.icon.style.cursor="pointer";this._elements.container=document.createElement("div");this._elements.container._HelpBalloon=this;if(!this.options.returnElement){document.write('<span id="'+this._properties.id+'"></span>');var E=$(this._properties.id);var D=E.parentNode;D.insertBefore(this._elements.icon,E);D.removeChild(E)}},toggle:function(B){if(!B){B=window.event||{type:this.options.useEvent,target:this._elements.icon}}var A=Event.element(B);if(B.type==this.options.useEvent&&!this._properties.visible&&A==this._elements.icon){this.show()}else{this.hide()}},show:function(){if(!this._properties.drawn){this._draw()}this._reposition();this._hideOtherHelps();Effect.Appear(this._elements.container,{duration:this.options.duration,afterFinish:function(A){this._elements.container.setStyle("display","block");this._hideLowerElements()}.bindAsEventListener(this)});this._properties.visible=true;Event.observe(window,"resize",this._reposition.bindAsEventListener(this))},hide:function(){this._showLowerElements();Effect.Fade(this._elements.container,{duration:this.options.duration});setTimeout(function(){this._elements.container.style.display="none"}.bind(this),this.options.duration*1000);this._properties.visible=false;Event.stopObserving(window,"resize",this._reposition.bindAsEventListener(this));return },_reposition:function(){this._properties.balloonCoords=this._getXY(this._elements.icon);this._properties.balloonCoords.x+=Math.round(this._elements.icon.width/2);this._properties.balloonCoords.y+=Math.round(this._elements.icon.height/2);var H=0;var I=this._properties.balloonCoords.x+parseInt(this._elements.container.style.width);var A=this._properties.balloonCoords.y-parseInt(this._elements.container.style.height);if(A>0){H+=2}var G=Browser.isMSIE()?document.body.clientWidth:window.outerWidth;if(I>G){H+=1}if(Browser.isMSIE()&&this._properties.balloons[H].toLowerCase().indexOf(".png")>-1){var F=false;if(!this._elements.bgContainer){F=true;this._elements.bgContainer=document.createElement("div")}this._elements.bgContainer.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+this._properties.balloons[H]+"', sizingMethod='crop')";this._elements.bgContainer.style.position="absolute";this._elements.bgContainer.style.left="0px";this._elements.bgContainer.style.top="0px";this._elements.bgContainer.style.width=this._elements.container.style.width;this._elements.bgContainer.style.height=this._elements.container.style.width;this._elements.bgContainer.style.zIndex=-1;F&&this._elements.container.appendChild(this._elements.bgContainer)}else{this._elements.container.style.backgroundImage="url("+this._properties.balloons[H]+")"}this._elements.container.style.backgroundRepeat="no-repeat";this._elements.container.style.backgroundColor="transparent";if(Browser.isMSIE()){this._elements.container.style.backgroundAttachment="fixed"}this._elements.container.style.backgroundPosition="top left";var E=0;var C=0;var D=0;var B=0;switch(H){case 1:E=this._properties.pointerDims[0];C=this._properties.pointerDims[1];D=this._properties.balloonCoords.x-parseInt(this._elements.container.style.width);B=this._properties.balloonCoords.y;break;case 2:E=this._properties.pointerDims[0];C=this._properties.pointerDims[1];D=this._properties.balloonCoords.x;B=this._properties.balloonCoords.y-parseInt(this._elements.container.style.height);break;case 3:E=this._properties.pointerDims[0];C=this._properties.pointerDims[1];D=this._properties.balloonCoords.x-parseInt(this._elements.container.style.width);B=this._properties.balloonCoords.y-parseInt(this._elements.container.style.height);break;default:case 0:E=this._properties.pointerDims[0];C=this._properties.pointerDims[1];D=this._properties.balloonCoords.x;B=this._properties.balloonCoords.y;break}this._elements.container.style.left=D+"px";this._elements.container.style.top=B+"px";if(this._elements.inner){this._elements.inner.style.left=(E+this._properties.innerMargin)+"px"}if(this._elements.inner){this._elements.inner.style.top=(C+this._properties.innerMargin)+"px"}},_draw:function(){Element.setStyle(this._elements.container,this._properties.balloonStyle);if(this.options.dataURL&&!this._properties.drawn){var A=new Ajax.Request(this.options.dataURL,{asynchronous:false,method:this.options.method});var D=false;if(A.transport.responseXML){var B=A.transport.responseXML.getElementsByTagName("HelpBalloon")[0];if(B){xmlTitle=B.getElementsByTagName("title")[0];if(xmlTitle){this.options.title=xmlTitle.firstChild.nodeValue}xmlContent=B.getElementsByTagName("content")[0];if(xmlContent){this.options.content=xmlContent.firstChild.nodeValue}}else{D=true}}else{D=true}if(D){var C=A.transport.responseText.match(/\<title\>([^\<]+)\<\/title\>/gi);if(C){C=C.toString().replace(/\<title\>|\<\/title\>/gi,"");this.options.title=C}this.options.content=A.transport.responseText}}this._elements.inner=document.createElement("div");this._elements.inner.style.position="absolute";this._elements.inner.style.width=this._properties.innerDims[0]+"px";this._elements.inner.style.height=this._properties.innerDims[1]+"px";var F=document.createElement("div");F.appendChild(document.createTextNode(this.options.title));F.style.fontFamily="verdana";F.style.fontSize="14px";F.style.fontWeight="bold";F.style.color="black";F.style.width=(this._properties.innerDims[0]-this._properties.buttonHeight)+"px";F.style.height=this._properties.buttonHeight+"px";F.style.position="absolute";F.style.overflow="hidden";F.style.top="0px";F.style.left="0px";this._elements.inner.appendChild(F);var G=null;if(Browser.isMSIE()&&this._properties.button.toLowerCase().indexOf(".png")>-1){G=document.createElement("div");G.style.width=this._properties.buttonHeight+"px";G.style.height=this._properties.buttonHeight+"px";G.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+this._properties.button+"', sizingMethod='crop')"}else{G=document.createElement("img");G.width=this._properties.buttonHeight;G.height=this._properties.buttonHeight;G.src=this._properties.button}Event.observe(G,"click",this.toggle.bindAsEventListener(this));G.style.cursor="pointer";G.title="Cerrar";G.style.position="absolute";G.style.top="0px";G.style.left=parseInt(F.style.width)+"px";this._elements.inner.appendChild(G);var E=document.createElement("div");E.style.width=this._properties.innerDims[0]+"px";E.style.height=(this._properties.innerDims[1]-parseInt(F.style.height))+"px";E.style.overflow="auto";E.style.position="absolute";E.style.top=parseInt(F.style.height)+"px";E.style.left="0px";E.style.fontFamily="verdana";E.style.fontSize="11px";E.style.fontWeight="normal";E.style.color="black";E.innerHTML=this.options.content;this._elements.inner.appendChild(E);this._elements.container.appendChild(this._elements.inner);document.getElementsByTagName("body")[0].appendChild(this._elements.container);this._properties.drawn=true},_getXY:function(D){var F=Position.cumulativeOffset(D);var E=F[1];var A=F[0];var B=A+parseInt(D.offsetWidth);var C=E+parseInt(D.offsetHeight);return{x:A,y:E,x2:B,y2:C}},_isChild:function(B){var A=15;do{if(B==this._elements.container){return true}B=B.parentNode}while(B&&A--);return false},_isOver:function(C){if(!this._properties.visible){return false}if(C==this._elements.container||this._isChild(C)){return false}var A=this._getXY(C);var B=this._getXY(this._elements.container);if((((A.x>=B.x&&A.x<=B.x2)||(A.x2>=B.x&&A.x2<=B.x2))&&((A.y>=B.y&&A.y<=B.y2)||(A.y2>=B.y&&A.y2<=B.y2)))){return true}else{return false}},_showLowerElements:function(){var B=this._getWeirdAPIElements();for(var A=0;A<B.length;A++){if(this._isOver(B[A])){if(B[A].style.visibility!="visible"&&B[A].hiddenBy==this){B[A].style.visibility="visible";B[A].hiddenBy=null}}}},_hideLowerElements:function(){var B=this._getWeirdAPIElements();for(var A=0;A<B.length;A++){if(this._isOver(B[A])){if(B[A].style.visibility!="hidden"){B[A].style.visibility="hidden";B[A].hiddenBy=this}}}},_getWeirdAPIElements:function(){if(!document.all){return[]}var E=["select","input","object"];var C=[];for(var B=0;B<E.length;B++){var D=document.getElementsByTagName(E[B]);for(var A=0;A<D.length;A++){C.push(D[A])}}return C},_hideOtherHelps:function(C){if(!C){C=window.event}var B=document.getElementsByTagName("div");for(var A=0;A<B.length;A++){if(B[A]._HelpBalloon&&B[A]._HelpBalloon._properties.visible&&(B[A]!=this._elements.container)){B[A]._HelpBalloon.toggle(C)}}}};var Prototype={Version:"1.5.1",Browser:{IE:!!(window.attachEvent&&!window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1},BrowserFeatures:{XPath:!!document.evaluate,ElementExtensions:!!window.HTMLElement,SpecificElementExtensions:(document.createElement("div").__proto__!==document.createElement("form").__proto__)},ScriptFragment:"<script[^>]*>([\u0001-\uFFFF]*?)<\/script>",JSONFilter:/^\/\*-secure-\s*(.*)\s*\*\/\s*$/,emptyFunction:function(){},K:function(A){return A}};var Class={create:function(){return function(){this.initialize.apply(this,arguments)}}};var Abstract=new Object();Object.extend=function(A,C){for(var B in C){A[B]=C[B]}return A};Object.extend(Object,{inspect:function(A){try{if(A===undefined){return"undefined"}if(A===null){return"null"}return A.inspect?A.inspect():A.toString()}catch(B){if(B instanceof RangeError){return"..."}throw B}},toJSON:function(A){var C=typeof A;switch(C){case"undefined":case"function":case"unknown":return ;case"boolean":return A.toString()}if(A===null){return"null"}if(A.toJSON){return A.toJSON()}if(A.ownerDocument===document){return }var B=[];for(var E in A){var D=Object.toJSON(A[E]);if(D!==undefined){B.push(E.toJSON()+": "+D)}}return"{"+B.join(", ")+"}"},keys:function(A){var B=[];for(var C in A){B.push(C)}return B},values:function(B){var A=[];for(var C in B){A.push(B[C])}return A},clone:function(A){return Object.extend({},A)}});Function.prototype.bind=function(){var A=this,C=$A(arguments),B=C.shift();return function(){return A.apply(B,C.concat($A(arguments)))}};Function.prototype.bindAsEventListener=function(C){var A=this,B=$A(arguments),C=B.shift();return function(D){return A.apply(C,[D||window.event].concat(B))}};Object.extend(Number.prototype,{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(A){$R(0,this,true).each(A);return this},toPaddedString:function(C,B){var A=this.toString(B||10);return"0".times(C-A.length)+A},toJSON:function(){return isFinite(this)?this.toString():"null"}});Date.prototype.toJSON=function(){return'"'+this.getFullYear()+"-"+(this.getMonth()+1).toPaddedString(2)+"-"+this.getDate().toPaddedString(2)+"T"+this.getHours().toPaddedString(2)+":"+this.getMinutes().toPaddedString(2)+":"+this.getSeconds().toPaddedString(2)+'"'};var Try={these:function(){var C;for(var B=0,D=arguments.length;B<D;B++){var A=arguments[B];try{C=A();break}catch(E){}}return C}};var PeriodicalExecuter=Class.create();PeriodicalExecuter.prototype={initialize:function(B,A){this.callback=B;this.frequency=A;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},stop:function(){if(!this.timer){return }clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.callback(this)}finally{this.currentlyExecuting=false}}}};Object.extend(String,{interpret:function(A){return A==null?"":String(A)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,{gsub:function(E,C){var A="",D=this,B;C=arguments.callee.prepareReplacement(C);while(D.length>0){if(B=D.match(E)){A+=D.slice(0,B.index);A+=String.interpret(C(B));D=D.slice(B.index+B[0].length)}else{A+=D,D=""}}return A},sub:function(C,A,B){A=this.gsub.prepareReplacement(A);B=B===undefined?1:B;return this.gsub(C,function(D){if(--B<0){return D[0]}return A(D)})},scan:function(B,A){this.gsub(B,A);return this},truncate:function(B,A){B=B||30;A=A===undefined?"...":A;return this.length>B?this.slice(0,B-A.length)+A:this},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var B=new RegExp(Prototype.ScriptFragment,"img");var A=new RegExp(Prototype.ScriptFragment,"im");return(this.match(B)||[]).map(function(C){return(C.match(A)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function(){var A=arguments.callee;A.text.data=this;return A.div.innerHTML},unescapeHTML:function(){var A=document.createElement("div");A.innerHTML=this.stripTags();return A.childNodes[0]?(A.childNodes.length>1?$A(A.childNodes).inject("",function(B,C){return B+C.nodeValue}):A.childNodes[0].nodeValue):""},toQueryParams:function(B){var A=this.strip().match(/([^?#]*)(#.*)?$/);if(!A){return{}}return A[1].split(B||"&").inject({},function(E,F){if((F=F.split("="))[0]){var C=decodeURIComponent(F.shift());var D=F.length>1?F.join("="):F[0];if(D!=undefined){D=decodeURIComponent(D)}if(C in E){if(E[C].constructor!=Array){E[C]=[E[C]]}E[C].push(D)}else{E[C]=D}}return E})},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(C){var A="";for(var B=0;B<C;B++){A+=this}return A},camelize:function(){var D=this.split("-"),A=D.length;if(A==1){return D[0]}var C=this.charAt(0)=="-"?D[0].charAt(0).toUpperCase()+D[0].substring(1):D[0];for(var B=1;B<A;B++){C+=D[B].charAt(0).toUpperCase()+D[B].substring(1)}return C},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(B){var A=this.gsub(/[\x00-\x1f\\]/,function(C){var D=String.specialChar[C[0]];return D?D:"\\u00"+C[0].charCodeAt().toPaddedString(2,16)});if(B){return'"'+A.replace(/"/g,'\\"')+'"'}return"'"+A.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(true)},unfilterJSON:function(A){return this.sub(A||Prototype.JSONFilter,"#{1}")},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||(/^("(\\.|[^"\\\n\r])*?"|[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t])+?$/.test(json))){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())},include:function(A){return this.indexOf(A)>-1},startsWith:function(A){return this.indexOf(A)===0},endsWith:function(A){var B=this.length-A.length;return B>=0&&this.lastIndexOf(A)===B},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)}});if(Prototype.Browser.WebKit||Prototype.Browser.IE){Object.extend(String.prototype,{escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")}})}String.prototype.gsub.prepareReplacement=function(B){if(typeof B=="function"){return B}var A=new Template(B);return function(C){return A.evaluate(C)}};String.prototype.parseQuery=String.prototype.toQueryParams;Object.extend(String.prototype.escapeHTML,{div:document.createElement("div"),text:document.createTextNode("")});with(String.prototype.escapeHTML){div.appendChild(text)}var Template=Class.create();Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;Template.prototype={initialize:function(A,B){this.template=A.toString();this.pattern=B||Template.Pattern},evaluate:function(A){return this.template.gsub(this.pattern,function(B){var C=B[1];if(C=="\\"){return B[2]}return C+String.interpret(A[B[3]])})}};var $break={},$continue=new Error('"throw $continue" is deprecated, use "return" instead');var Enumerable={each:function(B){var A=0;try{this._each(function(D){B(D,A++)})}catch(C){if(C!=$break){throw C}}return this},eachSlice:function(C,B){var A=-C,D=[],E=this.toArray();while((A+=C)<E.length){D.push(E.slice(A,A+C))}return D.map(B)},all:function(B){var A=true;this.each(function(D,C){A=A&&!!(B||Prototype.K)(D,C);if(!A){throw $break}});return A},any:function(B){var A=false;this.each(function(D,C){if(A=!!(B||Prototype.K)(D,C)){throw $break}});return A},collect:function(B){var A=[];this.each(function(D,C){A.push((B||Prototype.K)(D,C))});return A},detect:function(B){var A;this.each(function(D,C){if(B(D,C)){A=D;throw $break}});return A},findAll:function(B){var A=[];this.each(function(D,C){if(B(D,C)){A.push(D)}});return A},grep:function(C,B){var A=[];this.each(function(F,E){var D=F.toString();if(D.match(C)){A.push((B||Prototype.K)(F,E))}});return A},include:function(A){var B=false;this.each(function(C){if(C==A){B=true;throw $break}});return B},inGroupsOf:function(B,A){A=A===undefined?null:A;return this.eachSlice(B,function(C){while(C.length<B){C.push(A)}return C})},inject:function(A,B){this.each(function(D,C){A=B(A,D,C)});return A},invoke:function(B){var A=$A(arguments).slice(1);return this.map(function(C){return C[B].apply(C,A)})},max:function(B){var A;this.each(function(D,C){D=(B||Prototype.K)(D,C);if(A==undefined||D>=A){A=D}});return A},min:function(B){var A;this.each(function(D,C){D=(B||Prototype.K)(D,C);if(A==undefined||D<A){A=D}});return A},partition:function(C){var B=[],A=[];this.each(function(E,D){((C||Prototype.K)(E,D)?B:A).push(E)});return[B,A]},pluck:function(B){var A=[];this.each(function(D,C){A.push(D[B])});return A},reject:function(B){var A=[];this.each(function(D,C){if(!B(D,C)){A.push(D)}});return A},sortBy:function(A){return this.map(function(C,B){return{value:C,criteria:A(C,B)}}).sort(function(E,D){var C=E.criteria,B=D.criteria;return C<B?-1:C>B?1:0}).pluck("value")},toArray:function(){return this.map()},zip:function(){var B=Prototype.K,A=$A(arguments);if(typeof A.last()=="function"){B=A.pop()}var C=[this].concat(A).map($A);return this.map(function(E,D){return B(C.pluck(D))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray});var $A=Array.from=function(D){if(!D){return[]}if(D.toArray){return D.toArray()}else{var B=[];for(var A=0,C=D.length;A<C;A++){B.push(D[A])}return B}};if(Prototype.Browser.WebKit){$A=Array.from=function(D){if(!D){return[]}if(!(typeof D=="function"&&D=="[object NodeList]")&&D.toArray){return D.toArray()}else{var B=[];for(var A=0,C=D.length;A<C;A++){B.push(D[A])}return B}}}Object.extend(Array.prototype,Enumerable);if(!Array.prototype._reverse){Array.prototype._reverse=Array.prototype.reverse}Object.extend(Array.prototype,{_each:function(B){for(var A=0,C=this.length;A<C;A++){B(this[A])}},clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(A){return A!=null})},flatten:function(){return this.inject([],function(B,A){return B.concat(A&&A.constructor==Array?A.flatten():[A])})},without:function(){var A=$A(arguments);return this.select(function(B){return !A.include(B)})},indexOf:function(A){for(var B=0,C=this.length;B<C;B++){if(this[B]==A){return B}}return -1},reverse:function(A){return(A!==false?this:this.toArray())._reverse()},reduce:function(){return this.length>1?this:this[0]},uniq:function(A){return this.inject([],function(D,C,B){if(0==B||(A?D.last()!=C:!D.include(C))){D.push(C)}return D})},clone:function(){return[].concat(this)},size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"},toJSON:function(){var A=[];this.each(function(B){var C=Object.toJSON(B);if(C!==undefined){A.push(C)}});return"["+A.join(", ")+"]"}});Array.prototype.toArray=Array.prototype.clone;function $w(A){A=A.strip();return A?A.split(/\s+/):[]}if(Prototype.Browser.Opera){Array.prototype.concat=function(){var E=[];for(var B=0,C=this.length;B<C;B++){E.push(this[B])}for(var B=0,C=arguments.length;B<C;B++){if(arguments[B].constructor==Array){for(var A=0,D=arguments[B].length;A<D;A++){E.push(arguments[B][A])}}else{E.push(arguments[B])}}return E}}var Hash=function(A){if(A instanceof Hash){this.merge(A)}else{Object.extend(this,A||{})}};Object.extend(Hash,{toQueryString:function(B){var A=[];A.add=arguments.callee.addPair;this.prototype._each.call(B,function(D){if(!D.key){return }var C=D.value;if(C&&typeof C=="object"){if(C.constructor==Array){C.each(function(E){A.add(D.key,E)})}return }A.add(D.key,C)});return A.join("&")},toJSON:function(A){var B=[];this.prototype._each.call(A,function(D){var C=Object.toJSON(D.value);if(C!==undefined){B.push(D.key.toJSON()+": "+C)}});return"{"+B.join(", ")+"}"}});Hash.toQueryString.addPair=function(A,C,B){A=encodeURIComponent(A);if(C===undefined){this.push(A)}else{this.push(A+"="+(C==null?"":encodeURIComponent(C)))}};Object.extend(Hash.prototype,Enumerable);Object.extend(Hash.prototype,{_each:function(B){for(var A in this){var C=this[A];if(C&&C==Hash.prototype[A]){continue}var D=[A,C];D.key=A;D.value=C;B(D)}},keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},merge:function(A){return $H(A).inject(this,function(B,C){B[C.key]=C.value;return B})},remove:function(){var A;for(var B=0,C=arguments.length;B<C;B++){var D=this[arguments[B]];if(D!==undefined){if(A===undefined){A=D}else{if(A.constructor!=Array){A=[A]}A.push(D)}}delete this[arguments[B]]}return A},toQueryString:function(){return Hash.toQueryString(this)},inspect:function(){return"#<Hash:{"+this.map(function(A){return A.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:function(){return Hash.toJSON(this)}});function $H(A){if(A instanceof Hash){return A}return new Hash(A)}if(function(){var A=0,C=function(D){this.key=D};C.prototype.key="foo";for(var B in new C("bar")){A++}return A>1}()){Hash.prototype._each=function(C){var A=[];for(var B in this){var D=this[B];if((D&&D==Hash.prototype[B])||A.include(B)){continue}A.push(B);var E=[B,D];E.key=B;E.value=D;C(E)}}}ObjectRange=Class.create();Object.extend(ObjectRange.prototype,Enumerable);Object.extend(ObjectRange.prototype,{initialize:function(C,A,B){this.start=C;this.end=A;this.exclusive=B},_each:function(A){var B=this.start;while(this.include(B)){A(B);B=B.succ()}},include:function(A){if(A<this.start){return false}if(this.exclusive){return A<this.end}return A<=this.end}});var $R=function(C,A,B){return new ObjectRange(C,A,B)};var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(A){this.responders._each(A)},register:function(A){if(!this.include(A)){this.responders.push(A)}},unregister:function(A){this.responders=this.responders.without(A)},dispatch:function(D,B,C,A){this.each(function(E){if(typeof E[D]=="function"){try{E[D].apply(E,[B,C,A])}catch(F){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=function(){};Ajax.Base.prototype={setOptions:function(A){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:""};Object.extend(this.options,A||{});this.options.method=this.options.method.toLowerCase();if(typeof this.options.parameters=="string"){this.options.parameters=this.options.parameters.toQueryParams()}}};Ajax.Request=Class.create();Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Request.prototype=Object.extend(new Ajax.Base(),{_complete:false,initialize:function(B,A){this.transport=Ajax.getTransport();this.setOptions(A);this.request(B)},request:function(A){this.url=A;this.method=this.options.method;var C=Object.clone(this.options.parameters);if(!["get","post"].include(this.method)){C._method=this.method;this.method="post"}this.parameters=C;if(C=Hash.toQueryString(C)){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+C}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){C+="&_="}}}try{if(this.options.onCreate){this.options.onCreate(this.transport)}Ajax.Responders.dispatch("onCreate",this,this.transport);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){setTimeout(function(){this.respondToReadyState(1)}.bind(this),10)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||C):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(B){this.dispatchException(B)}},onStateChange:function(){var A=this.transport.readyState;if(A>1&&!((A==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var E={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){E["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){E.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var C=this.options.requestHeaders;if(typeof C.push=="function"){for(var B=0,D=C.length;B<D;B+=2){E[C[B]]=C[B+1]}}else{$H(C).each(function(F){E[F.key]=F.value})}}for(var A in E){this.transport.setRequestHeader(A,E[A])}},success:function(){return !this.transport.status||(this.transport.status>=200&&this.transport.status<300)},respondToReadyState:function(A){var C=Ajax.Request.Events[A];var F=this.transport,B=this.evalJSON();if(C=="Complete"){try{this._complete=true;(this.options["on"+this.transport.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(F,B)}catch(D){this.dispatchException(D)}var E=this.getHeader("Content-type");if(E&&E.strip().match(/^(text|application)\/(x-)?(java|ecma)script(;.*)?$/i)){this.evalResponse()}}try{(this.options["on"+C]||Prototype.emptyFunction)(F,B);Ajax.Responders.dispatch("on"+C,this,F,B)}catch(D){this.dispatchException(D)}if(C=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},getHeader:function(A){try{return this.transport.getResponseHeader(A)}catch(B){return null}},evalJSON:function(){try{var A=this.getHeader("X-JSON");return A?A.evalJSON():null}catch(B){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(A){(this.options.onException||Prototype.emptyFunction)(this,A);Ajax.Responders.dispatch("onException",this,A)}});Ajax.Updater=Class.create();Object.extend(Object.extend(Ajax.Updater.prototype,Ajax.Request.prototype),{initialize:function(A,C,B){this.container={success:(A.success||A),failure:(A.failure||(A.success?null:A))};this.transport=Ajax.getTransport();this.setOptions(B);var D=this.options.onComplete||Prototype.emptyFunction;this.options.onComplete=(function(F,E){this.updateContent();D(F,E)}).bind(this);this.request(C)},updateContent:function(){var B=this.container[this.success()?"success":"failure"];var A=this.transport.responseText;if(!this.options.evalScripts){A=A.stripScripts()}if(B=$(B)){if(this.options.insertion){new this.options.insertion(B,A)}else{B.update(A)}}if(this.success()){if(this.onComplete){setTimeout(this.onComplete.bind(this),10)}}}});Ajax.PeriodicalUpdater=Class.create();Ajax.PeriodicalUpdater.prototype=Object.extend(new Ajax.Base(),{initialize:function(A,C,B){this.setOptions(B);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=A;this.url=C;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(A){if(this.options.decay){this.decay=(A.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=A.responseText}this.timer=setTimeout(this.onTimerEvent.bind(this),this.decay*this.frequency*1000)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});function $(B){if(arguments.length>1){for(var A=0,D=[],C=arguments.length;A<C;A++){D.push($(arguments[A]))}return D}if(typeof B=="string"){B=document.getElementById(B)}return Element.extend(B)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(F,A){var C=[];var E=document.evaluate(F,$(A)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var B=0,D=E.snapshotLength;B<D;B++){C.push(E.snapshotItem(B))}return C};document.getElementsByClassName=function(B,A){var C=".//*[contains(concat(' ', @class, ' '), ' "+B+" ')]";return document._getElementsByXPath(C,A)}}else{document.getElementsByClassName=function(D,A){var C=($(A)||document.body).getElementsByTagName("*");var F=[],G;for(var B=0,E=C.length;B<E;B++){G=C[B];if(Element.hasClassName(G,D)){F.push(Element.extend(G))}}return F}}if(!window.Element){var Element={}}Element.extend=function(E){var G=Prototype.BrowserFeatures;if(!E||!E.tagName||E.nodeType==3||E._extended||G.SpecificElementExtensions||E==window){return E}var B={},D=E.tagName,A=Element.extend.cache,C=Element.Methods.ByTag;if(!G.ElementExtensions){Object.extend(B,Element.Methods),Object.extend(B,Element.Methods.Simulated)}if(C[D]){Object.extend(B,C[D])}for(var I in B){var H=B[I];if(typeof H=="function"&&!(I in E)){E[I]=A.findOrStore(H)}}E._extended=Prototype.emptyFunction;return E};Element.extend.cache={findOrStore:function(A){return this[A]=this[A]||function(){return A.apply(null,[this].concat($A(arguments)))}}};Element.Methods={visible:function(A){return $(A).style.display!="none"},toggle:function(A){A=$(A);Element[Element.visible(A)?"hide":"show"](A);return A},hide:function(A){$(A).style.display="none";return A},show:function(A){$(A).style.display="";return A},remove:function(A){A=$(A);A.parentNode.removeChild(A);return A},update:function(B,A){A=typeof A=="undefined"?"":A.toString();$(B).innerHTML=A.stripScripts();setTimeout(function(){A.evalScripts()},10);return B},replace:function(C,B){C=$(C);B=typeof B=="undefined"?"":B.toString();if(C.outerHTML){C.outerHTML=B.stripScripts()}else{var A=C.ownerDocument.createRange();A.selectNodeContents(C);C.parentNode.replaceChild(A.createContextualFragment(B.stripScripts()),C)}setTimeout(function(){B.evalScripts()},10);return C},inspect:function(B){B=$(B);var A="<"+B.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(F){var E=F.first(),C=F.last();var D=(B[E]||"").toString();if(D){A+=" "+C+"="+D.inspect(true)}});return A+">"},recursivelyCollect:function(A,C){A=$(A);var B=[];while(A=A[C]){if(A.nodeType==1){B.push(Element.extend(A))}}return B},ancestors:function(A){return $(A).recursivelyCollect("parentNode")},descendants:function(A){return $A($(A).getElementsByTagName("*")).each(Element.extend)},firstDescendant:function(A){A=$(A).firstChild;while(A&&A.nodeType!=1){A=A.nextSibling}return $(A)},immediateDescendants:function(A){if(!(A=$(A).firstChild)){return[]}while(A&&A.nodeType!=1){A=A.nextSibling}if(A){return[A].concat($(A).nextSiblings())}return[]},previousSiblings:function(A){return $(A).recursivelyCollect("previousSibling")},nextSiblings:function(A){return $(A).recursivelyCollect("nextSibling")},siblings:function(A){A=$(A);return A.previousSiblings().reverse().concat(A.nextSiblings())},match:function(B,A){if(typeof A=="string"){A=new Selector(A)}return A.match($(B))},up:function(B,D,A){B=$(B);if(arguments.length==1){return $(B.parentNode)}var C=B.ancestors();return D?Selector.findElement(C,D,A):C[A||0]},down:function(B,C,A){B=$(B);if(arguments.length==1){return B.firstDescendant()}var D=B.descendants();return C?Selector.findElement(D,C,A):D[A||0]},previous:function(B,D,A){B=$(B);if(arguments.length==1){return $(Selector.handlers.previousElementSibling(B))}var C=B.previousSiblings();return D?Selector.findElement(C,D,A):C[A||0]},next:function(C,D,B){C=$(C);if(arguments.length==1){return $(Selector.handlers.nextElementSibling(C))}var A=C.nextSiblings();return D?Selector.findElement(A,D,B):A[B||0]},getElementsBySelector:function(){var A=$A(arguments),B=$(A.shift());return Selector.findChildElements(B,A)},getElementsByClassName:function(A,B){return document.getElementsByClassName(B,A)},readAttribute:function(C,A){C=$(C);if(Prototype.Browser.IE){if(!C.attributes){return null}var B=Element._attributeTranslations;if(B.values[A]){return B.values[A](C,A)}if(B.names[A]){A=B.names[A]}var D=C.attributes[A];return D?D.nodeValue:null}return C.getAttribute(A)},getHeight:function(A){return $(A).getDimensions().height},getWidth:function(A){return $(A).getDimensions().width},classNames:function(A){return new Element.ClassNames(A)},hasClassName:function(A,B){if(!(A=$(A))){return }var C=A.className;if(C.length==0){return false}if(C==B||C.match(new RegExp("(^|\\s)"+B+"(\\s|$)"))){return true}return false},addClassName:function(A,B){if(!(A=$(A))){return }Element.classNames(A).add(B);return A},removeClassName:function(A,B){if(!(A=$(A))){return }Element.classNames(A).remove(B);return A},toggleClassName:function(A,B){if(!(A=$(A))){return }Element.classNames(A)[A.hasClassName(B)?"remove":"add"](B);return A},observe:function(){Event.observe.apply(Event,arguments);return $A(arguments).first()},stopObserving:function(){Event.stopObserving.apply(Event,arguments);return $A(arguments).first()},cleanWhitespace:function(B){B=$(B);var C=B.firstChild;while(C){var A=C.nextSibling;if(C.nodeType==3&&!/\S/.test(C.nodeValue)){B.removeChild(C)}C=A}return B},empty:function(A){return $(A).innerHTML.blank()},descendantOf:function(B,A){B=$(B),A=$(A);while(B=B.parentNode){if(B==A){return true}}return false},scrollTo:function(A){A=$(A);var B=Position.cumulativeOffset(A);window.scrollTo(B[0],B[1]);return A},getStyle:function(B,C){B=$(B);C=C=="float"?"cssFloat":C.camelize();var D=B.style[C];if(!D){var A=document.defaultView.getComputedStyle(B,null);D=A?A[C]:null}if(C=="opacity"){return D?parseFloat(D):1}return D=="auto"?null:D},getOpacity:function(A){return $(A).getStyle("opacity")},setStyle:function(A,C,B){A=$(A);var E=A.style;for(var D in C){if(D=="opacity"){A.setOpacity(C[D])}else{E[(D=="float"||D=="cssFloat")?(E.styleFloat===undefined?"cssFloat":"styleFloat"):(B?D:D.camelize())]=C[D]}}return A},setOpacity:function(A,B){A=$(A);A.style.opacity=(B==1||B==="")?"":(B<0.00001)?0:B;return A},getDimensions:function(C){C=$(C);var G=$(C).getStyle("display");if(G!="none"&&G!=null){return{width:C.offsetWidth,height:C.offsetHeight}}var B=C.style;var F=B.visibility;var D=B.position;var A=B.display;B.visibility="hidden";B.position="absolute";B.display="block";var H=C.clientWidth;var E=C.clientHeight;B.display=A;B.position=D;B.visibility=F;return{width:H,height:E}},makePositioned:function(A){A=$(A);var B=Element.getStyle(A,"position");if(B=="static"||!B){A._madePositioned=true;A.style.position="relative";if(window.opera){A.style.top=0;A.style.left=0}}return A},undoPositioned:function(A){A=$(A);if(A._madePositioned){A._madePositioned=undefined;A.style.position=A.style.top=A.style.left=A.style.bottom=A.style.right=""}return A},makeClipping:function(A){A=$(A);if(A._overflow){return A}A._overflow=A.style.overflow||"auto";if((Element.getStyle(A,"overflow")||"visible")!="hidden"){A.style.overflow="hidden"}return A},undoClipping:function(A){A=$(A);if(!A._overflow){return A}A.style.overflow=A._overflow=="auto"?"":A._overflow;A._overflow=null;return A}};Object.extend(Element.Methods,{childOf:Element.Methods.descendantOf,childElements:Element.Methods.immediateDescendants});if(Prototype.Browser.Opera){Element.Methods._getStyle=Element.Methods.getStyle;Element.Methods.getStyle=function(A,B){switch(B){case"left":case"top":case"right":case"bottom":if(Element._getStyle(A,"position")=="static"){return null}default:return Element._getStyle(A,B)}}}else{if(Prototype.Browser.IE){Element.Methods.getStyle=function(A,B){A=$(A);B=(B=="float"||B=="cssFloat")?"styleFloat":B.camelize();var C=A.style[B];if(!C&&A.currentStyle){C=A.currentStyle[B]}if(B=="opacity"){if(C=(A.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(C[1]){return parseFloat(C[1])/100}}return 1}if(C=="auto"){if((B=="width"||B=="height")&&(A.getStyle("display")!="none")){return A["offset"+B.capitalize()]+"px"}return null}return C};Element.Methods.setOpacity=function(A,D){A=$(A);var C=A.getStyle("filter"),B=A.style;if(D==1||D===""){B.filter=C.replace(/alpha\([^\)]*\)/gi,"");return A}else{if(D<0.00001){D=0}}B.filter=C.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+(D*100)+")";return A};Element.Methods.update=function(C,B){C=$(C);B=typeof B=="undefined"?"":B.toString();var A=C.tagName.toUpperCase();if(["THEAD","TBODY","TR","TD"].include(A)){var D=document.createElement("div");switch(A){case"THEAD":case"TBODY":D.innerHTML="<table><tbody>"+B.stripScripts()+"</tbody></table>";depth=2;break;case"TR":D.innerHTML="<table><tbody><tr>"+B.stripScripts()+"</tr></tbody></table>";depth=3;break;case"TD":D.innerHTML="<table><tbody><tr><td>"+B.stripScripts()+"</td></tr></tbody></table>";depth=4}$A(C.childNodes).each(function(E){C.removeChild(E)});depth.times(function(){D=D.firstChild});$A(D.childNodes).each(function(E){C.appendChild(E)})}else{C.innerHTML=B.stripScripts()}setTimeout(function(){B.evalScripts()},10);return C}}else{if(Prototype.Browser.Gecko){Element.Methods.setOpacity=function(A,B){A=$(A);A.style.opacity=(B==1)?0.999999:(B==="")?"":(B<0.00001)?0:B;return A}}}}Element._attributeTranslations={names:{colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",datetime:"dateTime",accesskey:"accessKey",tabindex:"tabIndex",enctype:"encType",maxlength:"maxLength",readonly:"readOnly",longdesc:"longDesc"},values:{_getAttr:function(A,B){return A.getAttribute(B,2)},_flag:function(A,B){return $(A).hasAttribute(B)?B:null},style:function(A){return A.style.cssText.toLowerCase()},title:function(A){var B=A.getAttributeNode("title");return B.specified?B.nodeValue:null}}};(function(){Object.extend(this,{href:this._getAttr,src:this._getAttr,type:this._getAttr,disabled:this._flag,checked:this._flag,readonly:this._flag,multiple:this._flag})}).call(Element._attributeTranslations.values);Element.Methods.Simulated={hasAttribute:function(B,D){var A=Element._attributeTranslations,C;D=A.names[D]||D;C=$(B).getAttributeNode(D);return C&&C.specified}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);if(!Prototype.BrowserFeatures.ElementExtensions&&document.createElement("div").__proto__){window.HTMLElement={};window.HTMLElement.prototype=document.createElement("div").__proto__;Prototype.BrowserFeatures.ElementExtensions=true}Element.hasAttribute=function(A,B){if(A.hasAttribute){return A.hasAttribute(B)}return Element.Methods.Simulated.hasAttribute(A,B)};Element.addMethods=function(C){var I=Prototype.BrowserFeatures,D=Element.Methods.ByTag;if(!C){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var B=C;C=arguments[1]}if(!B){Object.extend(Element.Methods,C||{})}else{if(B.constructor==Array){B.each(H)}else{H(B)}}function H(F){F=F.toUpperCase();if(!Element.Methods.ByTag[F]){Element.Methods.ByTag[F]={}}Object.extend(Element.Methods.ByTag[F],C)}function A(M,K,F){F=F||false;var L=Element.extend.cache;for(var O in M){var N=M[O];if(!F||!(O in K)){K[O]=L.findOrStore(N)}}}function E(L){var F;var K={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(K[L]){F="HTML"+K[L]+"Element"}if(window[F]){return window[F]}F="HTML"+L+"Element";if(window[F]){return window[F]}F="HTML"+L.capitalize()+"Element";if(window[F]){return window[F]}window[F]={};window[F].prototype=document.createElement(L).__proto__;return window[F]}if(I.ElementExtensions){A(Element.Methods,HTMLElement.prototype);A(Element.Methods.Simulated,HTMLElement.prototype,true)}if(I.SpecificElementExtensions){for(var J in Element.Methods.ByTag){var G=E(J);if(typeof G=="undefined"){continue}A(D[J],G.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag};var Toggle={display:Element.toggle};Abstract.Insertion=function(A){this.adjacency=A};Abstract.Insertion.prototype={initialize:function(B,C){this.element=$(B);this.content=C.stripScripts();if(this.adjacency&&this.element.insertAdjacentHTML){try{this.element.insertAdjacentHTML(this.adjacency,this.content)}catch(D){var A=this.element.tagName.toUpperCase();if(["TBODY","TR"].include(A)){this.insertContent(this.contentFromAnonymousTable())}else{throw D}}}else{this.range=this.element.ownerDocument.createRange();if(this.initializeRange){this.initializeRange()}this.insertContent([this.range.createContextualFragment(this.content)])}setTimeout(function(){C.evalScripts()},10)},contentFromAnonymousTable:function(){var A=document.createElement("div");A.innerHTML="<table><tbody>"+this.content+"</tbody></table>";return $A(A.childNodes[0].childNodes[0].childNodes)}};var Insertion=new Object();Insertion.Before=Class.create();Insertion.Before.prototype=Object.extend(new Abstract.Insertion("beforeBegin"),{initializeRange:function(){this.range.setStartBefore(this.element)},insertContent:function(A){A.each((function(B){this.element.parentNode.insertBefore(B,this.element)}).bind(this))}});Insertion.Top=Class.create();Insertion.Top.prototype=Object.extend(new Abstract.Insertion("afterBegin"),{initializeRange:function(){this.range.selectNodeContents(this.element);this.range.collapse(true)},insertContent:function(A){A.reverse(false).each((function(B){this.element.insertBefore(B,this.element.firstChild)}).bind(this))}});Insertion.Bottom=Class.create();Insertion.Bottom.prototype=Object.extend(new Abstract.Insertion("beforeEnd"),{initializeRange:function(){this.range.selectNodeContents(this.element);this.range.collapse(this.element)},insertContent:function(A){A.each((function(B){this.element.appendChild(B)}).bind(this))}});Insertion.After=Class.create();Insertion.After.prototype=Object.extend(new Abstract.Insertion("afterEnd"),{initializeRange:function(){this.range.setStartAfter(this.element)},insertContent:function(A){A.each((function(B){this.element.parentNode.insertBefore(B,this.element.nextSibling)}).bind(this))}});Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(A){this.element=$(A)},_each:function(A){this.element.className.split(/\s+/).select(function(B){return B.length>0})._each(A)},set:function(A){this.element.className=A},add:function(A){if(this.include(A)){return }this.set($A(this).concat(A).join(" "))},remove:function(A){if(!this.include(A)){return }this.set($A(this).without(A).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);var Selector=Class.create();Selector.prototype={initialize:function(A){this.expression=A.strip();this.compileMatcher()},compileMatcher:function(){if(Prototype.BrowserFeatures.XPath&&!(/\[[\w-]*?:/).test(this.expression)){return this.compileXPathMatcher()}var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m;if(Selector._cache[e]){this.matcher=Selector._cache[e];return }this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in ps){p=ps[i];if(m=e.match(p)){this.matcher.push(typeof c[i]=="function"?c[i](m):new Template(c[i]).evaluate(m));e=e.replace(m[0],"");break}}}this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join("\n"));Selector._cache[this.expression]=this.matcher},compileXPathMatcher:function(){var E=this.expression,F=Selector.patterns,B=Selector.xpath,D,A;if(Selector._cache[E]){this.xpath=Selector._cache[E];return }this.matcher=[".//*"];while(E&&D!=E&&(/\S/).test(E)){D=E;for(var C in F){if(A=E.match(F[C])){this.matcher.push(typeof B[C]=="function"?B[C](A):new Template(B[C]).evaluate(A));E=E.replace(A[0],"");break}}}this.xpath=this.matcher.join("");Selector._cache[this.expression]=this.xpath},findElements:function(A){A=A||document;if(this.xpath){return document._getElementsByXPath(this.xpath,A)}return this.matcher(A)},match:function(A){return this.findElements(document).include(A)},toString:function(){return this.expression},inspect:function(){return"#<Selector:"+this.expression.inspect()+">"}};Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:"/following-sibling::*",tagName:function(A){if(A[1]=="*"){return""}return"[local-name()='"+A[1].toLowerCase()+"' or local-name()='"+A[1].toUpperCase()+"']"},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:"[@#{1}]",attr:function(A){A[3]=A[5]||A[6];return new Template(Selector.xpath.operators[A[2]]).evaluate(A)},pseudo:function(A){var B=Selector.xpath.pseudos[A[1]];if(!B){return""}if(typeof B==="function"){return B(A)}return new Template(Selector.xpath.pseudos[A[1]]).evaluate(A)},operators:{"=":"[@#{1}='#{3}']","!=":"[@#{1}!='#{3}']","^=":"[starts-with(@#{1}, '#{3}')]","$=":"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']","*=":"[contains(@#{1}, '#{3}')]","~=":"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]","|=":"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{"first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","only-child":"[not(preceding-sibling::* or following-sibling::*)]",empty:"[count(*) = 0 and (count(text()) = 0 or translate(text(), ' \t\r\n', '') = '')]",checked:"[@checked]",disabled:"[@disabled]",enabled:"[not(@disabled)]",not:function(B){var H=B[6],G=Selector.patterns,A=Selector.xpath,E,B,C;var F=[];while(H&&E!=H&&(/\S/).test(H)){E=H;for(var D in G){if(B=H.match(G[D])){C=typeof A[D]=="function"?A[D](B):new Template(A[D]).evaluate(B);F.push("("+C.substring(1,C.length-1)+")");H=H.replace(B[0],"");break}}}return"[not("+F.join(" and ")+")]"},"nth-child":function(A){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",A)},"nth-last-child":function(A){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",A)},"nth-of-type":function(A){return Selector.xpath.pseudos.nth("position() ",A)},"nth-last-of-type":function(A){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",A)},"first-of-type":function(A){A[6]="1";return Selector.xpath.pseudos["nth-of-type"](A)},"last-of-type":function(A){A[6]="1";return Selector.xpath.pseudos["nth-last-of-type"](A)},"only-of-type":function(A){var B=Selector.xpath.pseudos;return B["first-of-type"](A)+B["last-of-type"](A)},nth:function(E,C){var F,G=C[6],B;if(G=="even"){G="2n+0"}if(G=="odd"){G="2n+1"}if(F=G.match(/^(\d+)$/)){return"["+E+"= "+F[1]+"]"}if(F=G.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(F[1]=="-"){F[1]=-1}var D=F[1]?Number(F[1]):1;var A=F[2]?Number(F[2]):0;B="[((#{fragment} - #{b}) mod #{a} = 0) and ((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(B).evaluate({fragment:E,a:D,b:A})}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);   c = false;',className:'n = h.className(n, r, "#{1}", c); c = false;',id:'n = h.id(n, r, "#{1}", c);        c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}"); c = false;',attr:function(A){A[3]=(A[5]||A[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}"); c = false;').evaluate(A)},pseudo:function(A){if(A[6]){A[6]=A[6].replace(/"/g,'\\"')}return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(A)},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:{laterSibling:/^\s*~\s*/,child:/^\s*>\s*/,adjacent:/^\s*\+\s*/,descendant:/^\s/,tagName:/^\s*(\*|[\w\-]+)(\b|$)?/,id:/^#([\w\-\*]+)(\b|$)/,className:/^\.([\w\-\*]+)(\b|$)/,pseudo:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|\s|(?=:))/,attrPresence:/^\[([\w]+)\]/,attr:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\]]*?)\4|([^'"][^\]]*?)))?\]/},handlers:{concat:function(B,A){for(var C=0,D;D=A[C];C++){B.push(D)}return B},mark:function(A){for(var B=0,C;C=A[B];B++){C._counted=true}return A},unmark:function(A){for(var B=0,C;C=A[B];B++){C._counted=undefined}return A},index:function(A,D,F){A._counted=true;if(D){for(var B=A.childNodes,E=B.length-1,C=1;E>=0;E--){node=B[E];if(node.nodeType==1&&(!F||node._counted)){node.nodeIndex=C++}}}else{for(var E=0,C=1,B=A.childNodes;node=B[E];E++){if(node.nodeType==1&&(!F||node._counted)){node.nodeIndex=C++}}}},unique:function(B){if(B.length==0){return B}var D=[],E;for(var C=0,A=B.length;C<A;C++){if(!(E=B[C])._counted){E._counted=true;D.push(Element.extend(E))}}return Selector.handlers.unmark(D)},descendant:function(A){var D=Selector.handlers;for(var C=0,B=[],E;E=A[C];C++){D.concat(B,E.getElementsByTagName("*"))}return B},child:function(A){var F=Selector.handlers;for(var E=0,D=[],G;G=A[E];E++){for(var B=0,C=[],H;H=G.childNodes[B];B++){if(H.nodeType==1&&H.tagName!="!"){D.push(H)}}}return D},adjacent:function(A){for(var C=0,B=[],E;E=A[C];C++){var D=this.nextElementSibling(E);if(D){B.push(D)}}return B},laterSibling:function(A){var D=Selector.handlers;for(var C=0,B=[],E;E=A[C];C++){D.concat(B,Element.nextSiblings(E))}return B},nextElementSibling:function(A){while(A=A.nextSibling){if(A.nodeType==1){return A}}return null},previousElementSibling:function(A){while(A=A.previousSibling){if(A.nodeType==1){return A}}return null},tagName:function(B,A,E,H){E=E.toUpperCase();var D=[],F=Selector.handlers;if(B){if(H){if(H=="descendant"){for(var C=0,G;G=B[C];C++){F.concat(D,G.getElementsByTagName(E))}return D}else{B=this[H](B)}if(E=="*"){return B}}for(var C=0,G;G=B[C];C++){if(G.tagName.toUpperCase()==E){D.push(G)}}return D}else{return A.getElementsByTagName(E)}},id:function(B,A,H,F){var G=$(H),D=Selector.handlers;if(!B&&A==document){return G?[G]:[]}if(B){if(F){if(F=="child"){for(var C=0,E;E=B[C];C++){if(G.parentNode==E){return[G]}}}else{if(F=="descendant"){for(var C=0,E;E=B[C];C++){if(Element.descendantOf(G,E)){return[G]}}}else{if(F=="adjacent"){for(var C=0,E;E=B[C];C++){if(Selector.handlers.previousElementSibling(G)==E){return[G]}}}else{B=D[F](B)}}}}for(var C=0,E;E=B[C];C++){if(E==G){return[G]}}return[]}return(G&&Element.descendantOf(G,A))?[G]:[]},className:function(B,A,C,D){if(B&&D){B=this[D](B)}return Selector.handlers.byClassName(B,A,C)},byClassName:function(C,B,F){if(!C){C=Selector.handlers.descendant([B])}var H=" "+F+" ";for(var E=0,D=[],G,A;G=C[E];E++){A=G.className;if(A.length==0){continue}if(A==F||(" "+A+" ").include(H)){D.push(G)}}return D},attrPresence:function(C,B,A){var E=[];for(var D=0,F;F=C[D];D++){if(Element.hasAttribute(F,A)){E.push(F)}}return E},attr:function(A,H,G,I,B){if(!A){A=H.getElementsByTagName("*")}var J=Selector.operators[B],D=[];for(var E=0,C;C=A[E];E++){var F=Element.readAttribute(C,G);if(F===null){continue}if(J(F,I)){D.push(C)}}return D},pseudo:function(B,C,E,A,D){if(B&&D){B=this[D](B)}if(!B){B=A.getElementsByTagName("*")}return Selector.pseudos[C](B,E,A)}},pseudos:{"first-child":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(Selector.handlers.previousElementSibling(E)){continue}C.push(E)}return C},"last-child":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(Selector.handlers.nextElementSibling(E)){continue}C.push(E)}return C},"only-child":function(B,G,A){var E=Selector.handlers;for(var D=0,C=[],F;F=B[D];D++){if(!E.previousElementSibling(F)&&!E.nextElementSibling(F)){C.push(F)}}return C},"nth-child":function(B,C,A){return Selector.pseudos.nth(B,C,A)},"nth-last-child":function(B,C,A){return Selector.pseudos.nth(B,C,A,true)},"nth-of-type":function(B,C,A){return Selector.pseudos.nth(B,C,A,false,true)},"nth-last-of-type":function(B,C,A){return Selector.pseudos.nth(B,C,A,true,true)},"first-of-type":function(B,C,A){return Selector.pseudos.nth(B,"1",A,false,true)},"last-of-type":function(B,C,A){return Selector.pseudos.nth(B,"1",A,true,true)},"only-of-type":function(B,D,A){var C=Selector.pseudos;return C["last-of-type"](C["first-of-type"](B,D,A),D,A)},getIndices:function(B,A,C){if(B==0){return A>0?[A]:[]}return $R(1,C).inject([],function(D,E){if(0==(E-A)%B&&(E-A)/B>=0){D.push(E)}return D})},nth:function(A,L,N,K,C){if(A.length==0){return[]}if(L=="even"){L="2n+0"}if(L=="odd"){L="2n+1"}var J=Selector.handlers,I=[],B=[],E;J.mark(A);for(var H=0,D;D=A[H];H++){if(!D.parentNode._counted){J.index(D.parentNode,K,C);B.push(D.parentNode)}}if(L.match(/^\d+$/)){L=Number(L);for(var H=0,D;D=A[H];H++){if(D.nodeIndex==L){I.push(D)}}}else{if(E=L.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(E[1]=="-"){E[1]=-1}var O=E[1]?Number(E[1]):1;var M=E[2]?Number(E[2]):0;var P=Selector.pseudos.getIndices(O,M,A.length);for(var H=0,D,F=P.length;D=A[H];H++){for(var G=0;G<F;G++){if(D.nodeIndex==P[G]){I.push(D)}}}}}J.unmark(A);J.unmark(B);return I},empty:function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.tagName=="!"||(E.firstChild&&!E.innerHTML.match(/^\s*$/))){continue}C.push(E)}return C},not:function(A,D,I){var G=Selector.handlers,J,C;var H=new Selector(D).findElements(I);G.mark(H);for(var F=0,E=[],B;B=A[F];F++){if(!B._counted){E.push(B)}}G.unmark(H);return E},enabled:function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(!E.disabled){C.push(E)}}return C},disabled:function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.disabled){C.push(E)}}return C},checked:function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.checked){C.push(E)}}return C}},operators:{"=":function(B,A){return B==A},"!=":function(B,A){return B!=A},"^=":function(B,A){return B.startsWith(A)},"$=":function(B,A){return B.endsWith(A)},"*=":function(B,A){return B.include(A)},"~=":function(B,A){return(" "+B+" ").include(" "+A+" ")},"|=":function(B,A){return("-"+B.toUpperCase()+"-").include("-"+A.toUpperCase()+"-")}},matchElements:function(F,G){var E=new Selector(G).findElements(),D=Selector.handlers;D.mark(E);for(var C=0,B=[],A;A=F[C];C++){if(A._counted){B.push(A)}}D.unmark(E);return B},findElement:function(B,C,A){if(typeof C=="number"){A=C;C=false}return Selector.matchElements(B,C||"*")[A||0]},findChildElements:function(E,G){var H=G.join(","),G=[];H.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(I){G.push(I[1].strip())});var D=[],F=Selector.handlers;for(var C=0,B=G.length,A;C<B;C++){A=new Selector(G[C].strip());F.concat(D,A.findElements(E))}return(B>1)?F.unique(D):D}});function $$(){return Selector.findChildElements(document,$A(arguments))}var Form={reset:function(A){$(A).reset();return A},serializeElements:function(C,A){var B=C.inject({},function(D,F){if(!F.disabled&&F.name){var E=F.name,G=$(F).getValue();if(G!=null){if(E in D){if(D[E].constructor!=Array){D[E]=[D[E]]}D[E].push(G)}else{D[E]=G}}}return D});return A?B:Hash.toQueryString(B)}};Form.Methods={serialize:function(B,A){return Form.serializeElements(Form.getElements(B),A)},getElements:function(A){return $A($(A).getElementsByTagName("*")).inject([],function(B,C){if(Form.Element.Serializers[C.tagName.toLowerCase()]){B.push(Element.extend(C))}return B})},getInputs:function(G,C,D){G=$(G);var A=G.getElementsByTagName("input");if(!C&&!D){return $A(A).map(Element.extend)}for(var E=0,H=[],F=A.length;E<F;E++){var B=A[E];if((C&&B.type!=C)||(D&&B.name!=D)){continue}H.push(Element.extend(B))}return H},disable:function(A){A=$(A);Form.getElements(A).invoke("disable");return A},enable:function(A){A=$(A);Form.getElements(A).invoke("enable");return A},findFirstElement:function(A){return $(A).getElements().find(function(B){return B.type!="hidden"&&!B.disabled&&["input","select","textarea"].include(B.tagName.toLowerCase())})},focusFirstElement:function(A){A=$(A);A.findFirstElement().activate();return A},request:function(B,A){B=$(B),A=Object.clone(A||{});var C=A.parameters;A.parameters=B.serialize(true);if(C){if(typeof C=="string"){C=C.toQueryParams()}Object.extend(A.parameters,C)}if(B.hasAttribute("method")&&!A.method){A.method=B.method}return new Ajax.Request(B.readAttribute("action"),A)}};Form.Element={focus:function(A){$(A).focus();return A},select:function(A){$(A).select();return A}};Form.Element.Methods={serialize:function(A){A=$(A);if(!A.disabled&&A.name){var B=A.getValue();if(B!=undefined){var C={};C[A.name]=B;return Hash.toQueryString(C)}}return""},getValue:function(A){A=$(A);var B=A.tagName.toLowerCase();return Form.Element.Serializers[B](A)},clear:function(A){$(A).value="";return A},present:function(A){return $(A).value!=""},activate:function(A){A=$(A);try{A.focus();if(A.select&&(A.tagName.toLowerCase()!="input"||!["button","reset","submit"].include(A.type))){A.select()}}catch(B){}return A},disable:function(A){A=$(A);A.blur();A.disabled=true;return A},enable:function(A){A=$(A);A.disabled=false;return A}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(A){switch(A.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(A);default:return Form.Element.Serializers.textarea(A)}},inputSelector:function(A){return A.checked?A.value:null},textarea:function(A){return A.value},select:function(A){return this[A.type=="select-one"?"selectOne":"selectMany"](A)},selectOne:function(B){var A=B.selectedIndex;return A>=0?this.optionValue(B.options[A]):null},selectMany:function(D){var A,E=D.length;if(!E){return null}for(var C=0,A=[];C<E;C++){var B=D.options[C];if(B.selected){A.push(this.optionValue(B))}}return A},optionValue:function(A){return Element.extend(A).hasAttribute("value")?A.value:A.text}};Abstract.TimedObserver=function(){};Abstract.TimedObserver.prototype={initialize:function(A,B,C){this.frequency=B;this.element=$(A);this.callback=C;this.lastValue=this.getValue();this.registerCallback()},registerCallback:function(){setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},onTimerEvent:function(){var A=this.getValue();var B=("string"==typeof this.lastValue&&"string"==typeof A?this.lastValue!=A:String(this.lastValue)!=String(A));if(B){this.callback(this.element,A);this.lastValue=A}}};Form.Element.Observer=Class.create();Form.Element.Observer.prototype=Object.extend(new Abstract.TimedObserver(),{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create();Form.Observer.prototype=Object.extend(new Abstract.TimedObserver(),{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=function(){};Abstract.EventObserver.prototype={initialize:function(A,B){this.element=$(A);this.callback=B;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var A=this.getValue();if(this.lastValue!=A){this.callback(this.element,A);this.lastValue=A}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback.bind(this))},registerCallback:function(A){if(A.type){switch(A.type.toLowerCase()){case"checkbox":case"radio":Event.observe(A,"click",this.onElementEvent.bind(this));break;default:Event.observe(A,"change",this.onElementEvent.bind(this));break}}}};Form.Element.EventObserver=Class.create();Form.Element.EventObserver.prototype=Object.extend(new Abstract.EventObserver(),{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create();Form.EventObserver.prototype=Object.extend(new Abstract.EventObserver(),{getValue:function(){return Form.serialize(this.element)}});if(!window.Event){var Event=new Object()}Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,element:function(A){return $(A.target||A.srcElement)},isLeftClick:function(A){return(((A.which)&&(A.which==1))||((A.button)&&(A.button==1)))},pointerX:function(A){return A.pageX||(A.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft))},pointerY:function(A){return A.pageY||(A.clientY+(document.documentElement.scrollTop||document.body.scrollTop))},stop:function(A){if(A.preventDefault){A.preventDefault();A.stopPropagation()}else{A.returnValue=false;A.cancelBubble=true}},findElement:function(C,B){var A=Event.element(C);while(A.parentNode&&(!A.tagName||(A.tagName.toUpperCase()!=B.toUpperCase()))){A=A.parentNode}return A},observers:false,_observeAndCache:function(D,C,B,A){if(!this.observers){this.observers=[]}if(D.addEventListener){this.observers.push([D,C,B,A]);D.addEventListener(C,B,A)}else{if(D.attachEvent){this.observers.push([D,C,B,A]);D.attachEvent("on"+C,B)}}},unloadCache:function(){if(!Event.observers){return }for(var A=0,B=Event.observers.length;A<B;A++){Event.stopObserving.apply(this,Event.observers[A]);Event.observers[A][0]=null}Event.observers=false},observe:function(D,C,B,A){D=$(D);A=A||false;if(C=="keypress"&&(Prototype.Browser.WebKit||D.attachEvent)){C="keydown"}Event._observeAndCache(D,C,B,A)},stopObserving:function(D,C,B,A){D=$(D);A=A||false;if(C=="keypress"&&(Prototype.Browser.WebKit||D.attachEvent)){C="keydown"}if(D.removeEventListener){D.removeEventListener(C,B,A)}else{if(D.detachEvent){try{D.detachEvent("on"+C,B)}catch(E){}}}}});if(Prototype.Browser.IE){Event.observe(window,"unload",Event.unloadCache,false)}var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},realOffset:function(B){var A=0,C=0;do{A+=B.scrollTop||0;C+=B.scrollLeft||0;B=B.parentNode}while(B);return[C,A]},cumulativeOffset:function(B){var A=0,C=0;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;B=B.offsetParent}while(B);return[C,A]},positionedOffset:function(B){var A=0,D=0;do{A+=B.offsetTop||0;D+=B.offsetLeft||0;B=B.offsetParent;if(B){if(B.tagName=="BODY"){break}var C=Element.getStyle(B,"position");if(C=="relative"||C=="absolute"){break}}}while(B);return[D,A]},offsetParent:function(A){if(A.offsetParent){return A.offsetParent}if(A==document.body){return A}while((A=A.parentNode)&&A!=document.body){if(Element.getStyle(A,"position")!="static"){return A}}return document.body},within:function(B,A,C){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(B,A,C)}this.xcomp=A;this.ycomp=C;this.offset=this.cumulativeOffset(B);return(C>=this.offset[1]&&C<this.offset[1]+B.offsetHeight&&A>=this.offset[0]&&A<this.offset[0]+B.offsetWidth)},withinIncludingScrolloffsets:function(B,A,D){var C=this.realOffset(B);this.xcomp=A+C[0]-this.deltaX;this.ycomp=D+C[1]-this.deltaY;this.offset=this.cumulativeOffset(B);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+B.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+B.offsetWidth)},overlap:function(B,A){if(!B){return 0}if(B=="vertical"){return((this.offset[1]+A.offsetHeight)-this.ycomp)/A.offsetHeight}if(B=="horizontal"){return((this.offset[0]+A.offsetWidth)-this.xcomp)/A.offsetWidth}},page:function(D){var A=0,C=0;var B=D;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;if(B.offsetParent==document.body){if(Element.getStyle(B,"position")=="absolute"){break}}}while(B=B.offsetParent);B=D;do{if(!window.opera||B.tagName=="BODY"){A-=B.scrollTop||0;C-=B.scrollLeft||0}}while(B=B.parentNode);return[C,A]},clone:function(C,E){var A=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});C=$(C);var D=Position.page(C);E=$(E);var F=[0,0];var B=null;if(Element.getStyle(E,"position")=="absolute"){B=Position.offsetParent(E);F=Position.page(B)}if(B==document.body){F[0]-=document.body.offsetLeft;F[1]-=document.body.offsetTop}if(A.setLeft){E.style.left=(D[0]-F[0]+A.offsetLeft)+"px"}if(A.setTop){E.style.top=(D[1]-F[1]+A.offsetTop)+"px"}if(A.setWidth){E.style.width=C.offsetWidth+"px"}if(A.setHeight){E.style.height=C.offsetHeight+"px"}},absolutize:function(B){B=$(B);if(B.style.position=="absolute"){return }Position.prepare();var D=Position.positionedOffset(B);var F=D[1];var E=D[0];var C=B.clientWidth;var A=B.clientHeight;B._originalLeft=E-parseFloat(B.style.left||0);B._originalTop=F-parseFloat(B.style.top||0);B._originalWidth=B.style.width;B._originalHeight=B.style.height;B.style.position="absolute";B.style.top=F+"px";B.style.left=E+"px";B.style.width=C+"px";B.style.height=A+"px"},relativize:function(A){A=$(A);if(A.style.position=="relative"){return }Position.prepare();A.style.position="relative";var C=parseFloat(A.style.top||0)-(A._originalTop||0);var B=parseFloat(A.style.left||0)-(A._originalLeft||0);A.style.top=C+"px";A.style.left=B+"px";A.style.height=A._originalHeight;A.style.width=A._originalWidth}};if(Prototype.Browser.WebKit){Position.cumulativeOffset=function(B){var A=0,C=0;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;if(B.offsetParent==document.body){if(Element.getStyle(B,"position")=="absolute"){break}}B=B.offsetParent}while(B);return[C,A]}}Element.addMethods();Object.extend(Event,{KEY_SHIFT:16,KEY_CONTROL:17,KEY_CAPSLOCK:20,KEY_SPACE:32,keyPressed:function(A){return Browser.isMSIE()?window.event.keyCode:A.which}});Browser={inspect:function(A){if(A){alert(navigator.userAgent)}else{return navigator.userAgent}},isMSIE:function(){return(navigator.userAgent.toLowerCase().indexOf("msie")>-1)&&!this.isOpera()},isOpera:function(){return navigator.userAgent.toLowerCase().indexOf("opera")>-1},isMozilla:function(){return(navigator.userAgent.toLowerCase().indexOf("mozilla")>-1)&&!this.isOpera()&&!this.isMSIE()}};Object.genGUID=function(){var A=8;if(!isNaN(parseInt(arguments[0]))){A=parseInt(arguments[0])}var D="abcdef0123456789";var B="";while(B.length<A){var C=Math.floor(Math.random()*(D.length-1));B+=D.charAt(C)}return B};Ajax.Request.prototype.request=function(A){this.url=A;this.method=this.options.method;var C=Object.clone(this.options.parameters);this.parameters=C;if(C=Hash.toQueryString(C)){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+C}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){C+="&_="}}}try{if(this.options.onCreate){this.options.onCreate(this.transport)}Ajax.Responders.dispatch("onCreate",this,this.transport);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){setTimeout(function(){this.respondToReadyState(1)}.bind(this),10)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=["put","post"].include(this.method)?(this.options.postBody||C):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(B){this.dispatchException(B)}};function GadgetVariable(B,A){this.varManager=null;this.iGadgetId=null;this.name=null}GadgetVariable.prototype.GadgetVariable=function(A,B){this.varManager=VarManagerFactory.getInstance();this.iGadgetId=A;this.name=B};GadgetVariable.prototype.get=function(){return this.varManager.getVariable(this.iGadgetId,this.name)};GadgetVariable.prototype.set=function(A){};GadgetVariable.prototype.register=function(A){};function RGadgetVariable(B,C,A){GadgetVariable.prototype.GadgetVariable.call(this,B,C);this.handler=A;this.register(A)}RGadgetVariable.prototype=new GadgetVariable;RGadgetVariable.prototype.register=function(A){this.varManager.registerVariable(this.iGadgetId,this.name,A)};function RWGadgetVariable(A,B){GadgetVariable.prototype.GadgetVariable.call(this,A,B)}RWGadgetVariable.prototype=new GadgetVariable;RWGadgetVariable.prototype.set=function(A){this.varManager.setVariable(this.iGadgetId,this.name,A)};var VarManagerFactory=function(){var instance=null;function VarManager(){loadIGadgets=function(transport){var response=transport.responseText;var tempList=eval("("+response+")");tempList=tempList.iGadgets;var objVars=[];var id=-1;var rawVars=null;var rawVar=null;for(i=0;i<tempList.length;i++){id=tempList[i].id;rawVars=tempList[i].variables;objVars=[];for(j=0;j<rawVars.length;j++){rawVar=rawVars[j];switch(rawVar.aspect){case Variable.prototype.PROPERTY:case Variable.prototype.EVENT:objVars[rawVar.name]=new RWVariable(id,rawVar.name,rawVar.aspect,rawVar.value);break;case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.GADGET_CONTEXT:case Variable.prototype.SLOT:case Variable.prototype.USER_PREF:objVars[rawVar.name]=new RVariable(id,rawVar.name,rawVar.aspect,rawVar.value);break}}iGadgets[id]=objVars}loaded=true;opManager.continueLoading(Modules.prototype.VAR_MANAGER)};onError=function(transport){alert("error VarManager GET")};var findVariable=function(iGadgetId,name){var variables=iGadgets[iGadgetId];var variable=variables[name];return variable};var loaded=false;var persistenceEngine=PersistenceEngineFactory.getInstance();var opManager=OpManagerFactory.getInstance();var wiring=null;var iGadgets=[];var modifiedVars=[];var nestingLevel=0;persistenceEngine.send_get(URIs.GET_IGADGETS,this,loadIGadgets,onError);VarManager.prototype.writeSlot=function(iGadgetId,slotName,value){if(!loaded){return }var variable=findVariable(iGadgetId,slotName);variable.set(value)};VarManager.prototype.updateUserPref=function(iGadgetId,slotName,value){if(!loaded){return }var variable=findVariable(iGadgetId,slotName);variable.set(value)};VarManager.prototype.updateContextVar=function(iGadgetId,ctxVarName,value){if(!loaded){return }var variable=findVariable(iGadgetId,ctxVarName);variable.set(value)};VarManager.prototype.registerVariable=function(iGadgetId,variableName,handler){if(!loaded){return }var variable=findVariable(iGadgetId,variableName);if(variable){variable.setHandler(handler)}else{var gadgetInfo=DragboardFactory.getInstance().getGadget(iGadgetId).getInfoString();var transObj={iGadgetId:iGadgetId,varName:variableName,GadgetInfo:gadgetInfo};var msg=interpolate(gettext("IGadget %(iGadgetId)s doesn't have any variable named \"%(varName)s\".\nIf you need it, please insert it into the gadget's template.\n%(GadgetInfo)s."),transObj,true);OpManagerFactory.getInstance().log(msg,Constants.Logging.ERROR_MSG)}};VarManager.prototype.getVariable=function(iGadgetId,variableName){if(!loaded){return }var variable=findVariable(iGadgetId,variableName);return variable.get()};VarManager.prototype.setVariable=function(iGadgetId,variableName,value){if(!loaded){return }if(wiring==null){wiring=WiringFactory.getInstance()}var variable=findVariable(iGadgetId,variableName);return variable.set(value,wiring)};VarManager.prototype.addInstance=function(iGadgetId,template){if(!loaded){return }var templateVariables=template.getVariables(iGadgetId);iGadgets[iGadgetId]=templateVariables};VarManager.prototype.removeInstance=function(iGadgetId){if(!loaded){return }delete iGadgets[iGadgetId]};VarManager.prototype.commitModifiedVariables=function(){function onSuccess(transport){}function onError(transport){alert(transport.responseText)}if(modifiedVars.length>0){var persistenceEngine=PersistenceEngineFactory.getInstance();var param={variables:Object.toJSON(modifiedVars)};persistenceEngine.send_update(URIs.PUT_VARIABLES,param,this,onSuccess,onError);varManager.resetModifiedVariables()}};VarManager.prototype.planInterfaceInitialization=function(){if(loaded==true){try{setTimeout("VarManagerFactory.getInstance().initializeInterface()",200)}catch(e){alert(e)}}};VarManager.prototype.initializeInterface=function(){var variable;var vars;var varIndex;var gadgetIndex;for(gadgetIndex in iGadgets){vars=iGadgets[gadgetIndex];for(varIndex in vars){variable=vars[varIndex];if(variable.aspect=="SLOT"&&variable.handler){try{variable.handler(variable.value)}catch(e){}}}}};VarManager.prototype.getModifiedVariables=function(){return modifiedVars};VarManager.prototype.markVariablesAsModified=function(vars){var varInfo;var found=false;var modVar;for(i=0;i<vars.length;i++){varInfo=vars[i];for(j=0;j<modifiedVars.length;j++){modVar=modifiedVars[j];if(modVar.iGadget==varInfo.iGadget&&modVar.name==varInfo.name){modVar.value=varInfo.value;found=true;break}}if(found){found=false;continue}else{modifiedVars.push(varInfo)}}};VarManager.prototype.incNestingLevel=function(){nestingLevel++};VarManager.prototype.decNestingLevel=function(){nestingLevel--;if(nestingLevel==0){this.commitModifiedVariables()}};VarManager.prototype.resetModifiedVariables=function(){nestingLevel=0;modifiedVars=[]}}return new function(){this.getInstance=function(){if(instance==null){instance=new VarManager()}return instance}}}();function Variable(B,A){this.iGadget=null;this.name=null;this.aspect=null;this.value=null}Variable.prototype.Variable=function(B,D,C,A){this.iGadget=B;this.name=D;this.aspect=C;this.value=A};Variable.prototype.get=function(){};Variable.prototype.setHandler=function(){};Variable.prototype.set=function(A){};Variable.prototype.EVENT="EVEN";Variable.prototype.SLOT="SLOT";Variable.prototype.USER_PREF="PREF";Variable.prototype.PROPERTY="PROP";Variable.prototype.EXTERNAL_CONTEXT="ECTX";Variable.prototype.GADGET_CONTEXT="GCTX";function RVariable(B,D,C,A){Variable.prototype.Variable.call(this,B,D,C,A);this.handler=null}RVariable.prototype=new Variable;RVariable.prototype.setHandler=function(A){this.handler=A};RVariable.prototype.get=function(){switch(this.aspect){case Variable.prototype.GADGET_CONTEXT:case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.USER_PREF:case Variable.prototype.SLOT:return this.value;default:break}};RVariable.prototype.set=function(E){switch(this.aspect){case Variable.prototype.USER_PREF:varManager=VarManagerFactory.getInstance();var A=[{iGadget:this.iGadget,name:this.name,value:E}];varManager.markVariablesAsModified(A);case Variable.prototype.GADGET_CONTEXT:case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.SLOT:this.value=E;try{if(this.handler){this.handler(E)}}catch(D){var B=DragboardFactory.getInstance().getGadget(this.iGadget).getInfoString();var C={iGadgetId:this.iGadgetId,varName:this.name,exceptionMsg:D,GadgetInfo:B};var F=interpolate(gettext('Error in the handler of the "%(varName)s" RVariable in iGadget %(iGadgetId)s: %(exceptionMsg)s.\n%(GadgetInfo)s.'),C,true);OpManagerFactory.getInstance().log(F,Constants.Logging.ERROR_MSG)}break;default:break}};function RWVariable(B,D,C,A){Variable.prototype.Variable.call(this,B,D,C,A)}RWVariable.prototype=new Variable;RWVariable.prototype.set=function(A){wiring=WiringFactory.getInstance();varManager=VarManagerFactory.getInstance();varManager.incNestingLevel();if(this.value!=A){var D=new Object();D.iGadget=this.iGadget;D.name=this.name;D.value=A;var F=[];F[0]=D;varManager.markVariablesAsModified(F)}this.value=A;switch(this.aspect){case Variable.prototype.PROPERTY:break;case Variable.prototype.EVENT:var B=wiring.sendEvent(this.iGadget,this.name,A);varManager.markVariablesAsModified(B);var E;for(var C=0;C<B.length;C++){E=B[C];varManager.writeSlot(E.iGadget,E.name,E.value)}break}varManager.decNestingLevel()};RWVariable.prototype.get=function(){switch(this.aspect){case Variable.prototype.PROPERTY:return this.value;case Variable.prototype.EVENT:return this.value}};var ContextManagerFactory=function(){var instance=null;function ContextManager(){var _loaded=false;var _concepts=new Hash();var _name2Concept=new Hash();this._addContextVarsFromTemplate=function(cVars,type_){for(var i=0;i<cVars.length;i++){var cVar=cVars[i];if(_name2Concept[cVar.getConceptName()]==null){alert(gettext("Context variable")+" ["+cVar.getName()+"] "+gettext("without related concept. Its value cannot be established"));return }var relatedConcept=_concepts[_name2Concept[cVar.getConceptName()]];relatedConcept.setType(type_);relatedConcept.addIGadgetVar(cVar)}};function _loadConcepts(receivedData){function _loadIGadgetContextVars(receivedData){var iGadgetsJson=eval("("+receivedData.responseText+")");iGadgetsJson=iGadgetsJson.iGadgets;for(var i=0;i<iGadgetsJson.length;i++){var currentIGadget=iGadgetsJson[i];for(var j=0;j<currentIGadget.variables.length;j++){var currentVar=currentIGadget.variables[j];switch(currentVar.aspect){case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.GADGET_CONTEXT:var contextVar=new ContextVar(currentIGadget.id,currentVar.name,currentVar.concept);var relatedConcept=_concepts[_name2Concept[currentVar.concept]];relatedConcept.setType(currentVar.aspect);relatedConcept.addIGadgetVar(contextVar);break;default:break}}}_loaded=true;OpManagerFactory.getInstance().continueLoading(Modules.prototype.CONTEXT_MANAGER)}function _onError(transport,e){var msg;if(e){msg=e}else{msg=transport.status+" "+transport.statusText}alert(gettext("Error getting gadgets variables: ")+msg)}var conceptsJson=eval("("+receivedData.responseText+")");conceptsJson=conceptsJson.concepts;_concepts=new Hash();_name2Concept=new Hash();for(var i=0;i<conceptsJson.length;i++){var curConcept=conceptsJson[i];var concept=new Concept(curConcept.concept,curConcept.adaptor);_concepts[curConcept.concept]=concept;for(var j=0;j<curConcept.names.length;j++){var cname=curConcept.names[j];if(_name2Concept[cname]!=null){alert(gettext("WARNING: concept name")+" '"+cname+"' "+gettext("is already related to")+" '"+_name2Concept[cname]+"'. "+gettext("New related concept is")+" '"+curConcept.concept+"'")}_name2Concept[cname]=curConcept.concept}}PersistenceEngineFactory.getInstance().send_get(URIs.GET_IGADGETS,this,_loadIGadgetContextVars,_onError)}function _onError(transport,e){var msg;if(e){msg=e}else{msg=transport.status+" "+transport.statusText}alert(gettext("Error receiving context manager data")+": "+msg)}PersistenceEngineFactory.getInstance().send_get(URIs.GET_CONTEXT,this,_loadConcepts,_onError);ContextManager.prototype.addInstance=function(iGadgetId,gadget){if((gadget==null)||!(gadget instanceof Gadget)){return }var template=gadget.getTemplate();this._addContextVarsFromTemplate(template.getExternalContextVars(iGadgetId),Concept.prototype.EXTERNAL);this._addContextVarsFromTemplate(template.getGadgetContextVars(iGadgetId),Concept.prototype.IGADGET)};ContextManager.prototype.setConceptValue=function(concept,value){_concepts[concept].setValue(value)};ContextManager.prototype.setGadgetConceptValue=function(igadgetid,concept,value){_concepts[concept].getIGadgetVar(igadgetid).setValue(value)}}return new function(){this.getInstance=function(){if(instance==null){instance=new ContextManager()}return instance}}}();function ContextVar(A,C,B){this._igadget=A;this._varName=C;this._conceptName=B;this._value=null}ContextVar.prototype.getName=function(){return this._varName};ContextVar.prototype.getIGadget=function(){return this._igadget};ContextVar.prototype.getConceptName=function(){return this._conceptName};ContextVar.prototype.getValue=function(){return this._value};ContextVar.prototype.setValue=function(A){this._value=A;VarManagerFactory.getInstance().updateContextVar(this._igadget,this._varName,A)};function Concept(semanticConcept_,adaptor_){this._semanticConcept=semanticConcept_;this._adaptor=adaptor_;this._type=null;this._value=null;this._igadgetVars=new Array();this._initAdaptor=function(ivar_){if(ivar_==null){eval("new "+adaptor_+"()")}else{eval("new "+adaptor_+"("+ivar_.getIGadget()+")")}}}Concept.prototype.EXTERNAL="ECTX";Concept.prototype.IGADGET="GCTX";Concept.prototype.getSemanticConcept=function(){return this._semanticConcept};Concept.prototype.getAdaptor=function(){return this._adaptor};Concept.prototype.getValue=function(){if(this._type==Concept.prototype.EXTERNAL){return this.value_}throw gettext("Concept has not value, this is a Gadget Concept.")};Concept.prototype.setType=function(A){if(this._type==null){this._type=A}else{if(this._type!=A){throw gettext("Unexpected change of concept type.")}}};Concept.prototype.setValue=function(A){switch(this._type){case Concept.prototype.EXTERNAL:this._value=A;for(var B=0;B<this._igadgetVars.length;B++){var C=this._igadgetVars[B];C.setValue(A)}break;case Concept.prototype.IGADGET:throw gettext("Concept has not value, this is a Gadget Concept.");break;default:throw gettext("Concept has not type yet.");break}};Concept.prototype.addIGadgetVar=function(A){switch(this._type){case Concept.prototype.EXTERNAL:if(this.value!=null){A.setValue(this._value);this._igadgetVars.push(A)}else{this._igadgetVars.push(A);this._initAdaptor(null)}break;case Concept.prototype.IGADGET:this._igadgetVars.push(A);this._initAdaptor(A);break;default:throw gettext("Concept has not type yet.");break}};Concept.prototype.getIGadgetVar=function(A){switch(this._type){case Concept.prototype.IGADGET:for(var B=0;B<this._igadgetVars.length;B++){var C=this._igadgetVars[B];if(C.getIGadget()==A){return C}}throw interpolate(gettext("%(concept)s Concept is not related to IGadget number %(var)."),{concept:this._semanticConcept,"var":A},true);break;case Concept.prototype.EXTERNAL:throw gettext("This is a External Concept, 'getIGadgetVar' is only for Gadget Concept.");break;default:throw gettext("Concept has not type yet.")}};function UserAdaptor(){function _onSuccess(receivedData){var usernameJson=eval("("+receivedData.responseText+")");var value=usernameJson.username;ContextManagerFactory.getInstance().setConceptValue(UserAdaptor.prototype.CONCEPT,value)}function _onError(transport,e){var msg;if(e){msg=e}else{msg=transport.status+" "+transport.statusText}alert(gettext("Error getting concept ")+UserAdaptor.prototype.CONCEPT+":"+msg)}var uri=URIs.GET_CONTEXT_VALUE.evaluate({concept:UserAdaptor.prototype.CONCEPT});PersistenceEngineFactory.getInstance().send_get(uri,this,_onSuccess,_onError)}UserAdaptor.prototype.CONCEPT="username";function WidthAdaptor(gadgetID_){this._igadget=gadgetID_;function _onSuccess(receivedData){var json=eval("("+receivedData.responseText+")");var value=json.width;ContextManagerFactory.getInstance().setGadgetConceptValue(this._igadget,WidthAdaptor.prototype.CONCEPT,value)}function _onError(transport,e){var msg;if(e){msg=e}else{msg=transport.status+" "+transport.statusText}alert(gettext("Error getting concept ")+WidthAdaptor.prototype.CONCEPT+":"+msg)}var uri=URIs.GET_IGADGET.evaluate({id:this._igadget});PersistenceEngineFactory.getInstance().send_get(uri,this,_onSuccess,_onError)}WidthAdaptor.prototype.CONCEPT="width";function HeightAdaptor(gadgetID_){this._igadget=gadgetID_;function _onSuccess(receivedData){var json=eval("("+receivedData.responseText+")");var value=json.height;ContextManagerFactory.getInstance().setGadgetConceptValue(this._igadget,HeightAdaptor.prototype.CONCEPT,value)}function _onError(transport,e){var msg;if(e){msg=e}else{msg=transport.status+" "+transport.statusText}alert(gettext("Error getting concept ")+HeightAdaptor.prototype.CONCEPT+":"+msg)}var uri=URIs.GET_IGADGET.evaluate({id:this._igadget});PersistenceEngineFactory.getInstance().send_get(uri,this,_onSuccess,_onError)}HeightAdaptor.prototype.CONCEPT="height";function LanguageAdaptor(){function _onSuccess(receivedData){var json=eval("("+receivedData.responseText+")");var value=json.language;ContextManagerFactory.getInstance().setConceptValue(LanguageAdaptor.prototype.CONCEPT,value)}function _onError(transport,e){var msg;if(e){msg=e}else{msg=transport.status+" "+transport.statusText}alert(gettext("Error getting concept ")+LanguageAdaptor.prototype.CONCEPT+":"+msg)}var uri=URIs.GET_CONTEXT_VALUE.evaluate({concept:LanguageAdaptor.prototype.CONCEPT});PersistenceEngineFactory.getInstance().send_get(uri,this,_onSuccess,_onError)}LanguageAdaptor.prototype.CONCEPT="language";var ShowcaseFactory=function(){var instance=null;function Showcase(){Showcase.prototype.MODULE_HTML_ID="showcase";Showcase.prototype.NUM_CELLS=4;loadGadgets=function(receivedData_){var response=receivedData_.responseText;var jsonGadgetList=eval("("+response+")");for(var i=0;i<jsonGadgetList.length;i++){var jsonGadget=jsonGadgetList[i];var gadget=new Gadget(jsonGadget,null);var gadgetId=gadget.getVendor()+"_"+gadget.getName()+"_"+gadget.getVersion();_gadgets[gadgetId]=gadget}_loaded=true;_opManager.continueLoading(Modules.prototype.SHOWCASE)};onErrorCallback=function(receivedData_){_loaded=true;_opManager.continueLoading(Modules.prototype.SHOWCASE)};var _gadgets=new Hash();var _loaded=false;var _opManager=OpManagerFactory.getInstance();var _persistenceEngine=PersistenceEngineFactory.getInstance();_persistenceEngine.send_get(URIs.GET_GADGETS,this,loadGadgets,onErrorCallback);Showcase.prototype.addGadget=function(url_){var gadget=new Gadget(null,url_)};Showcase.prototype.gadgetToShowcaseGadgetModel=function(gadget_){var gadgetId=gadget_.getVendor()+"_"+gadget_.getName()+"_"+gadget_.getVersion();_gadgets[gadgetId]=gadget_;_opManager.addInstance(gadgetId)};Showcase.prototype.deleteGadget=function(gadgetId_){var gadget=_gadgets.remove(gadgetId_)};Showcase.prototype.updateGadget=function(gadgetId_,url_){this.remove(gadgetId_);this.addGadget(url_)};Showcase.prototype.getGadget=function(gadgetId_){return _gadgets[gadgetId_]};Showcase.prototype.setGadgetProperties=function(gadgetId_,imageSrc_,tags_){var gadget=_gadgets[gadgetId_];gadget.setImage(imageSrc_);gadget.setTags(tags_)};Showcase.prototype.tagGadget=function(gadgetId_,tags_){for(var i=0;i<tags_.length;i++){var tag=tags_[i];_gadgets[gadgetId_].addTag(tag)}};Showcase.prototype.addInstance=function(gadgetId_){var gadget=_gadgets[gadgetId_];_opManager.addInstance(gadget)}}return new function(){this.getInstance=function(){if(instance==null){instance=new Showcase()}return instance}}}();function StringBuffer(){this.buffer=[]}StringBuffer.prototype.append=function append(A){this.buffer.push(A);return this};StringBuffer.prototype.toString=function toString(){return this.buffer.join("")};function Modules(){}Modules.prototype.VAR_MANAGER=0;Modules.prototype.SHOWCASE=1;Modules.prototype.DRAGBOARD=2;Modules.prototype.WIRING=3;Modules.prototype.CONTEXT_MANAGER=4;var Constants={Logging:{ERROR_MSG:1,WARN_MSG:2,INFO_MSG:3}};function Template(C){var B=C.variables;var D=C.size.width;var A=C.size.height;this.getWidth=function(){return D};this.getHeight=function(){return A};this.getVariables=function(H){var F=[];var E=B;var G=null;for(i=0;i<E.length;i++){G=E[i];switch(G.aspect){case Variable.prototype.PROPERTY:case Variable.prototype.EVENT:F[G.name]=new RWVariable(H,G.name,G.aspect,null);break;case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.GADGET_CONTEXT:case Variable.prototype.SLOT:F[G.name]=new RVariable(H,G.name,G.aspect,null);break;case Variable.prototype.USER_PREF:F[G.name]=new RVariable(H,G.name,G.aspect,G.default_value);break}}return F};this.getUserPrefs=function(){if(this.prefs==null){this.prefs=new Array();var E=null;for(i=0;i<B.length;i++){E=B[i];if(E.aspect==Variable.prototype.USER_PREF){switch(E.type){case UserPref.prototype.TEXT:this.prefs.push(new TextUserPref(E.name,E.label,E.description,E.default_value));break;case UserPref.prototype.INTEGER:this.prefs.push(new IntUserPref(E.name,E.label,E.description,E.default_value));break;case UserPref.prototype.BOOLEAN:this.prefs.push(new BoolUserPref(E.name,E.label,E.description,E.default_value));break;case UserPref.prototype.DATE:this.prefs.push(new DateUserPref(E.name,E.label,E.description,E.default_value));break;case UserPref.prototype.LIST:this.prefs.push(new ListUserPref(E.name,E.label,E.description,E.default_value,E.value_options));break}}}}return this.prefs};this.getExternalContextVars=function(E){if(this.extCtxtVars==null){this.extCtxtVars=new Array();var F=null;for(i=0;i<B.length;i++){F=B[i];switch(F.aspect){case Variable.prototype.EXTERNAL_CONTEXT:this.extCtxtVars.push(new ContextVar(E,F.name,F.concept));break;default:break}}}return this.extCtxtVars};this.getGadgetContextVars=function(E){if(this.gCtxtVars==null){this.gCtxtVars=new Array();var F=null;for(i=0;i<B.length;i++){F=B[i];switch(F.aspect){case Variable.prototype.GADGET_CONTEXT:this.gCtxtVars.push(new ContextVar(E,F.name,F.concept));break;default:break}}}return this.gCtxtVars};this.getUserPrefsId=function(){var F=[];var E=B;var G=null;for(i=0;i<E.length;i++){G=E[i];if(G.aspect==Variable.prototype.USER_PREF){F.push(G.name)}}return F};this.getEventsId=function(){var F=[];var E=B;var G=null;for(i=0;i<E.length;i++){G=E[i];if(G.aspect==Variable.prototype.EVENT){F.push(G.name)}}return F};this.getSlots=function(){var F=[];var E=B;var G=null;for(i=0;i<E.length;i++){G=E[i];if(G.aspect==Variable.prototype.SLOT){F.push(G)}}return F};this.getEvents=function(){var F=[];var E=B;var G=null;for(i=0;i<E.length;i++){G=E[i];if(G.aspect==Variable.prototype.EVENT){F.push(G)}}return F};this.getPropertiesId=function(){var F=[];var E=B;var G=null;for(i=0;i<E.length;i++){G=E[i];if(G.aspect==Variable.prototype.PROPERTY){F.push(G.name)}}return F}}function XHtml(B){var A=null;A=B.uri;this.getURICode=function(){return A}}function Gadget(gadget_,url_){var _this=this;this.getVendor=function(){return state.getVendor()};this.getName=function(){return state.getName()};this.getVersion=function(){return state.getVersion()};this.getTemplate=function(){return state.getTemplate()};this.getXHtml=function(){return state.getXHtml()};this.getInfoString=function(){return state.getInfoString()};this.getImage=function(){return state.getImage()};this.setImage=function(image_){state.setImage(image_)};var _solicitarGadget=function(url_){var onError=function(transport,e){var msg;if(e){msg=interpolate(gettext("JavaScript exception on file %(errorFile)s (line: %(errorLine)s): %(errorDesc)s"),{errorFile:e.fileName,errorLine:e.lineNumber,errorDesc:e},true)}else{if(transport.responseXML){msg=transport.responseXML.documentElement.textContent}else{msg="HTTP Error "+transport.status+" - "+transport.statusText}}msg=interpolate(gettext("The gadget could not be added to the showcase: %(errorMsg)s."),{errorMsg:msg},true);OpManagerFactory.getInstance().log(msg);alert(gettext("The gadget could not be added to the showcase, please check the logs for further info."))};var loadGadget=function(transport){var response=transport.responseText;var objRes=eval("("+response+")");state=new GadgetState(objRes);ShowcaseFactory.getInstance().gadgetToShowcaseGadgetModel(_this)};var persistenceEngine=PersistenceEngineFactory.getInstance();var param={url:url_};persistenceEngine.send_post(URIs.GET_GADGETS,param,this,loadGadget,onError)};var state=null;if(url_!=null){_solicitarGadget(url_)}else{state=new GadgetState(gadget_)}}function GadgetState(F){var G=null;var B=null;var A=null;var C=null;var E=null;var D=null;G=F.vendor;B=F.name;A=F.version;C=new Template(F.template);E=new XHtml(F.xhtml);D=F.image;this.getVendor=function(){return G};this.getName=function(){return B};this.getVersion=function(){return A};this.getTemplate=function(){return C};this.getXHtml=function(){return E};this.getInfoString=function(){var H={vendor:G,name:B,version:A};var I=gettext("[GadgetVendor: %(vendor)s, GadgetName: %(name)s, GadgetVersion: %(version)s]");return interpolate(I,H,true)};this.getImage=function(){return D};this.setImage=function(H){D=H}}var PersistenceEngineFactory=function(){var A=null;function B(){B.prototype.send_get=function(E,F,D,C){new Ajax.Request(E,{method:"get",onSuccess:D.bind(F),onFailure:C.bind(F),onException:C.bind(F)})};B.prototype.send_post=function(E,G,F,D,C){new Ajax.Request(E,{method:"post",parameters:G,onSuccess:D.bind(F),onFailure:C.bind(F),onException:C.bind(F)})};B.prototype.send_delete=function(E,F,D,C){new Ajax.Request(E,{method:"delete",onSuccess:D.bind(F),onFailure:C.bind(F),onException:C.bind(F)})};B.prototype.send_update=function(E,G,F,D,C){new Ajax.Request(E,{method:"put",parameters:G,onSuccess:D.bind(F),onFailure:C.bind(F),onException:C.bind(F)})}}return new function(){this.getInstance=function(){if(A==null){A=new B()}return A}}}();function _EzWebAPI(){this.platform=window.parent;var A=document.URL.split("?");A=A[1].split("=");this.id=A[1];if(document.addEventListener){document.addEventListener("DOMContentLoaded",this.addOnLoadNotifier,false)}}_EzWebAPI.prototype.addOnLoadNotifier=function(){EzWebAPI.platform.opManager.igadgetLoaded()};_EzWebAPI.prototype.getId=function(){return EzWebAPI.id};_EzWebAPI.prototype.createRWGadgetVariable=function(A){return new EzWebAPI.platform.RWGadgetVariable(EzWebAPI.id,A)};_EzWebAPI.prototype.createRGadgetVariable=function(A,B){return new EzWebAPI.platform.RGadgetVariable(EzWebAPI.id,A,B)};_EzWebAPI.prototype.send_get=function(C,D,B,A){var E={url:C,method:"GET"};B.bind=EzWebAPI.platform.Function.prototype.bind;A.bind=EzWebAPI.platform.Function.prototype.bind;EzWebAPI.platform.PersistenceEngineFactory.getInstance().send_post(this.platform.URIs.PROXY,E,D,B,A)};_EzWebAPI.prototype.send_post=function(C,E,D,B,A){var F={url:C,method:"POST",params:E};B.bind=EzWebAPI.platform.Function.prototype.bind;A.bind=EzWebAPI.platform.Function.prototype.bind;EzWebAPI.platform.PersistenceEngineFactory.getInstance().send_post(this.platform.URIs.PROXY,F,D,B,A)};var EzWebAPI=new _EzWebAPI();function UIUtils(){}UIUtils.selectedResource=null;UIUtils.imageBottom="";UIUtils.imageContent="";UIUtils.infoResourcesWidth=400;UIUtils.isInfoResourcesOpen=false;UIUtils.page=1;UIUtils.search="false";UIUtils.searchValue="";UIUtils.searchCriteria="";UIUtils.addResource=function(B,E,G){var C=function(H){OpManagerFactory.getInstance().repaintCatalogue(URIs.GET_POST_RESOURCES)};var A=function(J,H){var I;if(H){I=interpolate(gettext("JavaScript exception on file %(errorFile)s (line: %(errorLine)s): %(errorDesc)s"),{errorFile:H.fileName,errorLine:H.lineNumber,errorDesc:H},true)}else{if(J.responseXML){I=J.responseXML.documentElement.textContent}else{I="HTTP Error "+J.status+" - "+J.statusText}}I=interpolate(gettext("The resource could not be added to the catalogue: %(errorMsg)s."),{errorMsg:I},true);OpManagerFactory.getInstance().log(I);alert(gettext("The resource could not be added to the catalogue, please check the logs for further info."))};var D=PersistenceEngineFactory.getInstance();var F=new Hash();F[E]=G;D.send_post(B,F,this,C,A)};UIUtils.getSelectedResource=function(){return UIUtils.selectedResource};UIUtils.selectResource=function(B){var A=document.getElementById(B+"_bottom");UIUtils.imageBottom=A.style.backgroundImage;A.style.backgroundImage="url(/ezweb/images/resource-left-bottom-select.png)";var C=document.getElementById(B+"_content");UIUtils.imageContent=C.style.backgroundImage;C.style.backgroundImage="url(/ezweb/images/resource-left-fill-select.png)"};UIUtils.deselectResource=function(B){var A=document.getElementById(B+"_bottom");A.style.backgroundImage=UIUtils.imageBottom;var C=document.getElementById(B+"_content");C.style.backgroundImage=UIUtils.imageContent};UIUtils.showResourceInfo=function(A){UIUtils.selectedResource=A;CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).showInfo()};UIUtils.updateGadgetXHTML=function(){var C=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);var E={vendor:C.getVendor(),name:C.getName(),version:C.getVersion()};var B=URIs.GET_GADGET.evaluate(E)+"/xhtml";var A=function(F){alert(gettext("Error PUT"))};var D=function(F){};PersistenceEngineFactory.getInstance().send_update(B,"",this,D,A)};UIUtils.toggle=function(B){var A=document.getElementById(B);if(A.style.display!="none"){A.style.display="none"}else{A.style.display="block"}};UIUtils.show=function(B){var A=document.getElementById(B);A.style.display="inline"};UIUtils.hidde=function(B){var A=document.getElementById(B);A.style.display="none"};UIUtils.changeImage=function(B,C){var A=document.getElementById(B);A.src=C};UIUtils.searchByTag=function(B,A){this.closeInfoResource();var C=OpManagerFactory.getInstance();if(A==""){alert("Introduzca un valor en el formulario de bsqueda")}else{UIUtils.search="tag";UIUtils.searchValue=A;UIUtils.searchCriteria="tag";C.repaintCatalogue(B+"/"+A)}};UIUtils.searchByWiring=function(A,C,D){this.closeInfoResource();var B=OpManagerFactory.getInstance();if(C==""){alert(gettext("Indicate a criteria in search formulary"))}else{UIUtils.search="wiring";UIUtils.searchValue=C;UIUtils.searchCriteria=D;B.repaintCatalogue(A+"/"+D+"/"+C)}};UIUtils.cataloguePaginate=function(C,F,E,B){this.closeInfoResource();var D=OpManagerFactory.getInstance();var A=Math.ceil(B/F);if(UIUtils.search=="false"){C=URIs.GET_POST_RESOURCES}if(UIUtils.search=="generic"){C=URIs.GET_RESOURCES_SEARCH_GENERIC+"/"+UIUtils.searchValue+"/"+UIUtils.searchCriteria}if(UIUtils.search=="wiring"){C=URIs.GET_RESOURCES_BY_WIRING+"/"+UIUtils.searchCriteria+"/"+UIUtils.searchValue}if(UIUtils.search=="tag"){C=URIs.GET_RESOURCES_BY_TAG+"/"+UIUtils.searchValue}if(E=="prev"){if(UIUtils.page==1){E=1}else{E=UIUtils.page-1}}if(E=="next"){if(UIUtils.page==A){E=A}else{E=parseInt(UIUtils.page)+1}}UIUtils.page=E;D.repaintCatalogue(C+"/"+E+"/"+F)};UIUtils.searchGeneric=function(A,C,D){this.closeInfoResource();var B=OpManagerFactory.getInstance();if(C==""){alert(gettext("Indicate a criteria in search formulary"))}else{UIUtils.searchValue=C;UIUtils.searchCriteria=D;UIUtils.search="generic";B.repaintCatalogue(A+"/"+C+"/"+D+"/1/10")}};UIUtils.removeTag=function(A){var B=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).getTagger();B.removeTag(A)};UIUtils.removeAllTags=function(){var A=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).getTagger();A.removeAll()};UIUtils.removeTagUser=function(A){var C=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);var D=C.getTagger();var B="/"+C.getVendor()+"/"+C.getName()+"/"+C.getVersion()+"/"+A;D.removeTagUser(URIs.DELETE_TAG,B)};UIUtils.sendTags=function(){var B=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);var C=B.getTagger();var A="/"+B.getVendor()+"/"+B.getName()+"/"+B.getVersion();C.sendTags(URIs.POST_RESOURCE_TAGS,A)};UIUtils.deleteGadget=function(){var D=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);var C=URIs.GET_POST_RESOURCES+"/"+D.getVendor()+"/"+D.getName()+"/"+D.getVersion();var A=function(E){alert(gettext("Error DELETE"))};var B=function(E){opManager.repaintCatalogue(URIs.GET_POST_RESOURCES+"/1/10")};PersistenceEngineFactory.getInstance().send_delete(C,this,B,A)};UIUtils.addTag=function(A){var B=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).getTagger();B.addTag(A.value);A.value="";A.focus()};UIUtils.setResourcesWidth=function(){var C=document.getElementById("tab_info_resource");var B=document.getElementById("head");var D=document.getElementById("resources");var A=document.getElementById("center");UIUtils.search=false;A.style.width=B.offsetWidth+"px";D.style.width=(A.offsetWidth-(C.offsetWidth+(UIUtils.isInfoResourcesOpen?UIUtils.infoResourcesWidth:0)))+"px"};UIUtils.openInfoResource=function(){if(!UIUtils.isInfoResourcesOpen){UIUtils.isInfoResourcesOpen=true;UIUtils.SlideInfoResourceIntoView("info_resource")}};UIUtils.closeInfoResource=function(){if(UIUtils.isInfoResourcesOpen){UIUtils.isInfoResourcesOpen=false;UIUtils.SlideInfoResourceOutOfView("info_resource")}};UIUtils.SlideInfoResourceIntoView=function(A){$(A).style.width="0px";$(A).style.overflow="hidden";$(A).firstChild.style.position="relative";UIUtils.setResourcesWidth();Element.show(A);new Effect.Scale(A,100,Object.extend(arguments[1]||{},{scaleContent:false,scaleY:false,scaleMode:"contents",scaleFrom:0,afterUpdate:function(B){},afterFinish:function(B){UIUtils.hidde("tab_info_resource_open");UIUtils.show("tab_info_resource_close")}}))};UIUtils.SlideInfoResourceOutOfView=function(A){$(A).style.overflow="hidden";$(A).firstChild.style.position="relative";Element.show(A);new Effect.Scale(A,0,Object.extend(arguments[1]||{},{scaleContent:false,scaleY:false,afterUpdate:function(B){},afterFinish:function(B){Element.hide(B.element);UIUtils.setResourcesWidth();UIUtils.hidde("tab_info_resource_close");UIUtils.show("tab_info_resource_open")}}))};UIUtils.SlideAdvancedSearchIntoView=function(C){C=$(C).cleanWhitespace();var A=C.down().getStyle("bottom");var B=C.getDimensions();return new Effect.Scale(C,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:B.height,originalWidth:B.width},restoreAfterFinish:true,afterSetup:function(D){D.element.makePositioned();D.element.down().makePositioned();if(window.opera){D.element.setStyle({top:""})}D.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(D){D.element.down().setStyle({bottom:(D.dims[0]-D.element.clientHeight)+"px"})},afterFinishInternal:function(D){D.element.undoClipping().undoPositioned();D.element.down().undoPositioned().setStyle({bottom:A})},afterFinish:function(D){UIUtils.hidde("simple_search");UIUtils.show("advanced_search_bottom");document.getElementById("advanced_search_text_tag").focus()}},arguments[1]||{}))};UIUtils.SlideAdvancedSearchOutOfView=function(B){B=$(B).cleanWhitespace();var A=B.down().getStyle("bottom");return new Effect.Scale(B,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,restoreAfterFinish:true,beforeStartInternal:function(C){C.element.makePositioned();C.element.down().makePositioned();if(window.opera){C.element.setStyle({top:""})}C.element.makeClipping().show()},afterUpdateInternal:function(C){C.element.down().setStyle({bottom:(C.dims[0]-C.element.clientHeight)+"px"})},afterFinishInternal:function(C){C.element.hide().undoClipping().undoPositioned().setStyle({bottom:A});C.element.down().undoPositioned()},afterFinish:function(C){UIUtils.hidde("advanced_search_bottom");UIUtils.show("simple_search");document.getElementById("simple_search_text").focus()}},arguments[1]||{}))};UIUtils.onReturn=function(B,A,C){if(!B){B=window.event}if(B&&B.keyCode&&B.keyCode==13){A(C)}};function Tagger(){var _this=this;var tags=new HashTable();this.addTag=function(tag_){if(tag_.length<3){alert(gettext("Tag must be at least three characters."))}else{if(!tags.contains(tag_)){var id="new_tag_"+tags.size();tags.addElement(id,tag_);paintTag(id,tag_)}}};this.removeTag=function(id_){tags.removeElement(id_);eraserTag(id_)};this.removeAll=function(){tags.clear();eraserAll()};this.sendTags=function(url,resourceURI){UIUtils.toggle("add_tags_panel");UIUtils.toggle("add_tags_link");if(tags.size()>0){var onError=function(transport){alert(gettext("Error POST"))};var loadTags=function(transport){var resource=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);var responseJSON=transport.responseText;var jsonResourceList=eval("("+responseJSON+")");resource.setTags(jsonResourceList.tagList);resource.updateTags()};var elements=tags.getValues();var tagsXML='<?xml version="1.0" encoding="UTF-8"?><Tags>';for(var i=0;i<elements.size();i++){tagsXML+=("<Tag>"+elements[i]+"</Tag>")}tagsXML+="</Tags>";var param={tags_xml:tagsXML};PersistenceEngineFactory.getInstance().send_post(url+resourceURI,param,this,loadTags,onError);_this.removeAll()}};this.removeTagUser=function(url,resourceURI){var onError=function(transport){alert(gettext("Error DELETE"))};var loadTags=function(transport){var resource=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);var responseJSON=transport.responseText;var jsonResourceList=eval("("+responseJSON+")");resource.setTags(jsonResourceList.tagList);resource.updateTags()};PersistenceEngineFactory.getInstance().send_delete(url+resourceURI,this,loadTags,onError);var resource=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);resource.updateTags()};var paintTag=function(id_,tag_){var newTag=document.createElement("div");newTag.setAttribute("id",id_);newTag.innerHTML="<div class='new_tag' onmouseover=\"UIUtils.hidde('button_disable_"+id_+"');UIUtils.show('button_enable_"+id_+"');\" onmouseout=\"UIUtils.hidde('button_enable_"+id_+"');UIUtils.show('button_disable_"+id_+"');\">"+tag_+"<div id='button_disable_"+id_+"'><a><img src='/ezweb/images/cancel_gray.png' alt=''></img></a></div><div id='button_enable_"+id_+"' style='display:none;'><a href='javascript:UIUtils.removeTag(\""+id_+"\");'><img src='/ezweb/images/cancel.png' alt=''></img></a></div>,</div> ";var parentHTML=document.getElementById("my_tags");parentHTML.insertBefore(newTag,parentHTML.lastChild)};var eraserTag=function(id_){var parentHTML=document.getElementById("my_tags");var tagHTML=document.getElementById(id_);parentHTML.removeChild(tagHTML)};var eraserAll=function(){var parentHTML=document.getElementById("my_tags");while(parentHTML.childNodes.length>1){parentHTML.removeChild(parentHTML.childNodes[0])}}}function Tag(A){var B=new StateTag(A);this.getValue=function(){return B.getValue()};this.getAdded_by=function(){return B.getAdded_by()};this.getAppearances=function(){return B.getAppearances()};this.tagToHTML=function(){var C='javascript:UIUtils.searchByTag(URIs.GET_RESOURCES_BY_TAG, "'+B.getValue()+'");';return"<a title='Buscar "+B.getValue()+"' href='"+C+"'>"+B.getValue()+"</a>"};this.tagToTypedHTML=function(){var E="";if(B.getAppearances()<5){E="tag_type_1"}else{if(B.getAppearances()<15){E="tag_type_2"}else{if(B.getAppearances()<25){E="tag_type_3"}else{E="tag_type_4"}}}var D='javascript:UIUtils.searchByTag(URIs.GET_RESOURCES_BY_TAG, "'+B.getValue()+'");';var C="<a class='"+E+"' title="+gettext("Search by ")+B.getValue()+"' href='"+D+"'>"+B.getValue()+"</a>";return C};this.equals=function(C){return((C.getValue()==B.getValue())&&(C.getAppearances()==B.getAppearances()))};this.compareTo=function(C){if(B.getAppearances()<(C.getAppearances())){return -1}else{if(B.getAppearances()>(C.getAppearances())){return 1}else{return 0}}}}function StateTag(A){var D=A.value;var C=1;var B=A.added_by;this.getValue=function(){return D};this.getAppearances=function(){return C};this.getAdded_by=function(){return B}}function HashTable(){var A=[];this.addElement=function(D,C){A.push(new B(D,C))};this.removeElement=function(D){for(var C=0;C<A.length;C++){if(A[C].getKey()==D){A=A.without(A[C])}}};this.getValue=function(D){for(var C=0;C<A.length;C++){if(A[C].getKey()==D){return A[C].getValue()}}return""};this.clear=function(){while(A.length>0){A=A.without(A[0])}};this.size=function(){return A.length};this.getValues=function(){var C=[];for(var D=0;D<A.length;D++){C[D]=A[D].getValue()}return C};this.contains=function(C){for(var D=0;D<A.length;D++){if(A[D].getValue()==C){return true}}return false};var B=function(E,C){var D=E;var F=C;this.getKey=function(){return D};this.getValue=function(){return F}}}function Resource(B,J,G,N){this.getVendor=function(){return F.getVendor()};this.getName=function(){return F.getName()};this.getVersion=function(){return F.getVersion()};this.getDescription=function(){return F.getDescription()};this.getUriImage=function(){return F.getUriImage()};this.getUriTemplate=function(){return F.getUriTemplate()};this.getUriWiki=function(){return F.getUriWiki()};this.getAddedBy=function(){return F.getAddedBy()};this.getTags=function(){return F.getTags()};this.setTags=function(U){F.setTags(U)};this.getSlots=function(){return F.getSlots()};this.setSlots=function(U){F.setSlots(U)};this.getEvents=function(){return F.getEvents()};this.setEvents=function(U){F.setEvents(U)};this.getTagger=function(){return I};this.paint=function(){var U=document.createElement("div");U.setAttribute("id",P);U.innerHTML="<div class='resource' onMouseOver='UIUtils.selectResource(\""+P+'");UIUtils.show("'+P+"_toolbar\");' onMouseOut='UIUtils.deselectResource(\""+P+'");UIUtils.hidde("'+P+"_toolbar\");'><div class='top'></div><div class='toolbar'><div id='"+P+"_toolbar' style='display:none;'><a id='"+P+"_description' title='"+gettext("Show description")+"' onmouseover=\"CatalogueFactory.getInstance().getResource('"+P+"').changeIconDescriptionBalloon('/ezweb/images/description.png');\" onmouseout=\"CatalogueFactory.getInstance().getResource('"+P+"').changeIconDescriptionBalloon('/ezweb/images/description_gray.png');\"></a><a title='"+gettext("Access to Wiki")+"' href='"+F.getUriWiki()+"' target='_blank'  onmouseover=\"UIUtils.changeImage('"+P+"_wiki_img', '/ezweb/images/wiki.png');\" onmouseout=\"UIUtils.changeImage('"+P+"_wiki_img', '/ezweb/images/wiki_gray.png');\"><img id='"+P+"_wiki_img' src='/ezweb/images/wiki_gray.png'></img></a><a title='"+gettext("Show Template")+"' href='"+F.getUriTemplate()+"' target='_blank' onmouseover=\"UIUtils.changeImage('"+P+"_template_img', '/ezweb/images/template.png');\" onmouseout=\"UIUtils.changeImage('"+P+"_template_img', '/ezweb/images/template_gray.png');\"><img id='"+P+"_template_img' src='/ezweb/images/template_gray.png'></img></a></div></div><div id='"+P+"_content' class='content'><div class='title'>"+F.getName()+"</div><div class='image'><a title='"+gettext("Show resource details")+"' href='javascript:UIUtils.showResourceInfo(\""+P+"\");UIUtils.openInfoResource();'><img src='"+F.getUriImage()+"'></img></a></div><div class='tags'><div id='"+P+"_important_tags' class='important_tags'>"+T(3)+"</div><div class='more_tags'><a id='"+P+"_tagcloud_balloon' title='"+gettext("Show resource tag cloud")+"' onmouseover=\"CatalogueFactory.getInstance().getResource('"+P+"').changeIconTagcloudBalloon('/ezweb/images/more_tags.png');\" onmouseout=\"CatalogueFactory.getInstance().getResource('"+P+"').changeIconTagcloudBalloon('/ezweb/images/more_tags_gray.png');\"></a></div></div><button onclick='CatalogueFactory.getInstance().addResourceToShowCase(\""+P+"\");'>"+gettext("Add Instance")+"</button></div><div id='"+P+"_bottom' class = 'bottom'></div></div>";var V=document.getElementById("resources");V.insertBefore(U,V.firstChild);L();Q()};this.showInfo=function(){var U=document.getElementById("info_resource_content");U.innerHTML="<div class='title_fieldset'>"+gettext("Resource details")+"</div><div class='fieldset'><div class='title'><span class='name'>"+F.getName()+"</span><span class='version'>"+F.getVersion()+"</span></div><div class='vendor'>"+F.getVendor()+"</div><div class='image'><img src='"+F.getUriImage()+"' alt='"+F.getName()+"&nbsp;"+F.getVersion()+"'/></div><div class='description'>"+gettext("Description:")+"<br/><div class='text'>"+F.getDescription()+"</div></div><br/><div class='connect'>"+gettext("Gadget connectivity")+"</div><br/><div class='Events'>"+gettext("Events: ")+K()+"</div><div class='Slots'>"+gettext("Slots: ")+A()+"</div><div class='tagcloud'>"+gettext("Tagcloud")+":<br/><div id='"+P+"_tagcloud' class='tags'>"+M()+"</div></div><div id='add_tags_panel' class='new_tags' style='display:none;'><div class='title'>"+gettext("New Tags")+":</div><div id='my_tags' class='my_tags'><div id='new_tag_text' class='new_tag_text'><input id='new_tag_text_input' type='text' onkeypress=\"UIUtils.onReturn(event,UIUtils.addTag,this);\"/></div></div><div class='buttons'><button onclick='javascript:UIUtils.sendTags();'>"+gettext("To label")+':</button><button onClick=\'javascript:UIUtils.toggle("add_tags_panel");UIUtils.toggle("add_tags_link");UIUtils.removeAllTags();\'>'+gettext("Cancel")+":</button></div></div><div id='add_tags_link' class='link'><a href='javascript:UIUtils.toggle(\"add_tags_link\");UIUtils.toggle(\"add_tags_panel\");document.getElementById(\"new_tag_text_input\").focus();'>"+gettext("To label the resource")+":</a></div><div class='link'><a href='"+F.getUriWiki()+"' target='_blank'>"+gettext("Access to Wiki")+":</a></div><div class='link'><a href='"+F.getUriTemplate()+"' target='_blank'>"+gettext("Access to Template")+":</a></div><div class='link'><a href='javascript:UIUtils.updateGadgetXHTML();'>"+gettext("Update Gadget Code")+":</a></div><div class='link'>"+S()+"</div></div><button onclick='CatalogueFactory.getInstance().addResourceToShowCase(UIUtils.getSelectedResource());'>"+gettext("Add Instance")+":</button>"};this.paginate=function(U){var V=document.getElementById("paginate");V.innerHTML="<center>"+C(U)+"</center>"};this.updateTags=function(){document.getElementById(P+"_important_tags").innerHTML=T(3);document.getElementById(P+"_tagcloud_balloon").innerHTML="\n";Q();if(P==UIUtils.selectedResource){document.getElementById(P+"_tagcloud").innerHTML=M()}};this.changeIconDescriptionBalloon=function(U){D._elements.icon.src=U};this.changeIconTagcloudBalloon=function(U){H._elements.icon.src=U};var R=function(U,W){for(var V=0;V<U.length;V++){if(!O(U[V],W)){return U[V]}}return list_[0]};var O=function(V,W){for(var U=0;U<W.length;U++){if(V.equals(W[U])){return true}}return false};var T=function(Y){var W="";var Z=F.getTags();var V=[];for(var X=0;X<((Y<Z.length)?Y:Z.length);X++){V[X]=R(Z,V);for(var U=0;U<Z.length;U++){if((!O(Z[U],V))&&(V[X].compareTo(Z[U])<0)){V[X]=Z[U]}}}for(var X=0;X<V.length;X++){W+=(V[X].tagToHTML()+((X<(((V.length>Y)?Y:V.length)-1))?", ":""))}return W};var C=function(W){var V="";var X=W/10;var a='javascript:UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES, 10,"prev", "'+W+'");';V=("<span class='multiple_size_tag'><a title='"+gettext("Go to previous page")+"' href='"+a+"'>Previous</a></span>");for(var Y=1;Y<X+1;Y++){var U='javascript:UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES, 10, "'+Y+'", "'+W+'");';V+=("<span class='multiple_size_tag'><a title='"+gettext("Go to page ")+Y+"' href='"+U+"'>"+Y+"</a></span> ")}var Z='javascript:UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES, 10,"next", "'+W+'");';V+=("<span class='multiple_size_tag'><a title='"+gettext("Go to next page")+"' href='"+Z+"'>Next</a></span>");return V};var K=function(){var U="";var X=F.getEvents();for(var V=0;V<X.length;V++){var W='javascript:UIUtils.searchByWiring(URIs.GET_RESOURCES_BY_WIRING, "'+X[V]+'", "connectEvent");';U+=("<span class='multiple_size_tag'><a title='"+gettext("Search by ")+X[V]+"' href='"+W+"'>"+X[V]+"</a>"+((V<(X.length-1))?",":"")+"</span> ")}return U};var S=function(){var V="";var U=F.getAddedBy();if(U=="Yes"){V+=("<a href='javascript:UIUtils.deleteGadget()'>"+gettext("Delete Gadget")+":</a>")}return V};var A=function(){var X="";var W=F.getSlots();for(var U=0;U<W.length;U++){var V='javascript:UIUtils.searchByWiring(URIs.GET_RESOURCES_BY_WIRING, "'+W[U]+'", "connectSlot");';X+=("<span class='multiple_size_tag'><a title="+gettext("Search by ")+W[U]+"' href='"+V+"'>"+W[U]+"</a>"+((U<(W.length-1))?",":"")+"</span> ")}return X};var M=function(){var W="";var U="";var a=F.getTags();for(var X=0;X<a.length;X++){var V=F.getVersion();var Z=a[X].getAdded_by();if(a[X].getAdded_by()=="Yes"){var Y='javascript:UIUtils.removeTagUser("'+a[X].getValue()+'");';W+=("<a href='"+Y+"'><img src='/ezweb/images/cancel_gray.png'border=0 name=op1></a><span class='multiple_size_tag'>"+a[X].tagToTypedHTML()+((X<(a.length-1))?",":"")+"</span>")}else{W+=("<span class='multiple_size_tag'>"+a[X].tagToTypedHTML()+((X<(a.length-1))?",":"")+"</span>")}}return W};var L=function(){D=new HelpBalloon({returnElement:true,icon:"/ezweb/images/description_gray.png",altText:gettext("Description"),title:gettext("Description")+":",content:"<p class='description_balloon'>"+F.getDescription()+"</p>",imagePath:"/ezweb/js/lib/helpballoon/images/"});$(P+"_description").appendChild(D._elements.icon)};var Q=function(){H=new HelpBalloon({returnElement:true,icon:"/ezweb/images/more_tags_gray.png",altText:gettext("TagCloud"),title:gettext("TagCloud")+":",content:"<p class='tagcloud_balloon'>"+M()+"</p>",imagePath:"/ezweb/js/lib/helpballoon/images/"});$(P+"_tagcloud_balloon").appendChild(H._elements.icon)};var E=function(V){onError=function(W){alert("Error Resource POST")};loadResource=function(X){var W=X.responseXML;F=new ResourceState(W);this.paint()};var U=PersistenceEngineFactory.getInstance();U.send_post(url_Server,url_,this,loadResource,onError)};var F=null;var P=B;var I=new Tagger();var D=null;var H=null;if(G!=null){E(G)}else{F=new ResourceState(J);this.paint();this.paginate(N)}}function ResourceState(A){var H=null;var B=null;var G=null;var I=null;var C=null;var E=null;var D=null;var K=[];var F=[];var J=[];this.getVendor=function(){return H};this.getName=function(){return B};this.getVersion=function(){return G};this.getDescription=function(){return I};this.getUriImage=function(){return C};this.getUriTemplate=function(){return D};this.getUriWiki=function(){return E};this.getAddedBy=function(){return addedBy};this.setTags=function(L){K.clear();for(var M=0;M<L.length;M++){K.push(new Tag(L[M]))}};this.setSlots=function(L){F.clear();for(var M=0;M<L.length;M++){F.push(L[M].friendcode)}};this.setEvents=function(L){J.clear();for(var M=0;M<L.length;M++){J.push(L[M].friendcode)}};this.getTags=function(){return K};this.getSlots=function(){return F};this.getEvents=function(){return J};H=A.vendor;B=A.name;G=A.version;I=A.description;C=A.uriImage;E=A.uriWiki;addedBy=A.added_by;D=A.uriTemplate;this.setEvents(A.events);this.setSlots(A.slots);this.setTags(A.tags)}var CatalogueFactory=function(){var instance=null;function Catalogue(){var resources=new HashTable();this.emptyResourceList=function(){document.getElementById("resources").innerHTML="\n";document.getElementById("info_resource_content").innerHTML="\n";resources.clear()};this.getResources=function(){return resources};this.getResource=function(id_){return resources.getValue(id_)};this.addResource=function(resourceJSON_,urlTemplate_,items){resources.addElement("resource_"+resources.size(),new Resource("resource_"+resources.size(),resourceJSON_,urlTemplate_,items))};this.addResourceToShowCase=function(resourceId_){UIUtils.showResourceInfo(resourceId_);ShowcaseFactory.getInstance().addGadget(resources.getValue(resourceId_).getUriTemplate())};this.loadCatalogue=function(urlCatalogue_){var onError=function(transport,e){var msg;if(e){msg=interpolate(gettext("JavaScript exception on file %(errorFile)s (line: %(errorLine)s): %(errorDesc)s"),{errorFile:e.fileName,errorLine:e.lineNumber,errorDesc:e},true)}else{if(transport.responseXML){msg=transport.responseXML.documentElement.textContent}else{msg="HTTP Error "+transport.status+" - "+transport.statusText}}msg=interpolate(gettext("Error retreiving catalogue data: %(errorMsg)s."),{errorMsg:msg},true);OpManagerFactory.getInstance().log(msg);alert(gettext("Error retreiving catalogue data, please check the logs for further info."))};var loadResources=function(transport){var response=Try.these(function(){return new DOMParser().parseFromString(transport.responseText,"text/xml")},function(){var xmldom=new ActiveXObject("Microsoft.XMLDOM");xmldom.loadXML(transport.responseText);return xmldom});var responseJSON=transport.responseText;var items=transport.getResponseHeader("items");var jsonResourceList=eval("("+responseJSON+")");jsonResourceList=jsonResourceList.resourceList;for(var i=0;i<jsonResourceList.length;i++){this.addResource(jsonResourceList[i],null,items)}};var persistenceEngine=PersistenceEngineFactory.getInstance();persistenceEngine.send_get(urlCatalogue_,this,loadResources,onError)}}return new function(){this.getInstance=function(){if(instance==null){instance=new Catalogue()}return instance}}}();function wiringInterface(){this.loaded=false;w=WiringFactory.getInstance()}wiringInterface.prototype.unloaded=function(){this.loaded=false;this._hideItems();$("eventsConnection").innerHTML="";$("slotsConnection").innerHTML="";$("events").innerHTML="";$("slots").innerHTML="";$("selectCanal").innerHTML="";$("wCanales").innerHTML="";$("wGadgets").innerHTML="";var A=document.createElement("option");A.setAttribute("value","");A.setAttribute("selected",true);var B=document.createTextNode("----");A.appendChild(B);$("selectCanal").appendChild(A);this.renewItem(WiringFactory.getInstance(),"","eventsConnection","slotsConnection")};wiringInterface.prototype.addChannelInterface=function(B,A,D){var C=document.createElement("option");C.setAttribute("id","option_select_"+B);C.setAttribute("selected",true);var E=document.createTextNode(B);C.appendChild(E);A.appendChild(C);var C=document.createElement("option");var E=document.createTextNode(B);C.setAttribute("id","option_itemize_"+B);C.appendChild(E);D.appendChild(C)};wiringInterface.prototype.addGadgetInterface=function(B,A){var C=document.createElement("option");C.setAttribute("id",B.id);C.setAttribute("value",B.id);var D=document.createTextNode(B.name+"_"+B.id);C.appendChild(D);A.appendChild(C)};wiringInterface.prototype.renewInterface=function(D,C,B,H){D.edition();if(!this.loaded){var E=D.getGadgetsId();var A=D.getInOutsId();for(var G=0;G<E.length;G++){this.addGadgetInterface(E[G],B)}for(var F=0;F<A.length;F++){this.addChannelInterface(A[F],C,H)}C.value="";this.loaded=true}};wiringInterface.prototype.addChannel=function(C,B,G,F,E){var A=null;var D=prompt("Insert Channel Name:","Channel Name...");if(D!=null){if(!(A=C.createChannel(D))){this.addChannelInterface(D,B,G);this.renewChannel(C,D,F,E)}}};wiringInterface.prototype.deleteChannel=function(C,D,B,H,F,E){var A=null;if(!(A=C.removeChannel(D))){var G=$("option_select_"+D);B.removeChild(G);var G=$("option_itemize_"+D);H.removeChild(G);this.renewChannel(C,"",F,E)}};wiringInterface.prototype.renewChannel=function(F,D,E,H){E.innerHTML="";H.innerHTML="";if(D!=""){this._nameChannel(D);var I=F.connections(D);var C=I.input;var G=I.output;$("valor").value=F.viewValue(D);for(var B=0;B<C.length;B++){this.addChannelLine(F,H,"w.removeChannelInput",C[B].gadgetName,C[B].id,C[B].name)}for(var A=0;A<G.length;A++){this.addChannelLine(F,E,"w.removeChannelOutput",G[A].gadgetName,G[A].id,G[A].name)}this._showItems()}};wiringInterface.prototype.renewItem=function(A,B,F,E){F.innerHTML="";E.innerHTML="";if(B!=""){var D=A.gadgetConnections(B);if(D){for(var C=0;C<D.length;C++){if(D[C].aspect=="SLOT"){this.addLine(A,F,"w.addChannelOutput",B,D[C].name)}else{this.addLine(A,E,"w.addChannelInput",B,D[C].name)}}}else{this.addLine(A,E,"w.addChannelInput","null",B);this.addLine(A,F,"w.addChannelOutput","null",B)}}};wiringInterface.prototype.addLine=function(G,I,C,B,A){var J=document.createElement("tr");var F=document.createElement("td");var E=document.createElement("td");var D=document.createElement("input");var H;if(B=="null"||B==null){H=document.createTextNode(A);D.setAttribute("onClick",C+"('"+A+"', $F('selectCanal'));wI.renewChannel(w,$F('selectCanal'),$('slotsConnection'),$('eventsConnection'))")}else{H=document.createTextNode(B+"::"+A);D.setAttribute("onClick",C+"('"+B+"','"+A+"', $F('selectCanal'));wI.renewChannel(w,$F('selectCanal'),$('slotsConnection'),$('eventsConnection'))")}D.setAttribute("type","image");D.setAttribute("src","/ezweb/js/wiring/tick.png");D.setAttribute("title","add connection");F.appendChild(D);E.appendChild(H);J.setAttribute("class",B);J.setAttribute("id",A);J.appendChild(F);J.appendChild(E);I.appendChild(J)};wiringInterface.prototype.addChannelLine=function(H,J,C,G,B,A){var K=document.createElement("tr");var F=document.createElement("td");var E=document.createElement("td");var D=document.createElement("input");var I;if(B=="null"||B==null){I=document.createTextNode(A);D.setAttribute("onClick",C+"('"+A+"', $F('selectCanal'));wI.renewChannel(w,$F('selectCanal'),$('slotsConnection'),$('eventsConnection'))")}else{I=document.createTextNode(G+"_"+B+"::"+A);D.setAttribute("onClick",C+"('"+B+"','"+A+"', $F('selectCanal'));wI.renewChannel(w,$F('selectCanal'),$('slotsConnection'),$('eventsConnection'))")}D.setAttribute("type","image");D.setAttribute("src","/ezweb/js/wiring/cross.png");D.setAttribute("title","delete connection");F.appendChild(D);E.appendChild(I);K.setAttribute("class",B);K.setAttribute("id",A);K.appendChild(F);K.appendChild(E);J.appendChild(K)};wiringInterface.prototype._showItems=function(){$("items_panel").style.visibility="visible"};wiringInterface.prototype._hideItems=function(){$("items_panel").style.visibility="hidden"};wiringInterface.prototype._nameChannel=function(B){var C=$("input_header");var A=$("output_header");var D=C.firstChild;if(D!=undefined){C.removeChild(D);A.removeChild(A.firstChild)}channelName1=document.createTextNode(B);channelName2=document.createTextNode(B);C.appendChild(channelName1);A.appendChild(channelName2)};this.color_scheme.push("#a6ffbf");this.color_scheme.push("#7a5e85");this.color_scheme.push("#b3f0ff");this.color_scheme.push("#cf36ff");this.color_scheme.push("#5496ff");this.color_scheme.push("#e854ff");this.color_scheme.push("#662500");this.color_scheme.push("#5a9e68");this.color_scheme.push("#bf6900");this.color_scheme.push("#a17800");this.color_scheme.push("#72cc85");this.color_scheme.push("#e6ff42");this.color_scheme.push("#becfbc");this.color_scheme.push("#005710");this.color_scheme.push("#00193f");this.color_scheme.push("#e0fffa");this.color_scheme.push("#f0ff3d");this.color_scheme.push("#f0d8d3");this.color_scheme.push("#ab5c00");this.color_scheme.push("#3c008f");this.color_scheme.push("#d6ff8a");this.color_scheme.push("#fac0e1");this.color_scheme.push("#4700ad");this.color_scheme.push("#ccc6ad");this.color_scheme.push("#261e06");this.color_scheme.push("#4fedff");this.color_scheme.push("#e6bebc");this.color_scheme.push("#f0ed73");this.color_scheme.push("#4f1800");this.color_scheme.push("#020073");this.color_scheme.push("#0fff00");this.color_scheme.push("#686b00");this.color_scheme.push("#804dff");this.color_scheme.push("#b100bd");this.color_scheme.push("#69ffab");this.color_scheme.push("#e6acb8");this.color_scheme.push("#8c7a77");this.color_scheme.push("#006bfa");this.color_scheme.push("#8cffab");this.color_scheme.push("#d1d190");this.color_scheme.push("#0d4000");this.color_scheme.push("#f0e8c4");this.color_scheme.push("#0048e8");this.color_scheme.push("#b8ffe0");this.color_scheme.push("#5effe0");this.color_scheme.push("#770000");this.color_scheme.push("#913dff");this.color_scheme.push("#5357cf");this.color_scheme.push("#b3ab00");this.color_scheme.push("#b3ffeb");this.color_scheme.push("#ffb08f");this.color_scheme.push("#ffbff5");this.color_scheme.push("#40ffed");this.color_scheme.push("#e6dfcf");this.color_scheme.push("#f0f2ff");this.color_scheme.push("#d1ffeb");this.color_scheme.push("#91ffe6");this.color_scheme.push("#2800b0");this.color_scheme.push("#c4ffde");this.color_scheme.push("#a82fe0");this.color_scheme.push("#ff5200");this.color_scheme.push("#ed9eff");this.color_scheme.push("#5c97e6");this.color_scheme.push("#ff0dba");this.color_scheme.push("#1c778c");this.color_scheme.push("#0058a1");this.color_scheme.push("#f7cbb2");this.color_scheme.push("#8f2e00");this.color_scheme.push("#631cff");this.color_scheme.push("#a5cf00");this.color_scheme.push("#997354");this.color_scheme.push("#ff73eb");this.color_scheme.push("#c41200");this.color_scheme.push("#3b00ed");this.color_scheme.push("#13f2ce");this.color_scheme.push("#ff8ac7");this.color_scheme.push("#ffbae0");this.color_scheme.push("#91ffba");this.color_scheme.push("#ff78cc");this.color_scheme.push("#ccccba");this.color_scheme.push("#e38db3");this.color_scheme.push("#000887");this.color_scheme.push("#d6cbc9");this.color_scheme.push("#a33100");this.color_scheme.push("#c1d6d0");this.color_scheme.push("#4696e3");this.color_scheme.push("#d19b73");this.color_scheme.push("#69005e");this.color_scheme.push("#001a75");this.color_scheme.push("#f7a8ff");this.color_scheme.push("#050f07");this.color_scheme.push("#e00053");this.color_scheme.push("#ffa1e6");this.color_scheme.push("#cfe8ff");this.color_scheme.push("#349400");this.color_scheme.push("#e300ff");this.color_scheme.push("#ff8a45");this.color_scheme.push("#e66000");this.color_scheme.push("#202700");this.color_scheme.push("#b8743b");this.color_scheme.push("#823126");this.color_scheme.push("#ffa87a");this.color_scheme.push("#ede800");this.color_scheme.push("#690369");this.color_scheme.push("#baa600");this.color_scheme.push("#969200");this.color_scheme.push("#9db39d");this.color_scheme.push("#98d9ad");this.color_scheme.push("#99a3ff");this.color_scheme.push("#85ffb5");this.color_scheme.push("#f5f28f");this.color_scheme.push("#dc7ee0");this.color_scheme.push("#f7f71e");this.color_scheme.push("#1ab058");this.color_scheme.push("#52a8ff");this.color_scheme.push("#eb6300");this.color_scheme.push("#d45500");this.color_scheme.push("#80806b");this.color_scheme.push("#73ffe8");this.color_scheme.push("#fff2b0");this.color_scheme.push("#0900e6");this.color_scheme.push("#ffd461");this.color_scheme.push("#2bffe6");this.color_scheme.push("#b3fff2");this.color_scheme.push("#d10073");this.color_scheme.push("#ffa61a");this.color_scheme.push("#f2c279");this.color_scheme.push("#f754ff");this.color_scheme.push("#82e3ff");this.color_scheme.push("#004744");this.color_scheme.push("#e09270");this.color_scheme.push("#82ffb8");this.color_scheme.push("#6100ce");this.color_scheme.push("#e0d700");this.color_scheme.push("#b8e4f5");this.color_scheme.push("#d400b8");this.color_scheme.push("#a3ff82");this.color_scheme.push("#02631c");this.color_scheme.push("#b3b15f");this.color_scheme.push("#ccff8f");this.color_scheme.push("#8bccf0");this.color_scheme.push("#f5f584");this.color_scheme.push("#cf005b");this.color_scheme.push("#fcfc4e");this.color_scheme.push("#e9f0ce");this.color_scheme.push("#c8cffa");this.color_scheme.push("#ffe34f");this.color_scheme.push("#61ed00");this.color_scheme.push("#4a1a00");this.color_scheme.push("#ffd1f7");this.color_scheme.push("#918779");this.color_scheme.push("#ba9900");this.color_scheme.push("#9effad");this.color_scheme.push("#91ffc2");this.color_scheme.push("#00246b");this.color_scheme.push("#a38b24");this.color_scheme.push("#ede6e8");this.color_scheme.push("#ff9cf0");this.color_scheme.push("#b399ff");this.color_scheme.push("#ccd4ff");this.color_scheme.push("#600000");this.color_scheme.push("#46e800");this.color_scheme.push("#c7f2e1");this.color_scheme.push("#594a2d");this.color_scheme.push("#660057");this.color_scheme.push("#6e8cff");this.color_scheme.push("#3d0c4e");this.color_scheme.push("#9ce6ae");this.color_scheme.push("#009e78");this.color_scheme.push("#001f8f");this.color_scheme.push("#ff7852");this.color_scheme.push("#ebff26");this.color_scheme.push("#0073e6");this.color_scheme.push("#f05eff");this.color_scheme.push("#00decc");this.color_scheme.push("#ffba75");this.color_scheme.push("#f283bb");this.color_scheme.push("#ff690a");this.color_scheme.push("#e6d4e6");this.color_scheme.push("#999632");this.color_scheme.push("#d4c581");this.color_scheme.push("#472200");this.color_scheme.push("#3378ff");this.color_scheme.push("#a8ffcf");this.color_scheme.push("#942200");this.color_scheme.push("#fc7aff");this.color_scheme.push("#d4b3eb");this.color_scheme.push("#474747");this.color_scheme.push("#7700bd");this.color_scheme.push("#82fcff");this.color_scheme.push("#2e522b");this.color_scheme.push("#e6dbff");this.color_scheme.push("#004f24");this.color_scheme.push("#91a1ff");this.color_scheme.push("#a6b3b3");this.color_scheme.push("#00d477");this.color_scheme.push("#70ffbd");this.color_scheme.push("#ff0061");this.color_scheme.push("#a60095");this.color_scheme.push("#917c00");this.color_scheme.push("#c2ebff");this.color_scheme.push("#ffe3eb");this.color_scheme.push("#8f8f8f");this.color_scheme.push("#ffc2e3");this.color_scheme.push("#bee3fa");this.color_scheme.push("#002d75");this.color_scheme.push("#2d3e00");this.color_scheme.push("#ffff7d");this.color_scheme.push("#e6bdff");this.color_scheme.push("#87ffad");this.color_scheme.push("#f0edaf");this.color_scheme.push("#dcfab9");this.color_scheme.push("#436600");this.color_scheme.push("#56adba");this.color_scheme.push("#636363");this.color_scheme.push("#f50002");this.color_scheme.push("#e37b00");this.color_scheme.push("#381c00");this.color_scheme.push("#8a8c8a");this.color_scheme.push("#d4740b");this.color_scheme.push("#005940");this.color_scheme.push("#3f5410");this.color_scheme.push("#4f3a00");this.color_scheme.push("#547306");this.color_scheme.push("#ff8ce6");this.color_scheme.push("#d9a6ff");this.color_scheme.push("#cf00c0");this.color_scheme.push("#000bd9");this.color_scheme.push("#143319");this.color_scheme.push("#5e00bf");this.color_scheme.push("#105249");this.color_scheme.push("#c270ff");this.color_scheme.push("#500099");this.color_scheme.push("#b8cdd4");this.color_scheme.push("#ff0073");this.color_scheme.push("#187031");this.color_scheme.push("#ffd1ff");this.color_scheme.push("#edf0ff");this.color_scheme.push("#fc2bff");this.color_scheme.push("#8000ff");this.color_scheme.push("#f7ebff");this.color_scheme.push("#0026bd");this.color_scheme.push("#de004b");this.color_scheme.push("#e3ff0f");this.color_scheme.push("#dbe3bf");this.color_scheme.push("#495c5e");this.color_scheme.push("#c7abff");this.color_scheme.push("#90b000");this.color_scheme.push("#ffc20f");this.color_scheme.push("#1a6eff");this.color_scheme.push("#78004f");this.color_scheme.push("#ff9c85");this.color_scheme.push("#ffed80");this.color_scheme.push("#96ff38");this.color_scheme.push("#f2e0f7");this.color_scheme.push("#ccff17");this.color_scheme.push("#002caa");this.color_scheme.push("#00f2e6");this.color_scheme.push("#8cb5ff");this.color_scheme.push("#a14c00");this.color_scheme.push("#ffc794");this.color_scheme.push("#381100");this.color_scheme.push("#fffad9");this.color_scheme.push("#7d5b00");this.color_scheme.push("#858c8c");this.color_scheme.push("#320000");this.color_scheme.push("#ffcf66");this.color_scheme.push("#d6d0c9");this.color_scheme.push("#fff2d9");this.color_scheme.push("#ffb3db");this.color_scheme.push("#d980ff");this.color_scheme.push("#b7eb00");this.color_scheme.push("#73c9ad");this.color_scheme.push("#b5b500");this.color_scheme.push("#c6ccb8");this.color_scheme.push("#a1ffd1");this.color_scheme.push("#c2ff6e");this.color_scheme.push("#69660e");this.color_scheme.push("#00399e");this.color_scheme.push("#f2b896");this.color_scheme.push("#a87b00");this.color_scheme.push("#2e00d9");this.color_scheme.push("#ada687");this.color_scheme.push("#fc5eff");this.color_scheme.push("#5ba621");this.color_scheme.push("#fab0ff");this.color_scheme.push("#9673ff");this.color_scheme.push("#ababab");this.color_scheme.push("#abb573");this.color_scheme.push("#324031");this.color_scheme.push("#80735d");this.color_scheme.push("#ffb8ff");this.color_scheme.push("#e0ffb5");this.color_scheme.push("#bfa87c");this.color_scheme.push("#003473");this.color_scheme.push("#fa63ff");this.color_scheme.push("#87ffe3");this.color_scheme.push("#fc7c00");this.color_scheme.push("#ffba3d");this.color_scheme.push("#a63a00");this.color_scheme.push("#a1ffcc");this.color_scheme.push("#00b3a2");this.color_scheme.push("#004ecc");this.color_scheme.push("#127a38");this.color_scheme.push("#705c59");this.color_scheme.push("#bed1c5");this.color_scheme.push("#9600fa");this.color_scheme.push("#f2e0de");this.color_scheme.push("#0017ff");this.color_scheme.push("#3e7800");this.color_scheme.push("#5effd1");this.color_scheme.push("#003440");this.color_scheme.push("#0e4d1c");this.color_scheme.push("#64a7e8");this.color_scheme.push("#ba87ff");this.color_scheme.push("#f0d9ff");this.color_scheme.push("#661aff");this.color_scheme.push("#fae6c0");this.color_scheme.push("#0a4fff");this.color_scheme.push("#ccdcde");this.color_scheme.push("#002675");this.color_scheme.push("#9effa3");this.color_scheme.push("#8257b8");this.color_scheme.push("#00f2f2");this.color_scheme.push("#e8cff2");this.color_scheme.push("#80adff");this.color_scheme.push("#ff4040");this.color_scheme.push("#ff0052");this.color_scheme.push("#f5d093");this.color_scheme.push("#ff40b3");this.color_scheme.push("#a5b85e");this.color_scheme.push("#b80007");this.color_scheme.push("#ffd9c7");this.color_scheme.push("#4fffa1");this.color_scheme.push("#ff6bf7");this.color_scheme.push("#ffb8ed");this.color_scheme.push("#d62463");this.color_scheme.push("#ff73c7");this.color_scheme.push("#a85868");this.color_scheme.push("#ff291f");this.color_scheme.push("#66ba80");this.color_scheme.push("#ff173d");this.color_scheme.push("#ffbde6");this.color_scheme.push("#663d2e");this.color_scheme.push("#95c5f0");this.color_scheme.push("#b3ad00");this.color_scheme.push("#9d27a8");this.color_scheme.push("#47342e");this.color_scheme.push("#00c49f");this.color_scheme.push("#7280c4");this.color_scheme.push("#ffc2e6");this.color_scheme.push("#e33000");this.color_scheme.push("#000000");this.color_scheme.push("#a10040");this.color_scheme.push("#0affe3");this.color_scheme.push("#00523c");this.color_scheme.push("#919100");this.color_scheme.push("#5c00f7");this.color_scheme.push("#ffabde");this.color_scheme.push("#cce6ff");this.color_scheme.push("#00465c");this.color_scheme.push("#ff73c7");this.color_scheme.push("#330e00");this.color_scheme.push("#001ed9");this.color_scheme.push("#ff8c47");this.color_scheme.push("#001ad9");this.color_scheme.push("#d1ed77");this.color_scheme.push("#a10067");this.color_scheme.push("#4500ff");this.color_scheme.push("#b5ff00");this.color_scheme.push("#00e8c3");this.color_scheme.push("#3f0073");this.color_scheme.push("#82074e");this.color_scheme.push("#800400");this.color_scheme.push("#86b324");this.color_scheme.push("#cede99");this.color_scheme.push("#a3d982");this.color_scheme.push("#b38ce0");this.color_scheme.push("#4fff00");this.color_scheme.push("#d9b200");this.color_scheme.push("#cca6ff");this.color_scheme.push("#f2baff");this.color_scheme.push("#b387ff");this.color_scheme.push("#ffcccc");this.color_scheme.push("#bdaeac");this.color_scheme.push("#ffe6bf");this.color_scheme.push("#cdf7a3");this.color_scheme.push("#0d4018");this.color_scheme.push("#f7dfe1");this.color_scheme.push("#969684");this.color_scheme.push("#abb800");this.color_scheme.push("#00274d");this.color_scheme.push("#050403");this.color_scheme.push("#ff8500");this.color_scheme.push("#ffe88c");this.color_scheme.push("#f7c9ff");this.color_scheme.push("#b34f00");this.color_scheme.push("#872300");this.color_scheme.push("#bdbdbd");this.color_scheme.push("#ff00ff");this.color_scheme.push("#00b53c");this.color_scheme.push("#e0c791");this.color_scheme.push("#ffd100");this.color_scheme.push("#bb00c7");this.color_scheme.push("#2d393b");this.color_scheme.push("#327a3d");this.color_scheme.push("#fffc0d");this.color_scheme.push("#c47a8f");this.color_scheme.push("#d1b0ff");this.color_scheme.push("#66ff80");this.color_scheme.push("#fa7000");this.color_scheme.push("#e8d9a8");this.color_scheme.push("#ffc2ed");this.color_scheme.push("#b83d00");this.color_scheme.push("#cae6cc");this.color_scheme.push("#0079db");this.color_scheme.push("#ffe38c");this.color_scheme.push("#ada089");this.color_scheme.push("#00bfac");this.color_scheme.push("#ffd6a1");this.color_scheme.push("#00a66f");this.color_scheme.push("#006327");this.color_scheme.push("#ffbfd1");this.color_scheme.push("#fff536");this.color_scheme.push("#d15473");this.color_scheme.push("#ba0dff");this.color_scheme.push("#a8b3e6");this.color_scheme.push("#a85b00");this.color_scheme.push("#59b386");this.color_scheme.push("#117300");this.color_scheme.push("#a4a6ed");this.color_scheme.push("#ffd6cf");this.color_scheme.push("#fcfccf");this.color_scheme.push("#f0ff70");this.color_scheme.push("#f7f7a6");this.color_scheme.push("#ffa6b8");this.color_scheme.push("#706758");this.color_scheme.push("#ffff36");this.color_scheme.push("#2600ff");this.color_scheme.push("#cef0d8");this.color_scheme.push("#dedea6");this.color_scheme.push("#b08573");this.color_scheme.push("#003359");this.color_scheme.push("#ffcf7d");this.color_scheme.push("#6b3d00");this.color_scheme.push("#1aff82");this.color_scheme.push("#525b5c");this.color_scheme.push("#ffe8f2");this.color_scheme.push("#00048c");this.color_scheme.push("#689900");this.color_scheme.push("#cc2976");this.color_scheme.push("#ffd4f0");this.color_scheme.push("#c15ff5");this.color_scheme.push("#33ff40");this.color_scheme.push("#e8e397");this.color_scheme.push("#7e947e");this.color_scheme.push("#00471d");this.color_scheme.push("#ffd9e3");this.color_scheme.push("#edccff");this.color_scheme.push("#f7ff26");this.color_scheme.push("#0000b8");this.color_scheme.push("#314a0e");this.color_scheme.push("#5e3c00");this.color_scheme.push("#ff4acc");this.color_scheme.push("#750082");this.color_scheme.push("#002b24");this.color_scheme.push("#ffd433");this.color_scheme.push("#3b3b3b");this.color_scheme.push("#74f200");this.color_scheme.push("#0045a1");this.color_scheme.push("#b51aff");this.color_scheme.push("#f7ff73");this.color_scheme.push("#00c487");this.color_scheme.push("#b89c00");this.color_scheme.push("#00227b");this.color_scheme.push("#00c21d");this.color_scheme.push("#000bb5");this.color_scheme.push("#585943");this.color_scheme.push("#ff9ec9");this.color_scheme.push("#4f9c00");this.color_scheme.push("#5c5900");this.color_scheme.push("#fcd7e8");this.color_scheme.push("#dbffe8");this.color_scheme.push("#002b7a");this.color_scheme.push("#a1b5a8");this.color_scheme.push("#79a6ad");this.color_scheme.push("#d19052");this.color_scheme.push("#fcb3ff");this.color_scheme.push("#f2d1ff");this.color_scheme.push("#008fff");this.color_scheme.push("#96ccff");this.color_scheme.push("#008a4a");this.color_scheme.push("#003bd1");this.color_scheme.push("#ffe359");this.color_scheme.push("#00223d");this.color_scheme.push("#ffe833");this.color_scheme.push("#cd00f7");this.color_scheme.push("#ffe8f2");this.color_scheme.push("#5f00d9");this.color_scheme.push("#e89eff");this.color_scheme.push("#e336ff");this.color_scheme.push("#afba86");this.color_scheme.push("#26c2ff");this.color_scheme.push("#c5e693");this.color_scheme.push("#79fcac");this.color_scheme.push("#f20068");this.color_scheme.push("#0056c4");this.color_scheme.push("#8cffe8");this.color_scheme.push("#ab4800");this.color_scheme.push("#ffdb87");this.color_scheme.push("#735022");this.color_scheme.push("#3d5200");this.color_scheme.push("#73173f");this.color_scheme.push("#abf7ff");this.color_scheme.push("#00663a");this.color_scheme.push("#7582ff");this.color_scheme.push("#ed8a00");this.color_scheme.push("#e6b577");this.color_scheme.push("#6b1200");this.color_scheme.push("#1c91ff");this.color_scheme.push("#f7bc77");this.color_scheme.push("#00b33e");this.color_scheme.push("#a2b39b");this.color_scheme.push("#b59ec2");this.color_scheme.push("#e8ff78");this.color_scheme.push("#a2d7de");this.color_scheme.push("#fadeff");this.color_scheme.push("#506700");this.color_scheme.push("#bdb8ff");this.color_scheme.push("#6bc200");this.color_scheme.push("#00c95f");this.color_scheme.push("#f5002f");this.color_scheme.push("#cfa6ff");this.color_scheme.push("#0055c9");this.color_scheme.push("#6b9aed");this.color_scheme.push("#7bc1c9");this.color_scheme.push("#95ab00");this.color_scheme.push("#ba0079");this.color_scheme.push("#394500");this.color_scheme.push("#b3ad17");this.color_scheme.push("#f2a3e3");this.color_scheme.push("#dbf5ff");this.color_scheme.push("#cc7a85");this.color_scheme.push("#e8ff6b");this.color_scheme.push("#c7f7ff");this.color_scheme.push("#0005b3");this.color_scheme.push("#90f0e4");this.color_scheme.push("#fcd7a7");this.color_scheme.push("#0031ad");this.color_scheme.push("#c2bfbf");this.color_scheme.push("#b3ff8c");this.color_scheme.push("#fff0b3");this.color_scheme.push("#ffb30d");this.color_scheme.push("#ffa64d");this.color_scheme.push("#662400");this.color_scheme.push("#e8edd6");this.color_scheme.push("#006635");this.color_scheme.push("#f7f2d2");this.color_scheme.push("#c459cf");this.color_scheme.push("#000d09");this.color_scheme.push("#a300ff");this.color_scheme.push("#ffe833");this.color_scheme.push("#2e005c");this.color_scheme.push("#d19700");this.color_scheme.push("#e4e4f2");this.color_scheme.push("#dae6d5");this.color_scheme.push("#003b42");this.color_scheme.push("#00f26d");this.color_scheme.push("#ebff00");this.color_scheme.push("#d4ffd6");this.color_scheme.push("#ffa8f7");this.color_scheme.push("#4bab60");this.color_scheme.push("#c7dbf7");this.color_scheme.push("#4a94ff");this.color_scheme.push("#ffbdcf");this.color_scheme.push("#004741");this.color_scheme.push("#0d0b4d");this.color_scheme.push("#00f763");this.color_scheme.push("#f782ff");this.color_scheme.push("#87ffc2");this.color_scheme.push("#6166ff");this.color_scheme.push("#89a386");this.color_scheme.push("#b36259");this.color_scheme.push("#008087");this.color_scheme.push("#f0ff00");this.color_scheme.push("#04d45b");this.color_scheme.push("#738639");this.color_scheme.push("#73002e");this.color_scheme.push("#c47c00");this.color_scheme.push("#e6ccff");this.color_scheme.push("#6bff33");this.color_scheme.push("#1ae3ff");this.color_scheme.push("#29ff70");this.color_scheme.push("#00912a");this.color_scheme.push("#ff6ba3");this.color_scheme.push("#c2cf9c");this.color_scheme.push("#ffd600");this.color_scheme.push("#e3b122");this.color_scheme.push("#8a47ff");this.color_scheme.push("#009421");this.color_scheme.push("#d9edfc");this.color_scheme.push("#807c00");this.color_scheme.push("#d4cf6e");this.color_scheme.push("#ff6666");this.color_scheme.push("#ffff7d");this.color_scheme.push("#5fded1");this.color_scheme.push("#006080");this.color_scheme.push("#d17100");this.color_scheme.push("#fff00d");this.color_scheme.push("#db78ff");this.color_scheme.push("#ff701a");this.color_scheme.push("#cc002b");this.color_scheme.push("#471300");this.color_scheme.push("#ff579e");this.color_scheme.push("#263300");this.color_scheme.push("#008a46");this.color_scheme.push("#96faff");this.color_scheme.push("#baffbf");this.color_scheme.push("#7a1a00");this.color_scheme.push("#fabaff");this.color_scheme.push("#f0ccff");this.color_scheme.push("#0dffbf");this.color_scheme.push("#f0ffe6");this.color_scheme.push("#cffff0");this.color_scheme.push("#9cdbff");this.color_scheme.push("#bfffe6");this.color_scheme.push("#d10fff");this.color_scheme.push("#fc1fff");this.color_scheme.push("#000dff");this.color_scheme.push("#755600");this.color_scheme.push("#48705d");this.color_scheme.push("#a8625d");this.color_scheme.push("#9cdbc5");this.color_scheme.push("#e89e00");this.color_scheme.push("#e3aac1");this.color_scheme.push("#eb7c00");this.color_scheme.push("#272e20");this.color_scheme.push("#b3ffcc");this.color_scheme.push("#9e8e00");this.color_scheme.push("#f2ff99");this.color_scheme.push("#361aff");this.color_scheme.push("#9effd9");this.color_scheme.push("#705100");this.color_scheme.push("#1d4230");this.color_scheme.push("#f2b5ff");this.color_scheme.push("#823b00");this.color_scheme.push("#ed18a6");this.color_scheme.push("#00395c");this.color_scheme.push("#84bd8f");this.color_scheme.push("#baf5c6");this.color_scheme.push("#d4bad9");this.color_scheme.push("#2b0041");this.color_scheme.push("#000000");this.color_scheme.push("#ffe3cc");this.color_scheme.push("#e6e1d3");this.color_scheme.push("#ffe680");this.color_scheme.push("#d9b5b0");this.color_scheme.push("#edd100");this.color_scheme.push("#baedff");this.color_scheme.push("#ffd63b");this.color_scheme.push("#ff8717");this.color_scheme.push("#5c6e1d");this.color_scheme.push("#f7baf7");this.color_scheme.push("#00eda4");this.color_scheme.push("#d4a1ff");this.color_scheme.push("#e683ba");this.color_scheme.push("#ff991a");this.color_scheme.push("#a9d4b2");this.color_scheme.push("#9e4a00");this.color_scheme.push("#a89796");this.color_scheme.push("#f0ad00");this.color_scheme.push("#ffff99");this.color_scheme.push("#b0c7f2");this.color_scheme.push("#d9fae1");this.color_scheme.push("#baffc4");this.color_scheme.push("#bf827c");this.color_scheme.push("#5fed2f");this.color_scheme.push("#570900");this.color_scheme.push("#91ffe0");this.color_scheme.push("#91ff66");this.color_scheme.push("#ffbf0d");this.color_scheme.push("#6970db");this.color_scheme.push("#ffdbb0");this.color_scheme.push("#e3da9f");this.color_scheme.push("#008754");this.color_scheme.push("#692d00");this.color_scheme.push("#f5e4d3");this.color_scheme.push("#7affbf");this.color_scheme.push("#827200");this.color_scheme.push("#dae8d8");this.color_scheme.push("#5000d9");this.color_scheme.push("#ff998f");this.color_scheme.push("#adc6f7");this.color_scheme.push("#829e90");this.color_scheme.push("#2600ab");this.color_scheme.push("#ccffb3");this.color_scheme.push("#0020fa");this.color_scheme.push("#175e22");this.color_scheme.push("#090c0d");this.color_scheme.push("#00a0fa");this.color_scheme.push("#ccad6b");this.color_scheme.push("#fff5d1");this.color_scheme.push("#474030");this.color_scheme.push("#4f00db");this.color_scheme.push("#3848a8");this.color_scheme.push("#ffe600");this.color_scheme.push("#753700");this.color_scheme.push("#d1ffdb");this.color_scheme.push("#e39f40");this.color_scheme.push("#0089cc");this.color_scheme.push("#8a5eff");this.color_scheme.push("#f0f065");this.color_scheme.push("#fafaaa");this.color_scheme.push("#e6e645");this.color_scheme.push("#f2cea0");this.color_scheme.push("#423500");this.color_scheme.push("#ffe0b8");this.color_scheme.push("#b5a3ff");this.color_scheme.push("#9d00eb");this.color_scheme.push("#dba8ff");this.color_scheme.push("#ff914d");this.color_scheme.push("#73ff80");this.color_scheme.push("#f0e9c2");this.color_scheme.push("#c0f090");this.color_scheme.push("#63ff8c");this.color_scheme.push("#ff8257");this.color_scheme.push("#ffa882");this.color_scheme.push("#ffc487");this.color_scheme.push("#ffb300");this.color_scheme.push("#dae8e8");this.color_scheme.push("#ff6970");this.color_scheme.push("#ffb373");this.color_scheme.push("#ff366b");this.color_scheme.push("#dce8b0");this.color_scheme.push("#ff8aff");this.color_scheme.push("#ff87b5");this.color_scheme.push("#e667df");this.color_scheme.push("#a380ff");this.color_scheme.push("#6957ff");this.color_scheme.push("#d1cb00");this.color_scheme.push("#00abb3");this.color_scheme.push("#80ffbf");this.color_scheme.push("#00ff8f");this.color_scheme.push("#e18efa");this.color_scheme.push("#ff5296");this.color_scheme.push("#facffa");this.color_scheme.push("#ed5100");this.color_scheme.push("#e6bc9c");this.color_scheme.push("#20258a");this.color_scheme.push("#00ed77");this.color_scheme.push("#3ec200");this.color_scheme.push("#baff9e");this.color_scheme.push("#991846");this.color_scheme.push("#030091");this.color_scheme.push("#04290a");this.color_scheme.push("#102e14");this.color_scheme.push("#ab003e");this.color_scheme.push("#00a5b8");this.color_scheme.push("#0020b3");this.color_scheme.push("#4affab");this.color_scheme.push("#69edff");this.color_scheme.push("#ff5c00");this.color_scheme.push("#008aff");this.color_scheme.push("#d9a9a7");this.color_scheme.push("#96e3ff");this.color_scheme.push("#de9cff");this.color_scheme.push("#ffdeff");this.color_scheme.push("#de82c4");this.color_scheme.push("#edf2f2");this.color_scheme.push("#5f9e00");this.color_scheme.push("#ff6308");this.color_scheme.push("#5ca6ff");this.color_scheme.push("#26ff59");this.color_scheme.push("#e3e3e3");this.color_scheme.push("#fccfe3");this.color_scheme.push("#b0baff");this.color_scheme.push("#eb009b");this.color_scheme.push("#f0a8d3");this.color_scheme.push("#ffd4e6");this.color_scheme.push("#a0a395");this.color_scheme.push("#009cba");this.color_scheme.push("#4dffc4");this.color_scheme.push("#ff8ac9");this.color_scheme.push("#849c32");this.color_scheme.push("#f57300");this.color_scheme.push("#00c72e");this.color_scheme.push("#fa0032");this.color_scheme.push("#c7ceed");this.color_scheme.push("#243600");this.color_scheme.push("#b5e0ff");this.color_scheme.push("#ffed57");this.color_scheme.push("#a800ff");this.color_scheme.push("#f7b5d7");this.color_scheme.push("#00e84f");this.color_scheme.push("#ebebc0");this.color_scheme.push("#ffa626");this.color_scheme.push("#8a1fff");this.color_scheme.push("#c9d1a5");this.color_scheme.push("#21ff9e");this.color_scheme.push("#6b85ff");this.color_scheme.push("#b8ffdb");this.color_scheme.push("#008013");this.color_scheme.push("#8a9799");this.color_scheme.push("#361500");this.color_scheme.push("#69fff0");this.color_scheme.push("#fc9200");this.color_scheme.push("#003bd1");this.color_scheme.push("#e3e8ff");this.color_scheme.push("#b80040");this.color_scheme.push("#bd8c00");this.color_scheme.push("#26cfff");this.color_scheme.push("#adffeb");this.color_scheme.push("#b0a597");this.color_scheme.push("#788a00");this.color_scheme.push("#f7baff");this.color_scheme.push("#ff3600");this.color_scheme.push("#e6d395");this.color_scheme.push("#ff850d");this.color_scheme.push("#09ba00");this.color_scheme.push("#ede8df");this.color_scheme.push("#aebfa6");this.color_scheme.push("#420d00");this.color_scheme.push("#ccc800");this.color_scheme.push("#33ff1a");this.color_scheme.push("#dbff36");this.color_scheme.push("#910039");this.color_scheme.push("#00998b");this.color_scheme.push("#ffe600");this.color_scheme.push("#8a6e07");this.color_scheme.push("#dee8fa");this.color_scheme.push("#b391ff");this.color_scheme.push("#3657ff");this.color_scheme.push("#798200");this.color_scheme.push("#ded6db");this.color_scheme.push("#00f723");this.color_scheme.push("#919eff");this.color_scheme.push("#dbffe8");this.color_scheme.push("#d936b8");this.color_scheme.push("#ff96e8");this.color_scheme.push("#402600");this.color_scheme.push("#73aee6");this.color_scheme.push("#b50043");this.color_scheme.push("#0012e6");this.color_scheme.push("#ff5480");this.color_scheme.push("#d5e3da");this.color_scheme.push("#ffb83d");this.color_scheme.push("#bffaff");this.color_scheme.push("#167000");this.color_scheme.push("#ffcc70");this.color_scheme.push("#009440");this.color_scheme.push("#b56e2b");this.color_scheme.push("#a8ffe8");this.color_scheme.push("#ffe86b");this.color_scheme.push("#050402");this.color_scheme.push("#1f2e07");this.color_scheme.push("#ffe6b3");this.color_scheme.push("#ffa3db");this.color_scheme.push("#3b52ff");this.color_scheme.push("#b8baff");this.color_scheme.push("#4e4373");this.color_scheme.push("#fffa4f");this.color_scheme.push("#f26300");this.color_scheme.push("#38b8ff");this.color_scheme.push("#ba544a");this.color_scheme.push("#0a0f0f");this.color_scheme.push("#7d0925");this.color_scheme.push("#adffcf");this.color_scheme.push("#e8cfc9");this.color_scheme.push("#cdd1d1");this.color_scheme.push("#2d00ed");this.color_scheme.push("#592482");this.color_scheme.push("#705a00");this.color_scheme.push("#009180");this.color_scheme.push("#aee67c");this.color_scheme.push("#d4f0ff");this.color_scheme.push("#7dffe8");this.color_scheme.push("#ffd9bd");this.color_scheme.push("#ffd1d9");this.color_scheme.push("#2bffc9");this.color_scheme.push("#8f4a06");this.color_scheme.push("#f0d5bd");this.color_scheme.push("#007a99");this.color_scheme.push("#cf0076");this.color_scheme.push("#853100");this.color_scheme.push("#f082ff");this.color_scheme.push("#d2f0fa");this.color_scheme.push("#ff47e3");this.color_scheme.push("#73ff87");this.color_scheme.push("#594a00");this.color_scheme.push("#fcccff");this.color_scheme.push("#a15f00");this.color_scheme.push("#00687d");this.color_scheme.push("#ff5e17");this.color_scheme.push("#787200");this.color_scheme.push("#bae8ca");this.color_scheme.push("#ff8796");this.color_scheme.push("#99b3ff");this.color_scheme.push("#c4ffdb");this.color_scheme.push("#ffc7a8");this.color_scheme.push("#14c78f");this.color_scheme.push("#464700");this.color_scheme.push("#914000");this.color_scheme.push("#5ec1f7");this.color_scheme.push("#6e00b8");this.color_scheme.push("#f5f5c4");this.color_scheme.push("#f24961");this.color_scheme.push("#52ba00");this.color_scheme.push("#ff943b");this.color_scheme.push("#363605");this.color_scheme.push("#f0e6c0");this.color_scheme.push("#ffb517");this.color_scheme.push("#99c9ff");this.color_scheme.push("#c2b061");this.color_scheme.push("#73cfff");this.color_scheme.push("#fcff52");this.color_scheme.push("#adff69");this.color_scheme.push("#94b3ed");this.color_scheme.push("#a65000");this.color_scheme.push("#918c00");this.color_scheme.push("#d9d9d9");this.color_scheme.push("#00940d");this.color_scheme.push("#00d975");this.color_scheme.push("#270085");this.color_scheme.push("#edc2d1");this.color_scheme.push("#ab6100");this.color_scheme.push("#bd99ff");this.color_scheme.push("#0055fa");this.color_scheme.push("#998cff");this.color_scheme.push("#00872d");this.color_scheme.push("#ba0025");this.color_scheme.push("#00c7c7");this.color_scheme.push("#7affcf");this.color_scheme.push("#14a346");this.color_scheme.push("#defa55");this.color_scheme.push("#ff571f");this.color_scheme.push("#b30098");this.color_scheme.push("#00ad5f");this.color_scheme.push("#167a58");this.color_scheme.push("#5c00e0");this.color_scheme.push("#f296ed");this.color_scheme.push("#0009eb");this.color_scheme.push("#ffa14a");this.color_scheme.push("#02272b");this.color_scheme.push("#f24ba0");this.color_scheme.push("#ff0f00");this.color_scheme.push("#304547");this.color_scheme.push("#c4bbaf");this.color_scheme.push("#115422");this.color_scheme.push("#d4cbba");this.color_scheme.push("#407000");this.color_scheme.push("#910099");this.color_scheme.push("#1c0022");this.color_scheme.push("#475947");this.color_scheme.push("#b3b3a1");this.color_scheme.push("#ffa64f");this.color_scheme.push("#bf508a");this.color_scheme.push("#ffab54");this.color_scheme.push("#00cc5e");this.color_scheme.push("#955300");this.color_scheme.push("#cc29ad");this.color_scheme.push("#d68196");this.color_scheme.push("#5b00bd");this.color_scheme.push("#c5d1be");this.color_scheme.push("#66ff73");this.color_scheme.push("#1c00ff");this.color_scheme.push("#293300");this.color_scheme.push("#ccff26");this.color_scheme.push("#ffc4a3");this.color_scheme.push("#b38100");this.color_scheme.push("#201e87");this.color_scheme.push("#ddedda");this.color_scheme.push("#0048e0");this.color_scheme.push("#0dff87");this.color_scheme.push("#43b08b");this.color_scheme.push("#b0ffcc");this.color_scheme.push("#0073d1");this.color_scheme.push("#5c2800");this.color_scheme.push("#dcf7eb");this.color_scheme.push("#d3f032");this.color_scheme.push("#ffa8ff");this.color_scheme.push("#bde6ff");this.color_scheme.push("#3e402c");this.color_scheme.push("#0c0082");this.color_scheme.push("#e89538");this.color_scheme.push("#630046");this.color_scheme.push("#ffeb45");this.color_scheme.push("#80bdff");this.color_scheme.push("#ff3d66");this.color_scheme.push("#a8adad");this.color_scheme.push("#f54c00");this.color_scheme.push("#e6ffab");this.color_scheme.push("#5a8a96");this.color_scheme.push("#ff0d00");this.color_scheme.push("#6eff00");this.color_scheme.push("#dee3c8");this.color_scheme.push("#7d0c00");this.color_scheme.push("#f0e6ed");this.color_scheme.push("#7570ff");this.color_scheme.push("#a6e8ff");this.color_scheme.push("#f70099");this.color_scheme.push("#00294d");this.color_scheme.push("#ffd6eb");this.color_scheme.push("#deff47");this.color_scheme.push("#3a728a");this.color_scheme.push("#c5e8e8");this.color_scheme.push("#270020");this.color_scheme.push("#e66eff");this.color_scheme.push("#5a7d57");this.color_scheme.push("#46eb91");this.color_scheme.push("#e3e112");this.color_scheme.push("#909e5a");this.color_scheme.push("#00449e");this.color_scheme.push("#ad4200");this.color_scheme.push("#ffb875");this.color_scheme.push("#960090");this.color_scheme.push("#660700");this.color_scheme.push("#3e40b3");this.color_scheme.push("#b50900");this.color_scheme.push("#ff3d9e");this.color_scheme.push("#d15600");this.color_scheme.push("#ed8500");this.color_scheme.push("#ffd6e8");this.color_scheme.push("#853241");this.color_scheme.push("#cce300");this.color_scheme.push("#ff38ab");this.color_scheme.push("#4d00fa");this.color_scheme.push("#810091");this.color_scheme.push("#2800e0");this.color_scheme.push("#ffcf96");this.color_scheme.push("#ffffb5");this.color_scheme.push("#ff8c99");this.color_scheme.push("#44009d");this.color_scheme.push("#ff29e8");this.color_scheme.push("#3d0066");this.color_scheme.push("#52fadc");this.color_scheme.push("#c2ffd6");this.color_scheme.push("#910dff");this.color_scheme.push("#0041c4");this.color_scheme.push("#b600fa");this.color_scheme.push("#8f3900");this.color_scheme.push("#a3d400");this.color_scheme.push("#f2aaf2");this.color_scheme.push("#ffb547");function wConnectable(C,A,B){if(B==undefined||B==null){this.id=C;this.type=null;this.value=null;this.name=A}else{this.id=B.id;this.type=B.type;this.value=B.value;this.name=B.name}}wConnectable.prototype.getId=function(){return this.id};wConnectable.prototype.setId=function(A){this.id=A};wConnectable.prototype.getType=function(){return this.type};wConnectable.prototype.setType=function(A){this.type=A};wConnectable.prototype.getValue=function(){return this.value};wConnectable.prototype.setValue=function(A){this.value=A};wConnectable.prototype.getName=function(){return this.name};wConnectable.prototype.clear=function(){null};wConnectable.prototype.refresh=function(){null};wConnectable.prototype.connections=function(){null};wConnectable.prototype.getURI=function(){var A={iGadgetId:this.id,varName:this.name};return URIs.GET_POST_GADGET_VARIABLE.evaluate(A)};function wOut(C,A,B){wConnectable.call(this,C,A,B);this.inputHash=[]}wOut.prototype=new wConnectable();wOut.prototype.addInput=function(A){if(A instanceof wInOut){if(!(this.inputHash[A.getName()] instanceof wConnectable)){this.inputHash[A.getName()]=A;return 0}return 1}return -1};wOut.prototype.removeInput=function(A){if(A instanceof wInOut){if(this.inputHash[A.getName()] instanceof wConnectable){this.inputHash[A.getName()]=null;return 0}return 1}return -1};wOut.prototype.setValue=function(B){this.value=B;var C=WiringFactory.getInstance();var A=new Object();A.iGadget=this.id;A.name=this.name;A.value=B;C.markVariableAsModified(A);return""};wOut.prototype.clear=function(){for(i in this.inputHash){if(this.inputHash[i] instanceof wInOut){this.inputHash[i].removeOutput(this)}}};wOut.prototype.connections=function(){var A=[];for(i in this.inputHash){if(this.inputHash[i] instanceof wInOut){A.push(this.inputHash[i].getName())}}return A};wOut.prototype.refresh=function(A){this.inputHash[A.getName()]=A};wOut.prototype.eraseConnections=function(){this.inputHash=[]};function wIn(C,A,B){wConnectable.call(this,C,A,B);this.outputHash=[]}wIn.prototype=new wConnectable();wIn.prototype.addOutput=function(A){if(A instanceof wInOut){if(!(this.outputHash[A.getName()] instanceof wInOut)){if(this.type==A.getType()){this.outputHash[A.getName()]=A;return 0}else{if(A.getType()==null){this.outputHash[A.getName()]=A;return 0}else{if(this.type==null){this.type=A.getType();this.outputHash[A.getName()]=A;return 0}else{return -2}}}}return 1}return -1};wIn.prototype.removeOutput=function(A){if(A instanceof wInOut){if(this.outputHash[A.getName()] instanceof wInOut){this.outputHash[A.getName()]=null;return 0}return 1}return -1};wIn.prototype.setValue=function(C){this.value=C;var B="";var A='{"value":"'+this.value+'","channels":[';for(i in this.outputHash){if(this.outputHash[i] instanceof wInOut){B=this.outputHash[i].setValue(C)+B;if(this.outputHash[i]==null){this.outputHash[i].setTypeForward(this.type)}}}if(B!=""){A+=B.slice(1)}else{A+=B}return A+"]}"};wIn.prototype.clear=function(){for(i in this.outputHash){if(this.outputHash[i] instanceof wInOut){this.outputHash[i].removeInput(this)}}};wIn.prototype.refresh=function(A){this.outputHash[A.getName()]=A;A.setValue(this.value)};wIn.prototype.connections=function(){var A=[];for(i in this.outputHash){if(this.outputHash[i] instanceof wInOut){A.push(this.outputHash[i].getName())}}return A};wIn.prototype.eraseConnections=function(){this.outputHash=[]};function wInOut(C,A,B){wConnectable.call(this,C,A,B);this.inputList=[];this.outputList=[];this.inputCounter=0;this.outputCounter=0}wInOut.prototype=new wConnectable();wInOut.prototype.setTypeForward=function(B){this.type=B;for(var A=0;A<this.outputCounter;A++){if(this.outputList[A] instanceof wInOut){this.outputList[A].setTypeForward(B)}}};wInOut.prototype.setTypeBack=function(B){this.type=B;for(var A=0;A<this.inputCounter;A++){if(this.inputList[A] instanceof wInOut){this.inputList[A].setTypeBack(B)}}};wInOut.prototype.searchCycle=function(A){if(this.name==A){return true}else{var C=false;var B=0;while(B<this.outputCounter&&!C){if(this.outputList[B] instanceof wInOut){C=C||this.outputList[B].searchCycle(A)}B++}return C}};wInOut.prototype.addOutput=function(A){if(!(A instanceof wIn)){if(A instanceof wOut||!A.searchCycle(this.name)){var B=0;var C=0;while(B<this.outputCounter&&C==0){if(this.outputList[B].getId()==A.getId()&&this.outputList[B].getName()==A.getName()){C=1}B++}if(C!=1){if(this.type==A.getType()){this.outputList[this.outputCounter++]=A;return 0}else{if(A.getType()==null){A.setValue(this.value);this.outputList[this.outputCounter++]=A;return 0}else{if(this.type==null){this.outputList[this.outputCounter++]=A;return 0}else{return -2}}}}else{return 1}}else{return 2}}else{return -1}};wInOut.prototype.removeOutput=function(B){if(!(B instanceof wIn)){var C=0;var D=false;var A=0;while(C<this.outputCounter&&!D){if(this.outputList[C].getId()==B.getId()&&this.outputList[C].getName()==B.getName()){D=true;A=C}C++}if(D){this.outputList.splice(A,1);this.outputCounter--;if(this.outputCounter==0&&this.inputCounter==0){this.type=null;this.value=null}return 0}else{return 1}}else{return -1}};wInOut.prototype.addInput=function(A){if(!(A instanceof wOut)){if(A instanceof wIn||!this.searchCycle(A.getName())){var B=0;var C=0;while(B<this.inputCounter&&C==0){if(this.inputList[B].getId()==A.getId()&&this.inputList[B].getName()==A.getName()){C=1}B++}if(C!=1){this.inputList[this.inputCounter++]=A;return 0}else{return 1}}else{return 2}}else{return -1}};wInOut.prototype.removeInput=function(B){if(!(B instanceof wOut)){var C=0;var D=false;var A=0;while(C<this.inputCounter&&!D){if(this.inputList[C].getId()==B.getId()&&this.inputList[C].getName()==B.getName()){D=true;A=C}C++}if(D){this.inputList.splice(A,1);this.inputCounter--;if(this.outputCounter==0&&this.inputCounter==0){this.type=null;this.value=null}return 0}else{return 1}}else{return -1}};wInOut.prototype.setValue=function(C){var B="";for(var A=0;A<this.outputCounter;A++){if(this.outputList[A] instanceof wConnectable){B=this.outputList[A].setValue(C)+B;if(this.outputList[A]==null&&this.outputList[A] instanceof wInOut){this.outputList[A].setTypeForward(this.type)}}}if(this.value!=C){this.value=C;B+=',{"name":"'+this.name+'"}'}return B};wInOut.prototype.clear=function(){for(var A=0;A<this.inputCounter;A++){if(this.inputList[A] instanceof wConnectable){this.inputList[A].removeOutput(this)}}for(var A=0;A<this.outputCounter;A++){if(this.outputList[A] instanceof wConnectable){this.outputList[A].removeInput(this)}}};wInOut.prototype.connections=function(){var B=new Object();B.input=[];B.output=[];for(var D=0;D<this.inputCounter;D++){if(this.inputList[D] instanceof wConnectable){var C=new Object();C.id=this.inputList[D].getId();C.name=this.inputList[D].getName();if(C.id!=null&&C.id!="null"){var A=DragboardFactory.getInstance().getGadget(C.id);C.gadgetName=A.getName()}else{C.gadgetName=""}B.input.push(C)}}for(var D=0;D<this.outputCounter;D++){if(this.outputList[D] instanceof wConnectable){var C=new Object();C.id=this.outputList[D].getId();C.name=this.outputList[D].getName();if(C.id!=null&&C.id!="null"){var A=DragboardFactory.getInstance().getGadget(C.id);C.gadgetName=A.getName()}else{C.gadgetName=""}B.output.push(C)}}return B};wInOut.prototype.duplicate=function(){var B=new Object();B.InOut=new wInOut(this.getId(),this.getName());B.InOut.setType(this.type);B.InOut.setValue(this.value);B.input=[];B.output=[];for(var A=0;A<this.inputCounter;A++){if(this.inputList[A] instanceof wIn){B.InOut.addInput(this.inputList[A])}else{B.input.push(this.inputList[A].getName())}}for(var A=0;A<this.outputCounter;A++){if(this.outputList[A] instanceof wOut){B.InOut.addOutput(this.outputList[A])}else{B.output.push(this.outputList[A].getName())}}return B};wInOut.prototype.refresh=function(C){for(var B=0;B<this.inputCounter;B++){if(this.inputList[B] instanceof wIn){this.inputList[B].refresh(C)}}for(var A=0;A<this.outputCounter;A++){if(this.outputList[A] instanceof wOut){this.outputList[A].refresh(C)}}};wInOut.prototype.delConnections=function(){for(var B=0;B<this.inputCounter;B++){this.inputList[B].removeOutput(this)}for(var A=0;A<this.outputCounter;A++){this.outputList[A].removeInput(this)}};wInOut.prototype.propagate=function(){for(var A=0;A<this.outputCounter;A++){if(this.outputList[A] instanceof wOut){this.outputList[A].setValue(this.value)}}};wInOut.prototype.getURI=function(){var A={channelName:this.name};return URIs.GET_POST_CHANNEL.evaluate(A)};wInOut.prototype.getPersistence=function(){var C=new Object();C.name=this.name;C.value=this.value;C.friendcode=this.type;C.uri=this.getURI();C.ins=[];C.outs=[];for(var B=0;B<this.inputCounter;B++){var A=new Object();A.variable=this.inputList[B].getURI();C.ins.push(A)}for(var B=0;B<this.outputCounter;B++){var A=new Object();A.variable=this.outputList[B].getURI();C.outs.push(A)}return C};function wEvent(C,A,B){wIn.call(this,C,A,B)}wEvent.prototype=new wIn();function wChannel(C,A,B){wInOut.call(this,C,A,B)}wChannel.prototype=new wInOut();function wSlot(C,A,B){wOut.call(this,C,A,B)}wSlot.prototype=new wOut();var WiringInterfaceFactory=function(){var A=null;function B(){this.wiring=WiringFactory.getInstance();this.opmanager=OpManagerFactory.getInstance();this.friend_codes={};this.highlight_color="#FFFFE0";this.friend_codes_counter=0;this.channels_counter=1;this.last_checked=null;this.disabled_all=true;this.modified=false;this.color_scheme=[];this.color_scheme.push("#ffb0a1");this.color_scheme.push("#a6ffbf");this.color_scheme.push("#7a5e85");this.color_scheme.push("#b3f0ff");this.color_scheme.push("#cf36ff");this.color_scheme.push("#5496ff");this.color_scheme.push("#e854ff");this.color_scheme.push("#662500");this.color_scheme.push("#5a9e68");this.color_scheme.push("#bf6900");this.color_scheme.push("#a17800");this.color_scheme.push("#72cc85");this.color_scheme.push("#e6ff42");this.color_scheme.push("#becfbc");this.color_scheme.push("#005710");this.color_scheme.push("#00193f");this.color_scheme.push("#e0fffa");this.color_scheme.push("#f0ff3d");this.color_scheme.push("#f0d8d3");this.color_scheme.push("#ab5c00");this.color_scheme.push("#3c008f");this.color_scheme.push("#d6ff8a");this.color_scheme.push("#fac0e1");this.color_scheme.push("#4700ad");this.color_scheme.push("#ccc6ad");this.color_scheme.push("#261e06");this.color_scheme.push("#4fedff");this.color_scheme.push("#e6bebc");this.color_scheme.push("#f0ed73");this.color_scheme.push("#4f1800");this.color_scheme.push("#020073");this.color_scheme.push("#0fff00");this.color_scheme.push("#686b00");this.color_scheme.push("#804dff");this.color_scheme.push("#b100bd");this.color_scheme.push("#69ffab");this.color_scheme.push("#e6acb8");this.color_scheme.push("#8c7a77");this.color_scheme.push("#006bfa");this.color_scheme.push("#8cffab");this.color_scheme.push("#d1d190");this.color_scheme.push("#0d4000");this.color_scheme.push("#f0e8c4");this.color_scheme.push("#0048e8");this.color_scheme.push("#b8ffe0");this.color_scheme.push("#5effe0");this.color_scheme.push("#770000");this.color_scheme.push("#913dff");this.color_scheme.push("#5357cf");this.color_scheme.push("#b3ab00");this.color_scheme.push("#b3ffeb");this.color_scheme.push("#ffb08f");this.color_scheme.push("#ffbff5");this.color_scheme.push("#40ffed");this.color_scheme.push("#e6dfcf");this.color_scheme.push("#f0f2ff");this.color_scheme.push("#d1ffeb");this.color_scheme.push("#91ffe6");this.color_scheme.push("#2800b0");this.color_scheme.push("#c4ffde");this.color_scheme.push("#a82fe0");this.color_scheme.push("#ff5200");this.color_scheme.push("#ed9eff");this.color_scheme.push("#5c97e6");this.color_scheme.push("#ff0dba");this.color_scheme.push("#1c778c");this.color_scheme.push("#0058a1");this.color_scheme.push("#f7cbb2");this.color_scheme.push("#8f2e00");this.color_scheme.push("#631cff");this.color_scheme.push("#a5cf00");this.color_scheme.push("#997354");this.color_scheme.push("#ff73eb");this.color_scheme.push("#c41200");this.color_scheme.push("#3b00ed");this.color_scheme.push("#13f2ce");this.color_scheme.push("#ff8ac7");this.color_scheme.push("#ffbae0");this.color_scheme.push("#91ffba");B.prototype.unloaded=function(){this.disabled_all=true;$("events_list").innerHTML="";$("slots_list").innerHTML="";$("channels_list").innerHTML="";$("channel_name").value="Wire_"+this.channels_counter};B.prototype.saveWiring=function(){if(this.modified==true){this.opmanager.restaure();this.wiring.serialize();this.modified=false}};B.prototype.addChannelInterface=function(C){var G="channel_"+C;var K=document.createElement("li");var J=document.createElement("input");J.setAttribute("type","image");J.setAttribute("onclick","javascript:wiringInterface.deleteChannel('"+C+"');");J.setAttribute("src","/ezweb/images/dialog-cancel.png");K.appendChild(J);var I=document.createElement("input");I.setAttribute("type","radio");I.setAttribute("name","channels_options");I.setAttribute("id","chk_"+G);I.setAttribute("onclick","javascript:{wiringInterface._highlight_channel('chk_"+G+"', '"+C+"');}");var D=document.createTextNode(C);I.appendChild(D);K.appendChild(I);var E=document.createElement("label");E.setAttribute("for","chk_"+G);E.setAttribute("style","cursor: pointer; cursor: hand;");E.appendChild(D);K.appendChild(E);K.setAttribute("id",G);var L=document.createElement("ul");var H=document.createTextNode(this.wiring.viewValue(C));var F=document.createElement("li");F.appendChild(H);L.appendChild(F);K.appendChild(L);$("channels_list").appendChild(K);this._highlight_channel("chk_"+G,C)};B.prototype.addGadgetInterface=function(G){var J=document.createElement("ul");J.setAttribute("id","events_ul_gadget_"+G.id);var N=document.createElement("ul");N.setAttribute("id","slots_ul_gadget_"+G.id);var O=this.wiring.gadgetConnections(G.id);if(O){for(var I=0;I<O.length;I++){var F=document.createElement("li");var H=document.createElement("div");var K=document.createElement("input");var L="gadget_"+G.id+"_"+O[I].name;H.setAttribute("id","div_"+L);K.setAttribute("id","chk_"+L);K.setAttribute("disabled","disabled");K.setAttribute("type","checkbox");K.setAttribute("onClick","javascript:{wiringInterface.changeConnectionStatus(this, "+G.id+", '"+O[I].name+"', '"+O[I].aspect+"')}");H.appendChild(K);var E=document.createElement("label");E.setAttribute("for","chk_"+L);E.setAttribute("id","lbl_chk_"+L);var C=document.createTextNode(O[I].name);if((O[I].friend_code!="undefined")||(O[I].friend_code!=undefined)){if(!this.friend_codes[O[I].friend_code]){this.friend_codes[O[I].friend_code]={};this.friend_codes[O[I].friend_code].list=[];this.friend_codes[O[I].friend_code].color=this.color_scheme[this.friend_codes_counter++]}this.friend_codes[O[I].friend_code].list.push(L);F.setAttribute("onclick","javascript:{wiringInterface._changeChannel('"+L+"', '"+G.id+"', '"+O[I].name+"', '"+O[I].aspect+"', '"+O[I].friend_code+"');}");F.setAttribute("onmouseover","javascript:wiringInterface._highlight_friend_code('"+O[I].friend_code+"', true);");F.setAttribute("onmouseout","javascript:wiringInterface._highlight_friend_code('"+O[I].friend_code+"', false);")}E.appendChild(C);H.appendChild(E);F.appendChild(H);F.setAttribute("id",L);if(O[I].aspect=="EVEN"){J.appendChild(F)}else{if(O[I].aspect=="SLOT"){N.appendChild(F)}}}}var M=document.createElement("li");M.id="events_list_gadget_"+G.id;var D=document.createTextNode(G.name+" ["+G.id+"]");M.setAttribute("onclick","javascript:{wiringInterface._toggle('EVEN', '"+G.id+"');}");M.appendChild(D);if(J.childNodes.length>0){M.appendChild(J);$("events_list").appendChild(M)}var M=document.createElement("li");M.setAttribute("onclick","javascript:{wiringInterface._toggle('SLOT', '"+G.id+"');}");var D=document.createTextNode(G.name+" ["+G.id+"]");M.id="slots_list_gadget_"+G.id;M.appendChild(D);if(N.childNodes.length>0){M.appendChild(N);$("slots_list").appendChild(M)}};B.prototype.addChannelsAsGadgetInterface=function(C){for(channel in C){alert(channel)}};B.prototype.renewInterface=function(){this.unloaded();this.wiring.edition();var D=this.wiring.getGadgetsId();var C=this.wiring.getInOutsId();for(var F=0;F<D.length;F++){this.addGadgetInterface(D[F])}for(var E=0;E<C.length;E++){this.addChannelInterface(C[E])}this.channels_counter=C.length+1;$("channel_name").value="Wire_"+this.channels_counter;while(C.include($("channel_name").value)){this.channels_counter++;$("channel_name").value="Wire_"+this.channels_counter}};B.prototype.addChannel=function(){var C=null;var D=$("channel_name").value;while(this.wiring.getInOutsId().include($("channel_name").value)){this.channels_counter++;$("channel_name").value="Wire_"+this.channels_counter}D=D.strip();if(!D.empty()){if(!(C=this.wiring.createChannel(D))){this.addChannelInterface(D);this.channels_counter++;$("channel_name").value="Wire_"+this.channels_counter;this.modified=true}}};B.prototype.changeConnectionStatus=function(E,F,D,G){var C=this.last_checked;if(E.checked==true){this.addConnection(C,F,D,G)}this.deleteConnection(C,F,D,G)};B.prototype.addConnection=function(C,E,D,F){this.modified=true;if(F=="EVEN"){this.wiring.addChannelInput(E,D,C);return }if(F=="SLOT"){this.wiring.addChannelOutput(E,D,C);return }};B.prototype.deleteConnection=function(C,E,D,F){this.modified=true;if(F=="EVEN"){this.wiring.removeChannelInput(E,D,C);return }if(F=="SLOT"){this.wiring.removeChannelOutput(E,D,C);return }};B.prototype.deleteChannel=function(E){var C=null;if(!(C=this.wiring.removeChannel(E))){var D="channel_"+E;$(D).remove();this._enable_all(false);this.channels_counter--}this.modified=true};B.prototype._changeChannel=function(E,F,G,D,C){channel_name=this.last_checked;chk_id="chk_"+E;if($(chk_id).getAttribute("disabled")!="disabled"){if($(chk_id).checked){$("div_"+E).style.backgroundColor=this.highlight_color;$("lbl_"+chk_id).style.fontWeight="bold";if(D=="EVEN"){this.wiring.addChannelInput(F,G,channel_name)}else{this.wiring.addChannelOutput(F,G,channel_name)}}else{$("div_"+E).style.backgroundColor="";$("lbl_"+chk_id).style.fontWeight="normal";if(D=="EVEN"){this.wiring.removeChannelInput(F,G,channel_name)}else{this.wiring.removeChannelOutput(F,G,channel_name)}}}};B.prototype._toggle=function(C,D){if(C=="EVEN"){list=$("events_list_gadget_"+D)}else{list=$("slots_list_gadget_"+D)}if(list.className=="off"){list.className="on"}else{list.className="off"}};B.prototype._highlight=function(E,C){if(this.friend_codes[C]){var F=this.friend_codes[C].list;var D=this.friend_codes[C].color;if($(E).checked){for(var G=0;G<F.length;G++){$(F[G]).style.backgroundColor=D}}else{var H=true;for(var G=0;G<F.length;G++){H&=!$("chk_"+F[G]).checked}if(H){for(var G=0;G<F.length;G++){$(F[G]).style.backgroundColor=null}}}}};B.prototype._highlight_friend_code=function(C,E){if(this.friend_codes[C]){var F=this.friend_codes[C].list;var D=this.friend_codes[C].color;var H="";for(var G=0;G<F.length;G++){if(E&&$(F[G])){$(F[G]).style.backgroundColor=D;$(F[G]).parentNode.parentNode.className="on"}else{$(F[G]).style.backgroundColor=H;$(F[G]).parentNode.parentNode.className="on"}}}};B.prototype._highlight_channel=function(C,E){this._enable_all();if(this.last_checked&&$("channel_"+this.last_checked)){$("channel_"+this.last_checked).style.backgroundColor="";channels=this.wiring.connections(this.last_checked);if(channels){channel_list=channels.input.concat(channels.output);for(var D=0;D<channel_list.length;D++){var F="chk_gadget_"+channel_list[D].id+"_"+channel_list[D].name;$(F).checked=false;$("div_gadget_"+channel_list[D].id+"_"+channel_list[D].name).style.backgroundColor="";$("lbl_"+F).style.fontWeight="normal"}}}$("channel_"+E).style.backgroundColor=this.highlight_color;channels=this.wiring.connections(E);if(channels){channel_list=channels.input.concat(channels.output);for(var D=0;D<channel_list.length;D++){var F="chk_gadget_"+channel_list[D].id+"_"+channel_list[D].name;$(F).checked=true;$("div_gadget_"+channel_list[D].id+"_"+channel_list[D].name).style.backgroundColor=this.highlight_color;$("lbl_"+F).style.fontWeight="bold"}}this.last_checked=E};B.prototype._enable_all=function(E){var C=this.wiring.getGadgetsId();for(var G=0;G<C.length;G++){var F=this.wiring.gadgetConnections(C[G].id);for(var D=0;D<F.length;D++){var H="gadget_"+C[G].id+"_"+F[D].name;if((E==null)||(E)){$("chk_"+H).removeAttribute("disabled")}else{$("chk_"+H).setAttribute("disabled","disabled")}$(H).style.backgroundColor="";$("div_"+H).style.backgroundColor="";$("chk_"+H).checked=false;$("lbl_chk_"+H).style.fontWeight="normal"}}if(this.last_checked&&$("channel_"+this.last_checked)){$("channel_"+this.last_checked).style.backgroundColor=""}this.disabled_all=false};B.prototype.currentTab=function(C){var D={tab:C}}}return new function(){this.getInstance=function(){if(A==null){A=new B()}return A}}}();var WiringFactory=function(){var instance=null;function Wiring(){loadWiring=function(transport){var response=transport.responseText;var tempList=eval("("+response+")");var gadgets=tempList.iGadgetList;var inOuts=tempList.inOutList;var connections=[];var list=null;for(var i=0;i<gadgets.length;i++){this.addInstance(gadgets[i])}for(var i=0;i<inOuts.length;i++){var inputs=new Object();this.createChannel(inOuts[i]);inputs.from=inOuts[i].name;inputs.inputHash=inOuts[i].ins;inputs.outputHash=inOuts[i].outs;connections.push(inputs)}for(var r=0;r<connections.length;r++){var item=connections[r];for(var i=0;i<item.inputHash.length;i++){var input=item.inputHash[i];if(input.igadget=="null"){this.addChannelInput(input.name,item.from)}else{this.addChannelInput(input.igadget,input.name,item.from)}}for(var j=0;j<item.outputHash.length;j++){var output=item.outputHash[j];if(output.igadget=="null"){this.addChannelOutput(output.name,item.from)}else{this.addChannelOutput(output.igadget,output.name,item.from)}}}loaded=true;OpManagerFactory.getInstance().continueLoading(Modules.prototype.WIRING)};onError=function(transport){alert("error wiring GET")};var loaded=false;var persistenceEngine=PersistenceEngineFactory.getInstance();var iGadgetList=new Hash();var inOutList=new Hash();var copyList=new Hash();var modifiedVars=[];persistenceEngine.send_get(URIs.GET_POST_WIRING,this,loadWiring,onError);Wiring.prototype.getGadgetsId=function(){var gadgetsId=iGadgetList.keys();var result=[];for(var i=0;i<gadgetsId.length;i++){var iGadget=new Object();iGadget.name=iGadgetList[gadgetsId[i]].name;iGadget.id=gadgetsId[i];result.push(iGadget)}return result};Wiring.prototype.getInOutsId=function(){return copyList.keys()};Wiring.prototype.connections=function(channel){var channel=copyList[channel].ref;var connections=channel.connections();return connections};Wiring.prototype.gadgetConnections=function(gadgetId){var list=[];if(iGadgetList[gadgetId]!=undefined){for(var i=0;i<iGadgetList[gadgetId].list.length;i++){var item=new Object();item.name=iGadgetList[gadgetId].list[i].name;item.aspect=iGadgetList[gadgetId].list[i].aspect;item.friend_code=iGadgetList[gadgetId].list[i].friend_code;list.push(item)}return list}else{return null}};Wiring.prototype.addInstance=function(iGadgetId,template){var gadget=new Object();if(arguments.length==2){if(iGadgetList[iGadgetId]==undefined){var events=template.getEvents();var slots=template.getSlots();var itemList=[];gadget.id=iGadgetId;var gadgetModel=DragboardFactory.getInstance().getGadget(iGadgetId);gadget.vendor=gadgetModel.getVendor();gadget.version=gadgetModel.getVersion();gadget.name=gadgetModel.getName();for(var i=0;i<events.length;i++){var item=new Object();item.name=events[i].name;item.aspect=events[i].aspect;item.friend_code=events[i].friend_code;item.ref=new wEvent(iGadgetId,item.name);itemList.push(item)}for(var j=0;j<slots.length;j++){var item=new Object();item.name=slots[j].name;item.aspect=slots[j].aspect;item.friend_code=slots[j].friend_code;item.ref=new wSlot(iGadgetId,item.name);itemList.push(item)}gadget.list=itemList;iGadgetList[iGadgetId]=gadget;return 0}else{alert("Gadget instance exists");return -1}}else{if(arguments.length==1){var gadget=new Object();gadget.list=[];gadget.id=arguments[0]["id"];var gadgetModel=DragboardFactory.getInstance().getGadget(arguments[0]["id"]);gadget.vendor=gadgetModel.getVendor();gadget.version=gadgetModel.getVersion();gadget.name=gadgetModel.getName();list=arguments[0].list;for(var j=0;j<list.length;j++){var connectable=new Object();connectable.name=list[j].name;connectable.aspect=list[j].aspect;connectable.friend_code=list[j].friend_code;switch(connectable.aspect){case"EVEN":connectable.ref=new wEvent(null,null,list[j]);break;case"SLOT":connectable.ref=new wSlot(null,null,list[j]);break}gadget.list.push(connectable)}iGadgetList[gadget.id]=gadget}}};Wiring.prototype.removeInstance=function(iGadgetId){var instance=iGadgetList[iGadgetId];if(instance!=undefined){var list=instance.list;for(var i=0;i<list.length;i++){list[i].ref.clear()}iGadgetList.remove(iGadgetId);return 0}else{alert("the instance doesn't exist");return 1}};Wiring.prototype.createChannel=function(newChannel){var channel=new Object();if(!(newChannel instanceof Object)){if(copyList[newChannel]==undefined){channel.name=newChannel;channel.ref=new wInOut(null,newChannel);copyList[newChannel]=channel;return 0}else{return -1}}else{channel.name=newChannel.name;channel.ref=new wInOut(null,null,newChannel);inOutList[newChannel.name]=channel;return 0}};Wiring.prototype.removeChannel=function(channelName){var channel=copyList[channelName];if(channel!=undefined){channel.ref.clear();copyList.remove(channelName);return 0}else{return 1}};Wiring.prototype.viewValue=function(channelName){var channel=inOutList[channelName];if(channel!=undefined){return channel.ref.getValue()}return undefined};Wiring.prototype.sendEvent=function(iGadgetId,event,value){var gadget=iGadgetList[iGadgetId];var channelList;modifiedVars=[];if(gadget!=undefined){var list=gadget.list;for(var i=0;i<list.length;i++){if((list[i].name==event)&&(list[i].aspect=="EVEN")){list=list[i].ref;break}}channelList=list.setValue(value);return modifiedVars}else{alert("gadget doesn't exist");return -1}};Wiring.prototype.markVariableAsModified=function(varInfo){var modVar;var found=false;for(j=0;j<modifiedVars.length;j++){modVar=modifiedVars[j];if(modVar.iGadget==varInfo.iGadget&&modVar.name==varInfo.name){modVar.value=varInfo.value;found=true;break}}if(found==false){modifiedVars.push(varInfo)}};Wiring.prototype.addChannelInput=function(){if(arguments.length==3){if(loaded){var channel=copyList[arguments[2]]}else{var channel=inOutList[arguments[2]]}var gadget=iGadgetList[arguments[0]];if((channel!=undefined)&&(gadget!=undefined)){var list=gadget.list;for(var i=0;i<list.length;i++){if((list[i].name==arguments[1])&&(list[i].aspect=="EVEN")){list=list[i].ref;break}}if(!loaded){list.addOutput(channel.ref)}channel.ref.addInput(list);return 1}}else{if(arguments.length==2){if(loaded){var channel=copyList[arguments[1]];var input=copyList[arguments[0]]}else{var channel=inOutList[arguments[1]];var input=inOutList[arguments[0]]}if((channel!=undefined)&&(input!=undefined)){input=input.ref;channel=channel.ref;input.addOutput(channel);channel.addInput(input);return 1}}}};Wiring.prototype.addChannelOutput=function(){if(arguments.length==3){if(loaded){var channel=copyList[arguments[2]]}else{var channel=inOutList[arguments[2]]}var gadget=iGadgetList[arguments[0]];if((channel!=undefined)&&(gadget!=undefined)){var list=gadget.list;for(var i=0;i<list.length;i++){if((list[i].name==arguments[1])&&(list[i].aspect=="SLOT")){list=list[i].ref;break}}if(!loaded){list.addInput(channel.ref)}channel.ref.addOutput(list);return 1}}if(arguments.length==2){if(loaded){var channel=copyList[arguments[1]];var output=copyList[arguments[0]]}else{var channel=inOutList[arguments[1]];var output=inOutList[arguments[0]]}if((channel!=undefined)&&(output!=undefined)){output.ref.addInput(channel.ref);channel.ref.addOutput(output.ref);return 1}}};Wiring.prototype.removeChannelInput=function(){if(arguments.length==3){if(loaded){var channel=copyList[arguments[2]]}else{var channel=inOutList[arguments[2]]}var gadget=iGadgetList[arguments[0]];if((channel!=undefined)&&(gadget!=undefined)){var list=gadget.list;for(var i=0;i<list.length;i++){if((list[i].name==arguments[1])&&(list[i].aspect=="EVEN")){list=list[i].ref;break}}channel.ref.removeInput(list);return 1}}if(arguments.length==2){if(loaded){var channel=copyList[arguments[1]];var input=copyList[arguments[0]]}else{var channel=inOutList[arguments[1]];var input=inOutList[arguments[0]]}if((channel!=undefined)&&(input!=undefined)){input.ref.removeOutput(channel.ref);channel.ref.removeInput(input.ref);return 1}}};Wiring.prototype.removeChannelOutput=function(){if(arguments.length==3){if(loaded){var channel=copyList[arguments[2]]}else{var channel=inOutList[arguments[2]]}var gadget=iGadgetList[arguments[0]];if((channel!=undefined)&&(gadget!=undefined)){var list=gadget.list;for(var i=0;i<list.length;i++){if((list[i].name==arguments[1])&&(list[i].aspect=="SLOT")){list=list[i].ref;break}}channel.ref.removeOutput(list);return 1}}if(arguments.length==2){if(loaded){var channel=copyList[arguments[1]];var output=copyList[arguments[0]]}else{var channel=inOutList[arguments[1]];var output=inOutList[arguments[0]]}if((channel!=undefined)&&(output!=undefined)){output.ref.removeInput(channel.ref);channel.ref.removeOutput(output.ref);return 1}}};Wiring.prototype.edition=function(){copyList=new Hash();var keys=inOutList.keys();var channelConnections=new Hash();for(var i=0;i<keys.length;i++){var element=inOutList[keys[i]].ref;var newElement=element.duplicate();var item=new Object();item.name=keys[i];item.ref=newElement.InOut;copyList[keys[i]]=item;var channel=new Object();channel.inputs=newElement.input;channel.outputs=newElement.output;channelConnections[keys[i]]=channel}for(var i=0;i<keys.length;i++){var newInput=channelConnections[keys[i]];var iteration=newInput.inputs;for(var j=0;j<iteration.length;j++){this.addChannelInput(iteration[j],keys[i])}iteration=newInput.outputs;for(var z=0;z<iteration.length;z++){this.addChannelOutput(iteration[z],keys[i])}}};Wiring.prototype.restaure=function(){var keys=inOutList.keys();var copyKeys=copyList.keys();var iGadgets=iGadgetList.keys();for(var t=0;t<iGadgets.length;t++){var list=iGadgetList[iGadgets[t]].list;for(var z=0;z<list.length;z++){list[z].ref.eraseConnections()}}for(var i=0;i<copyKeys.length;i++){var channel=copyList[copyKeys[i]];if(keys.indexOf(copyKeys[i])!=-1){channel.ref.value=inOutList[copyKeys[i]].ref.getValue()}channel.ref.refresh(channel.ref);keys=keys.without(copyKeys[i])}for(var j=0;j<keys.length;j++){var deletedChannel=inOutList[keys[j]].ref;deletedChannel.delConnections()}inOutList=copyList};Wiring.prototype.serializationSuccess=function(response){};Wiring.prototype.serializationError=function(response){var p=response.responseText;alert("ERROR: Channel and its connections cannot be saved")};Wiring.prototype.serialize=function(){var gadgets=[],inouts=[];var gadgetKeys=iGadgetList.keys();var inOutKeys=copyList.keys();for(var i=0;i<gadgetKeys.length;i++){var list=[];for(var j=0;j<iGadgetList[gadgetKeys[i]].list.length;j++){var connectablejson=new Object();connectablejson.name=iGadgetList[gadgetKeys[i]].list[j].name;connectablejson.uri=iGadgetList[gadgetKeys[i]].list[j].ref.getURI();connectablejson.value=iGadgetList[gadgetKeys[i]].list[j].ref.getValue();connectablejson.aspect=iGadgetList[gadgetKeys[i]].list[j].aspect;connectablejson.type=iGadgetList[gadgetKeys[i]].list[j].ref.getType();connectablejson.igadget=iGadgetList[gadgetKeys[i]].list[j].ref.getId();list.push(connectablejson)}var iGadget=new Object();var iGadgetId={iGadgetId:iGadgetList[gadgetKeys[i]].id};iGadget.uri=URIs.POST_IGADGET.evaluate(iGadgetId);iGadget.id=iGadgetList[gadgetKeys[i]].id;iGadget.list=list;gadgets.push(iGadget)}for(var t=0;t<inOutKeys.length;t++){inouts[t]=new Object();inouts[t].uri=copyList[inOutKeys[t]].ref.getURI();inouts[t].friend_code="";inouts[t].value=copyList[inOutKeys[t]].ref.getValue();inouts[t].name=copyList[inOutKeys[t]].ref.getName();inouts[t].ins=[];for(var v=0;v<copyList[inOutKeys[t]].ref.inputList.length;v++){var nextIn=copyList[inOutKeys[t]].ref.inputList[v];inouts[t].ins[v]=new Object();inouts[t].ins[v].name=nextIn.getName();inouts[t].ins[v].uri=nextIn.getURI();inouts[t].ins[v].igadget=nextIn.getId()}inouts[t].outs=[];for(var v=0;v<copyList[inOutKeys[t]].ref.outputList.length;v++){var nextOut=copyList[inOutKeys[t]].ref.outputList[v];inouts[t].outs[v]=new Object();inouts[t].outs[v].name=nextOut.getName();inouts[t].outs[v].uri=nextOut.getURI();inouts[t].outs[v].igadget=nextOut.getId()}}var json=new Object();json.iGadgetList=gadgets;json.inOutList=inouts;var param={json:Object.toJSON(json)};PersistenceEngineFactory.getInstance().send_post(URIs.GET_POST_WIRING,param,this,this.serializationSuccess,this.serializationError)}}return new function(){this.getInstance=function(){if(instance==null){instance=new Wiring()}return instance}}}();function UserPref(D,C,A,B){this.varName=null;this.label=null;this.desc=null;this.defaultValue=null}UserPref.prototype.UserPref=function(D,C,A,B){this.varName=D;this.label=C;this.desc=A;if((B==null)||(B==undefined)){this.defaultValue=""}else{this.defaultValue=B}};UserPref.prototype.getVarName=function(){return this.varName};UserPref.prototype.validate=function(A){return true};UserPref.prototype.getCurrentValue=function(A){return VarManagerFactory.getInstance().getVariable(A,this.varName)};UserPref.prototype.setValue=function(B,C){if(this.validate(C)){var A=VarManagerFactory.getInstance();A.updateUserPref(B,this.varName,C)}};UserPref.prototype.setToDefault=function(B){var A=VarManagerFactory.getInstance();A.updateUserPref(B,this.varName,this.defaultValue)};UserPref.prototype.getValueFromInterface=function(A){return A.value};UserPref.prototype.setDefaultValueInInterface=function(A){A.value=this.defaultValue};UserPref.prototype.TEXT="S";UserPref.prototype.INTEGER="N";UserPref.prototype.DATE="D";UserPref.prototype.LIST="L";UserPref.prototype.BOOLEAN="B";function ListUserPref(B,D,A,C,E){UserPref.prototype.UserPref.call(this,B,D,A,C);this.options=E;this.optionHash=null}ListUserPref.prototype=new UserPref();ListUserPref.prototype.makeInterface=function(F){var D,A;D=document.createElement("label");D.setAttribute("title",this.desc);D.appendChild(document.createTextNode(this.label));A=document.createElement("select");A.setAttribute("name",this.varName);D.appendChild(A);var E=this.getCurrentValue(F);var B="";for(var C=0;C<this.options.length;C++){B+='<option value="'+this.options[C][0]+'"';if(E==this.options[C][0]){B+=' selected="selected"'}B+=">"+this.options[C][1]+"</option>"}A.innerHTML=B;return D};ListUserPref.prototype.validate=function(B){if(this.optionHash==null){this.optionHash=new Hash();for(var A=0;A<this.options.length;A++){this.optionHash[this.options[A][0]]=true}}return this.optionHash[B]!=undefined};function IntUserPref(B,D,A,C){UserPref.prototype.UserPref.call(this,B,D,A,C)}IntUserPref.prototype=new UserPref();IntUserPref.prototype.makeInterface=function(D){var B;B=document.createElement("label");B.setAttribute("title",this.desc);var A=this.label;A+='<input name="'+this.varName+'" type="text" ';var C=this.getCurrentValue(D);if(C!=null){A+='value="'+C+'" '}A+="/>";B.innerHTML=A;return B};IntUserPref.prototype.validate=function(A){return !isNaN(Number(A))};function TextUserPref(B,D,A,C){UserPref.prototype.UserPref.call(this,B,D,A,C)}TextUserPref.prototype=new UserPref();TextUserPref.prototype.makeInterface=function(D){var B;B=document.createElement("label");B.setAttribute("title",this.desc);var A=this.label;A+='<input name="'+this.varName+'" type="text" ';var C=this.getCurrentValue(D);if(C!=null){A+='value="'+C+'" '}A+="/>";B.innerHTML=A;return B};function DateUserPref(B,D,A,C){UserPref.prototype.UserPref.call(this,B,D,A,C)}DateUserPref.prototype=new UserPref();DateUserPref.prototype.makeInterface=function(C){var A="";A+='<label title="'+this.desc+'">'+this.label;A+='<input name="'+this.varName+'" type="text" ';var B=this.getCurrentValue(C);if(B!=null){A+='value="'+B+'" '}A+="/></label>";return A};function BoolUserPref(B,D,A,C){UserPref.prototype.UserPref.call(this,B,D,A,C)}BoolUserPref.prototype=new UserPref();BoolUserPref.prototype.makeInterface=function(D){var B;B=document.createElement("label");B.setAttribute("title",this.desc);var A=this.label;A+='<input name="'+this.varName+'" type="checkbox" ';var C=this.getCurrentValue(D);if(C.strip().toLowerCase()=="true"){A+='checked="true" '}A+="/>";B.innerHTML=A;return B};BoolUserPref.prototype.getValueFromInterface=function(A){return A.checked?"true":"false"};var DragboardFactory=function(){var instance=null;function Dragboard(){var loaded=false;var currentId=1;var matrix=null;var shadowMatrix=null;shadowPositions=null;var dragboard,dragboardStyle;var dragboardCursor=null;var gadgetToMove=null;var iGadgets=new Hash();function _repaint(receivedData){var iGadget,position,iGadgetsToReinsert=new Array();iGadgets.each(function(pair){iGadget=pair.value;iGadget.destroy()});dragboard.innerHTML="";_clearMatrix();iGadgets.each(function(pair){iGadget=pair.value;position=iGadget.getPosition();if(_hasSpaceFor(matrix,position.x,position.y-1,iGadget.getContentWidth(),iGadget.getHeight()+2)){iGadget.paint(dragboard);_reserveSpace(matrix,iGadget)}else{iGadgetsToReinsert.push(iGadget)}});for(i=0;i<iGadgetsToReinsert.length;i++){position=_searchFreeSpace(iGadgetsToReinsert[i].getContentWidth(),iGadgetsToReinsert[i].getHeight());iGadgetsToReinsert[i].setPosition(position);iGadgetsToReinsert[i].paint(dragboard);_reserveSpace(matrix,iGadgetsToReinsert[i])}iGadgets.each(function(pair){iGadget=pair.value;_moveSpaceUp(matrix,iGadget)})}function _load(receivedData){var curIGadget,position,width,height,igadget,gadget,gadgetid,minimized;var iGadgetsJson=eval("("+receivedData.responseText+")");iGadgetsJson=iGadgetsJson.iGadgets;var opManager=OpManagerFactory.getInstance();currentId=1;iGadgets=new Hash();this.igadgetsToLoad=iGadgetsJson.length;for(var i=0;i<iGadgetsJson.length;i++){curIGadget=iGadgetsJson[i];position=new DragboardPosition(parseInt(curIGadget.left),parseInt(curIGadget.top));width=parseInt(curIGadget.width);height=parseInt(curIGadget.height);gadgetid=curIGadget.gadget.split("/");gadgetid=gadgetid[4]+"_"+gadgetid[5]+"_"+gadgetid[6];gadget=ShowcaseFactory.getInstance().getGadget(gadgetid);curIGadget.id=curIGadget.uri.split("/");curIGadget.id=parseInt(curIGadget.id[curIGadget.id.length-1]);minimized=curIGadget.minimized=="true"?true:false;igadget=new IGadget(gadget,curIGadget.id,dragboardStyle,position,width,height,minimized);iGadgets[curIGadget.id]=igadget;if(curIGadget.id>=currentId){currentId=curIGadget.id+1}}loaded=true;OpManagerFactory.getInstance().continueLoading(Modules.prototype.DRAGBOARD)}function onError(transport,e){var msg;if(e){msg=interpolate(gettext("JavaScript exception on file %(errorFile)s (line: %(errorLine)s): %(errorDesc)s"),{errorFile:e.fileName,errorLine:e.lineNumber,errorDesc:e},true)}else{if(transport.responseXML){msg=transport.responseXML.documentElement.textContent}else{msg="HTTP Error "+transport.status+" - "+transport.statusText}}msg=interpolate(gettext("Error retreiving dragboard data from persistence: %(errorMsg)s."),{errorMsg:msg},true);OpManagerFactory.getInstance().log(msg);alert(gettext("Error retreiving dragboard data from persistence, please check the logs for further info."))}function _getPositionOn(_matrix,gadget){if(_matrix==matrix){return gadget.getPosition()}else{return shadowPositions[gadget.getId()]}}function _setPositionOn(_matrix,gadget,position){if(_matrix==matrix){gadget.setPosition(position)}else{shadowPositions[gadget.getId()]=position}}function _destroyCursor(clearSpace){if(dragboardCursor!=null){dragboardCursor.destroy();if(clearSpace){_removeFromMatrix(matrix,dragboardCursor)}dragboardCursor=null}}function _clearMatrix(){matrix=new Array();for(var x=0;x<dragboardStyle.getColumns();x++){matrix[x]=new Array()}}function _hasSpaceFor(_matrix,positionX,positionY,width,height){var x,y;for(x=0;x<width;x++){for(y=0;y<height;y++){if(_matrix[positionX+x][positionY+y]!=null){return false}}}return true}function _reserveSpace(_matrix,iGadget){var x,y;var position=_getPositionOn(_matrix,iGadget);var width=iGadget.getContentWidth();var height=iGadget.getHeight();for(x=0;x<width;x++){for(y=0;y<height;y++){_matrix[position.x+x][position.y+y]=iGadget}}}function _clearSpace(_matrix,iGadget){var x,y;var position=_getPositionOn(_matrix,iGadget);var width=iGadget.getContentWidth();var height=iGadget.getHeight();for(x=0;x<width;x++){for(y=0;y<height;y++){delete _matrix[position.x+x][position.y+y]}}}function _searchInsertPoint(_matrix,x,y,width,height){if(_matrix[x][y]!=null){y=_getPositionOn(_matrix,_matrix[x][y]).y-1}if((y==0)||(_matrix[x][y-1]!=null)){y++}else{var originalY=y;var lastY;var found=false;while((y>0)&&(_hasSpaceFor(_matrix,x,y-1,width,1))){found=true;lastY=y;y--}if(found){y=lastY}else{var curGadget;var offsetX;lastY=0;for(offsetX=1;offsetX<width;offsetX++){curGadget=_matrix[x+offsetX][originalY];if((curGadget!=null)){y=_getPositionOn(_matrix,curGadget).y;if(y>lastY){lastY=y}}}if(lastY>0){y=lastY}else{y=originalY+1}}}return y}function _moveSpaceDown(_matrix,iGadget,offsetY){var affectedIGadgets=new Hash();var position=_getPositionOn(_matrix,iGadget);var finalPosition=position.clone();finalPosition.y+=offsetY;var edgeY=position.y+iGadget.getHeight()+1;var igadget,x,y;for(x=0;x<iGadget.getContentWidth();x++){for(y=0;y<offsetY;y++){igadget=_matrix[position.x+x][edgeY+y];if(igadget!=null){affectedIGadgets[igadget.getId()]=offsetY-y;break}}}var keys=affectedIGadgets.keys();var igadget,i,key;for(i=0;i<keys.length;i++){key=keys[i];igadget=iGadgets[key];_moveSpaceDown(_matrix,igadget,affectedIGadgets[key])}_clearSpace(_matrix,iGadget);_setPositionOn(_matrix,iGadget,finalPosition);_reserveSpace(_matrix,iGadget)}function _moveSpaceUp(_matrix,iGadget){var position=_getPositionOn(_matrix,iGadget);var edgeY=position.y+iGadget.getHeight()+1;var offsetY;for(offsetY=1;((position.y-offsetY)>=0)&&_hasSpaceFor(_matrix,position.x,position.y-offsetY,iGadget.getContentWidth(),1);offsetY++){}if(offsetY>1){var affectedIGadgets=new Hash();var finalPosition=position.clone();finalPosition.y-=(offsetY-2);var igadget,x,y,columnsize;for(x=0;x<iGadget.getContentWidth();x++){columnsize=_matrix[position.x+x].length;for(y=edgeY;y<columnsize;y++){igadget=_matrix[position.x+x][y];if(igadget!=null){affectedIGadgets[igadget.getId()]=igadget;break}}}_clearSpace(_matrix,iGadget);_setPositionOn(_matrix,iGadget,finalPosition);_reserveSpace(_matrix,iGadget);var keys=affectedIGadgets.keys();var i;for(i=0;i<keys.length;i++){_moveSpaceUp(_matrix,affectedIGadgets[keys[i]])}}}function _removeFromMatrix(_matrix,iGadget){_clearSpace(_matrix,iGadget);var affectedIGadgets=new Hash();var affectedgadget,x,y,columnsize;var position=_getPositionOn(_matrix,iGadget);var edgeY=position.y+iGadget.getHeight()+1;for(x=0;x<iGadget.getContentWidth();x++){columnsize=_matrix[position.x+x].length;for(y=edgeY;y<columnsize;y++){affectedgadget=_matrix[position.x+x][y];if((affectedgadget!=null)&&(affectedIGadgets[affectedgadget.getId()]==undefined)){affectedIGadgets[affectedgadget.getId()]=1;_moveSpaceUp(_matrix,affectedgadget);break}}}}function _reserveSpace2(_matrix,iGadget,positionX,positionY,width,height){var x,y;for(x=0;x<width;x++){for(y=0;y<height;y++){_matrix[positionX+x][positionY+y]=iGadget}}}function _clearSpace2(_matrix,positionX,positionY,width,height){var x,y;for(x=0;x<width;x++){for(y=0;y<height;y++){delete _matrix[positionX+x][positionY+y]}}}function _resize(iGadget,oldWidth,oldHeight,newWidth,newHeight){var x,y,step2Width=oldWidth;var position=iGadget.getPosition();if(newWidth>oldWidth){}else{if(newWidth<oldWidth){_clearSpace2(matrix,position.x+newWidth,position.y,oldWidth-newWidth,oldHeight);step2Width=newWidth}}if(newHeight>oldHeight){var limitY=position.y+newHeight+1;var limitX=position.x+step2Width;for(y=position.y+oldHeight+1;y<limitY;y++){for(x=position.x;x<limitX;x++){if(matrix[x][y]!=null){_moveSpaceDown(matrix,matrix[x][y],limitY-y)}}}_reserveSpace2(matrix,iGadget,position.x,position.y+oldHeight,step2Width,newHeight-oldHeight)}else{if(newHeight<oldHeight){_clearSpace2(matrix,position.x,position.y+newHeight,step2Width,oldHeight-newHeight);y=position.y+oldHeight+1;var limitX=position.x+step2Width;for(x=position.x;x<limitX;x++){if(matrix[x][y]!=null){_moveSpaceUp(matrix,matrix[x][y])}}}}}function _insertAt(iGadget,x,y){var newPosition=new DragboardPosition(x,y);var affectedIGadgets=new Hash();var affectedgadget,x,offset,affectedY;for(x=0;x<iGadget.getContentWidth();x++){for(y=0;y<iGadget.getHeight();y++){affectedgadget=matrix[newPosition.x+x][newPosition.y+y];if((affectedgadget!=null)&&(affectedIGadgets[affectedgadget.getId()]==undefined)){affectedIGadgets[affectedgadget.getId()]=null;offset=iGadget.getHeight()+1-y;y=newPosition.y+y;affectedY=affectedgadget.getPosition().y;if(affectedY<y){offset+=y-affectedY}_moveSpaceDown(matrix,affectedgadget,offset);break}}}iGadget.setPosition(newPosition);_reserveSpace(matrix,iGadget)}function _searchFreeSpace(width,height){var positionX=0,positionY=0;var columns=dragboardStyle.getColumns()-width+1;height+=2;for(positionY=0;true;positionY++){for(positionX=0;positionX<columns;positionX++){if(_hasSpaceFor(matrix,positionX,positionY,width,height)){return new DragboardPosition(positionX,positionY+1)}}}}function _commitChanges(){function onSuccess(){}function onError(transport,e){var msg;if(transport.responseXML){msg=transport.responseXML.documentElement.textContent}else{msg="HTTP Error "+transport.status+" - "+transport.statusText}msg=interpolate(gettext("Error commiting dragboard changes to persistence: %(errorMsg)s."),{errorMsg:msg},true);OpManagerFactory.getInstance().log(msg);alert(gettext("Error commiting dragboard changes to persistence, please check the logs for further info."))}var iGadgetInfo,uri,position;var data=new Hash();data.iGadgets=new Array();iGadgets.each(function(pair){iGadget=pair.value;iGadgetInfo=new Hash();uri=URIs.GET_IGADGET.evaluate({id:iGadget.getId()});iGadgetInfo.uri=uri;position=iGadget.getPosition();iGadgetInfo.top=position.y;iGadgetInfo.left=position.x;data.iGadgets.push(iGadgetInfo);iGadgetInfo.minimized=iGadget.isMinimized()?"true":"false"});data={igadgets:data.toJSON()};persistenceEngine.send_update(URIs.GET_IGADGETS,data,this,onSuccess,onError)}Dragboard.prototype.addInstance=function(gadget){if((gadget==null)||!(gadget instanceof Gadget)){return }var template=gadget.getTemplate();var width=template.getWidth();var height=template.getHeight();var position=_searchFreeSpace(width,height+2);var iGadget=new IGadget(gadget,currentId,dragboardStyle,position,width,height,false);iGadget.save();iGadgets[currentId]=iGadget;currentId++;_reserveSpace(matrix,iGadget);return iGadget.getId()};Dragboard.prototype.removeInstance=function(iGadgetId){var igadget=iGadgets[iGadgetId];iGadgets.remove(iGadgetId);var position=igadget.getPosition();_removeFromMatrix(matrix,igadget);igadget.destroy()};Dragboard.prototype.move=function(iGadgetId){};Dragboard.prototype.igadgetLoaded=function(iGadgetId){this.igadgetsToLoad--;if(this.igadgetsToLoad==0){VarManagerFactory.getInstance().planInterfaceInitialization()}};Dragboard.prototype.maximize=function(iGadgetId){var igadget=iGadgets[iGadgetId];var oldWidth=igadget.getContentWidth();var oldHeight=igadget.getHeight();igadget.setMinimizeStatus(false);var newHeight=igadget.getHeight();if(oldHeight!=newHeight){_resize(igadget,oldWidth,oldHeight,oldWidth,newHeight);_commitChanges()}};Dragboard.prototype.minimize=function(iGadgetId){var igadget=iGadgets[iGadgetId];var oldWidth=igadget.getContentWidth();var oldHeight=igadget.getHeight();igadget.setMinimizeStatus(true);var newHeight=igadget.getHeight();if(oldHeight!=newHeight){_resize(igadget,oldWidth,oldHeight,oldWidth,newHeight);_commitChanges()}};Dragboard.prototype.toggleMinimizeStatus=function(iGadgetId){var igadget=iGadgets[iGadgetId];if(igadget.isMinimized()){this.maximize(igadget.getId())}else{this.minimize(igadget.getId())}};Dragboard.prototype.setConfigurationVisible=function(iGadgetId,newStatus){var igadget=iGadgets[iGadgetId];if(newStatus=="toggle"){var oldWidth=igadget.getContentWidth();var oldHeight=igadget.getHeight();igadget.setConfigurationVisible(!igadget.isConfigurationVisible());_resize(igadget,oldWidth,oldHeight,oldWidth,igadget.getHeight())}else{var oldWidth=igadget.getContentWidth();var oldHeight=igadget.getHeight();igadget.setConfigurationVisible(newStatus);_resize(igadget,oldWidth,oldHeight,oldWidth,igadget.getHeight())}};Dragboard.prototype.saveConfig=function(iGadgetId){var igadget=iGadgets[iGadgetId];try{igadget.saveConfig();this.setConfigurationVisible(igadget.getId(),false)}catch(e){}};Dragboard.prototype.setDefaultPrefs=function(iGadgetId){var igadget=iGadgets[iGadgetId];igadget.setDefaultPrefs()};Dragboard.prototype.repaint=function(iGadgetId){if(loaded){_repaint()}};Dragboard.prototype.getCellAt=function(x,y){var dragboardWidth=dragboardStyle.getWidth();if((x<0)||(x>dragboardWidth)||(y<0)){return null}var columnWidth=dragboardWidth/dragboardStyle.getColumns();return new DragboardPosition(Math.floor(x/columnWidth),Math.floor(y/dragboardStyle.getCellHeight()))};Dragboard.prototype.showInstance=function(iGadgetId){var igadget=iGadgets[iGadgetId];igadget.paint(dragboard,dragboardStyle)};Dragboard.prototype.initializeMove=function(iGadgetId){if(gadgetToMove!=null){OpManagerFactory.getInstance().log(gettext("There was a pending move that was cancelled because initializedMove function was called before it was finished."),Constants.WARN_MSG);this.cancelMove()}gadgetToMove=iGadgets[iGadgetId];if(dragboardCursor==null){shadowPositions=new Array();iGadgets.each(function(pair){shadowPositions[pair.key]=pair.value.getPosition().clone()});var i;shadowMatrix=new Array();for(i=0;i<dragboardStyle.getColumns();i++){shadowMatrix[i]=matrix[i].clone()}_removeFromMatrix(shadowMatrix,gadgetToMove);dragboardCursor=new DragboardCursor(gadgetToMove);dragboardCursor.paint(dragboard,dragboardStyle);_reserveSpace(matrix,dragboardCursor)}};Dragboard.prototype.moveTemporally=function(x,y){if(dragboardCursor==null){OpManagerFactory.getInstance().log(gettext("Dragboard: You must call initializeMove function before calling to this function (moveTemporally)."),Constants.WARN_MSG);return }var maxX=dragboardStyle.getColumns()-dragboardCursor.getContentWidth();if(x>maxX){x=maxX}y=_searchInsertPoint(shadowMatrix,x,y,dragboardCursor.getContentWidth(),dragboardCursor.getHeight());var cursorpos=dragboardCursor.getPosition();if((cursorpos.y!=y)||(cursorpos.x!=x)){_removeFromMatrix(matrix,dragboardCursor);_insertAt(dragboardCursor,x,y)}};Dragboard.prototype.cancelMove=function(){if(gadgetToMove==null){OpManagerFactory.getInstance().log(gettext("Dragboard: Trying to cancel an inexistant temporal move."),Constants.WARN_MSG);return }_destroyCursor(true);var position=gadgetToMove.getPosition();_insertAt(gadgetToMove,position.x,position.y);gadgetToMove=null;shadowMatrix=null};Dragboard.prototype.acceptMove=function(){if(gadgetToMove==null){throw new Exception(gettext("Dragboard: function acceptMove called when there is not any igadget's move started."))}var oldposition=gadgetToMove.getPosition();var newposition=dragboardCursor.getPosition();_destroyCursor(false);gadgetToMove.setPosition(newposition);_reserveSpace(matrix,gadgetToMove);gadgetToMove=null;shadowMatrix=null;if(oldposition.y!=newposition.y||oldposition.x!=newposition.x){_commitChanges()}};Dragboard.prototype.getGadget=function(iGadgetId){var igadget=iGadgets[iGadgetId];return igadget.getGadget()};dragboard=$("dragboard");dragboardStyle=new DragboardStyle(dragboard,3,15);_clearMatrix();var persistenceEngine=PersistenceEngineFactory.getInstance();persistenceEngine.send_get(URIs.GET_IGADGETS,this,_load,onError)}return new function(){this.getInstance=function(){if(instance==null){instance=new Dragboard()}return instance}}}();function IGadget(G,F,D,B,E,A,C){this.id=F;this.gadget=G;this.screen=D;this.position=B;this.width=E;this.contentHeight=A;this.height=2;if(!C){this.height+=A}this.configurationVisible=false;this.minimized=C;this.element=null;this.contentWrapper=null,this.content=null;this.configurationElement=null}IGadget.prototype.getGadget=function(){return this.gadget};IGadget.prototype.setPosition=function(A){this.position=A;if(this.element!=null){this.element.style.left=this.screen.getColumnOffsetLeft(A.x);this.element.style.top=this.screen.fromVCellsToPixels(A.y)+"px"}};IGadget.prototype.getPosition=function(){return this.position};IGadget.prototype.setContentWidth=function(A){this.width=A};IGadget.prototype.getContentWidth=function(){return this.width};IGadget.prototype.setContentHeight=function(A){this.contentHeight=A};IGadget.prototype.getContentHeight=function(){return this.contentHeight};IGadget.prototype.getHeight=function(){if(this.height==null){if(this.element!=null){if(!this.minimized){var A=this.content.offsetHeight+this.configurationElement.offsetHeight;this.contentWrapper.setStyle({height:A+"px"})}else{this.contentWrapper.setStyle({height:0+"px"})}this.height=this.screen.fromPixelsToVCells(this.element.offsetHeight)}else{this.height=0}}return this.height};IGadget.prototype.getId=function(){return this.id};IGadget.prototype.getElement=function(){return this.element};IGadget.prototype.isVisible=function(){return this.element!=null};IGadget.prototype.paint=function(E){if(this.element!=null){return }var B,H;B=document.createElement("div");B.setAttribute("id","gadget_"+this.id+"_container");B.setAttribute("class","gadget_window");H=document.createElement("div");H.setAttribute("class","gadget_menu");H.innerHTML='<div class="floatright button" onclick="javascript:OpManagerFactory.getInstance().removeInstance('+this.id+')" >X</div><div class="floatright button" onclick="javascript:DragboardFactory.getInstance().setConfigurationVisible('+this.id+', \'toggle\');" >P</div><div class="floatright button" onclick="javascript:DragboardFactory.getInstance().toggleMinimizeStatus('+this.id+')" >-</div>'+this.gadget.getName()+" (Gadget "+this.id+")";B.appendChild(H);this.contentWrapper=document.createElement("div");this.contentWrapper.setAttribute("class","gadget_wrapper");B.appendChild(this.contentWrapper);this.configurationElement=document.createElement("form");this.configurationElement.setAttribute("class","config_interface");this.configurationElement.setAttribute("onsubmit","javascript:return false;");this.contentWrapper.appendChild(this.configurationElement);this.content=document.createElement("object");this.content.setAttribute("id","gadget_"+this.id);this.content.setAttribute("class","gadget_object");this.content.setAttribute("type","text/html");if(this.gadget!=null){this.content.setAttribute("data",this.gadget.getXHtml().getURICode()+"?id="+this.id)}this.content.setAttribute("standby","Loading...");this.content.innerHTML='<param name="IGadgetId" value="'+this.id+'" />Loading....';this.contentWrapper.appendChild(this.content);B.style.left=this.screen.getColumnOffsetLeft(this.position.x);B.style.top=this.screen.fromVCellsToPixels(this.position.y)+"px";B.style.width=this.screen.fromHCellsToPercentage(this.width)+"%";var G=this.screen.fromVCellsToPixels(this.contentHeight)+"px";this.content.style.height=G;if(this.minimized){this.contentWrapper.style.height="0px";this.contentWrapper.style.borderTop="0px";this.contentWrapper.style.visibility="hidden"}else{this.contentWrapper.style.height=G}B.iGadgetId=this.id;this.content.iGadgetId=this.id;this.contentWrapper.iGadgetId=this.id;var F=this.screen;var D=function(I,J){DragboardFactory.getInstance().initializeMove(J);I.setXOffset(F.fromHCellsToPixels(1)/2);I.setYOffset(F.getCellHeight())};var C=function(K,L,J,M){var I=DragboardFactory.getInstance().getCellAt(J,M);if(I!=null){DragboardFactory.getInstance().moveTemporally(I.x,I.y)}};var A=function(I,J){DragboardFactory.getInstance().acceptMove(J)};new Draggable(B,H,this.id,D,C,A);E.appendChild(B);this.element=B;return this.element};IGadget.prototype.destroy=function(){if(this.element!=null){function C(){}function B(F,D){var E;if(F.responseXML){E=F.responseXML.documentElement.textContent}else{E="HTTP Error "+F.status+" - "+F.statusText}E=interpolate(gettext("Error removing igadget from persistence: %(errorMsg)s."),{errorMsg:E},true);OpManagerFactory.getInstance().log(E)}this.element.parentNode.removeChild(this.element);this.element=null;var A=PersistenceEngineFactory.getInstance();A.send_delete(URIs.GET_IGADGET.evaluate({id:this.id}),this,C,B)}};IGadget.prototype._setDefaultPrefsInInterface=function(){var A=this.gadget.getTemplate().getUserPrefs();var C;for(var B=0;B<A.length;B++){C=A[B];C.setDefaultValueInInterface(this.configurationElement[C.getVarName()])}};IGadget.prototype.setDefaultPrefs=function(){var A=this.gadget.getTemplate().getUserPrefs();for(var B=0;B<A.length;B++){A[B].setToDefault(this.id)}if(this.configurationVisible){this._setDefaultPrefsInInterface()}};IGadget.prototype._makeConfigureInterface=function(){var A=this.gadget.getTemplate().getUserPrefs();var E=document.createElement("div");if(A.length==0){E.innerHTML=gettext("This IGadget don't have user prefs");return E}this.prefElements=new Array();for(var C=0;C<A.length;C++){curPrefInterface=A[C].makeInterface(this.id);this.prefElements[C]=curPrefInterface;E.appendChild(curPrefInterface)}var D=document.createElement("div");D.setAttribute("class","buttons");var B;B=document.createElement("input");B.setAttribute("type","button");B.setAttribute("value",gettext("Set Defaults"));B.addEventListener("click",this._setDefaultPrefsInInterface.bind(this),true);D.appendChild(B);B=document.createElement("input");B.setAttribute("type","button");B.setAttribute("value",gettext("Save"));B.addEventListener("click",function(){DragboardFactory.getInstance().saveConfig(this.id)}.bind(this),true);D.appendChild(B);B=document.createElement("input");B.setAttribute("type","button");B.setAttribute("value",gettext("Cancel"));B.addEventListener("click",function(){DragboardFactory.getInstance().setConfigurationVisible(this.id,false)}.bind(this),true);D.appendChild(B);E.appendChild(D);return E};IGadget.prototype.isMinimized=function(){return this.minimized};IGadget.prototype.setMinimizeStatus=function(A){if(this.minimized==A){return }this.minimized=A;if(this.minimized){this.contentWrapper.setStyle({visibility:"hidden",border:"0px"})}else{this.contentWrapper.setStyle({visibility:"visible",border:""})}this.height=null};IGadget.prototype.isConfigurationVisible=function(){return this.configurationVisible};IGadget.prototype.setConfigurationVisible=function(A){if(this.configurationVisible==A){return }if(A==true){this.configurationVisible=true;this.configurationElement.appendChild(this._makeConfigureInterface());this.configurationElement.setStyle({display:"block"});this.height=null}else{this.configurationElement.innerHTML="";this.configurationElement.hide();this.configurationVisible=false;this.height=null}};IGadget.prototype.saveConfig=function(){if(this.configurationVisible==false){throw new Error("")}var C,G,E,D=true;var B=this.gadget.getTemplate().getUserPrefs();for(C=0;C<B.length;C++){G=B[C];E=this.configurationElement[G.getVarName()];if(!G.validate(G.getValueFromInterface(E))){D=false;this.prefElements[C].addClassName("invalid")}else{this.prefElements[C].removeClassName("invalid")}}if(!D){throw new Error("Invalid data found")}var A,F;for(C=0;C<B.length;C++){G=B[C];E=this.configurationElement[G.getVarName()];var A=G.getCurrentValue(this.id);var F=G.getValueFromInterface(E);if(F!=A){G.setValue(this.id,F)}}VarManagerFactory.getInstance().commitModifiedVariables()};IGadget.prototype.save=function(){function E(){}function C(H,F){var G;if(H.responseXML){G=H.responseXML.documentElement.textContent}else{G="HTTP Error "+H.status+" - "+H.statusText}G=interpolate(gettext("Error adding igadget to persistence: %(errorMsg)s."),{errorMsg:G},true);OpManagerFactory.getInstance().log(G);alert(gettext("Error adding igadget to persistence, please check the logs for further info."))}var A=PersistenceEngineFactory.getInstance();var D=new Hash();D.left=this.position.x;D.top=this.position.y;D.width=this.width;D.height=this.contentHeight;var B=URIs.GET_IGADGET.evaluate({id:this.id});D.uri=B;D.gadget=URIs.GET_GADGET.evaluate({vendor:this.gadget.getVendor(),name:this.gadget.getName(),version:this.gadget.getVersion()});D={igadget:D.toJSON()};A.send_post(B,D,this,E,C)};function DragboardPosition(A,B){this.x=A;this.y=B}DragboardPosition.prototype.clone=function(){return new DragboardPosition(this.x,this.y)};function DragboardStyle(B,D,A){this.columns=D;this.cellHeight=A;this.dragboardElement=B;this.dragboardWidth=parseInt(B.offsetWidth);var C=this;var E=function(F){C.dragboardWidth=parseInt(B.offsetWidth)};window.addEventListener("resize",E,true)}DragboardStyle.prototype.getWidth=function(){return this.dragboardWidth};DragboardStyle.prototype.getColumns=function(){return this.columns};DragboardStyle.prototype.getCellHeight=function(){return this.cellHeight};DragboardStyle.prototype.fromPixelsToVCells=function(A){return Math.ceil(A/this.cellHeight)};DragboardStyle.prototype.fromVCellsToPixels=function(A){return(A*this.cellHeight)};DragboardStyle.prototype.fromHCellsToPixels=function(A){var B=A*0.3;if(A>1){B+=((A-1)*0.02)}return(this.dragboardElement.offsetWidth*B)};DragboardStyle.prototype.fromHCellsToPercentage=function(A){var B=A*30;if(A>1){B+=(A-1)*2}return B};DragboardStyle.prototype.getColumnOffsetLeftInPixels=function(B){var A=3+(B*32);return((this.dragboardElement.offsetWidth*A)/100)};DragboardStyle.prototype.getColumnOffsetLeft=function(A){return(3+(A*32))+"%"};function DragboardCursor(B,A){var C=B.getPosition();this.position=C.clone();this.screen=B.screen;this.width=B.getContentWidth();this.height=B.getHeight();this.heightInPixels=B.element.offsetHeight}DragboardCursor.prototype=new IGadget();DragboardCursor.prototype.getContentWidth=function(){return this.width};DragboardCursor.prototype.getHeight=function(){return this.height};DragboardCursor.prototype.paint=function(A,B){var C=document.createElement("div");C.setAttribute("id","dragboardcursor");C.style.height=this.heightInPixels+"px";C.style.width=B.fromHCellsToPixels(this.width)+"px";C.style.left=(B.getColumnOffsetLeftInPixels(this.position.x)-2)+"px";C.style.top=(B.fromVCellsToPixels(this.position.y)-2)+"px";A.appendChild(C);this.element=C};DragboardCursor.prototype.destroy=function(){if(this.element!=null){Droppables.remove(this.element);this.element.parentNode.removeChild(this.element);this.element=null}};function Draggable(N,C,V,Q,L,S){var T=0,B=0;var F=0,G=0;var U=0,H=0;var J,I;var A;var D=this;function K(X){if(X.button!=0){return false}document.removeEventListener("mouseup",K,false);document.removeEventListener("mousemove",O,false);for(var W=0;W<A.length;W++){A[W].contentDocument.onmouseup=null;A[W].contentDocument.onmousemove=null}S(D,V);N.style.zIndex="";C.addEventListener("mousedown",P,false);document.onmousedown=null;document.oncontextmenu=null;return false}function O(W){T=F-parseInt(W.screenX);B=G-parseInt(W.screenY);F=parseInt(W.screenX);G=parseInt(W.screenY);I=I-B;J=J-T;N.style.top=I+"px";N.style.left=J+"px";L(D,V,J+U,I+H)}function P(X){if(X.button!=0){return false}document.oncontextmenu=function(){return false};document.onmousedown=function(){return false};C.removeEventListener("mousedown",P,false);F=parseInt(X.screenX);G=parseInt(X.screenY);I=N.offsetTop;J=N.offsetLeft;N.style.top=I+"px";N.style.left=J+"px";document.addEventListener("mouseup",K,false);document.addEventListener("mousemove",O,false);A=document.getElementsByTagName("object");for(var W=0;W<A.length;W++){A[W].contentDocument.onmouseup=K;A[W].contentDocument.onmousemove=O}N.style.zIndex="200";Q(D,V);return false}function R(W){if(W.stopPropagation){W.stopPropagation()}}C.addEventListener("mousedown",P,false);var E=C.childElements();for(var M=0;M<E.length;M++){E[M].addEventListener("mousedown",R,false)}this.setXOffset=function(W){U=W};this.setYOffset=function(W){H=W}}var OpManagerFactory=function(){var A=null;function B(){this.persistenceEngine=PersistenceEngineFactory.getInstance();this.varManagerModule=null;this.wiringModule=null;this.dragboardModule=null;this.showcaseModule=null;this.contextManagerModule=null;this.catalogue=null;this.loadCompleted=false;B.prototype.addInstance=function(C){if(!this.loadCompleted){return }var E=this.showcaseModule.getGadget(C);var D=this.dragboardModule.addInstance(E);this.varManagerModule.addInstance(D,E.getTemplate());this.wiringModule.addInstance(D,E.getTemplate());this.contextManagerModule.addInstance(D,E);this.dragboardModule.showInstance(D);show_dragboard()};B.prototype.removeInstance=function(C){if(!this.loadCompleted){return }this.dragboardModule.removeInstance(C);this.varManagerModule.removeInstance(C);this.wiringModule.removeInstance(C)};B.prototype.sendEvent=function(E,C,D){this.wiringModule.sendEvent(E,C,D)};B.prototype.restaure=function(){this.wiringModule.restaure()};B.prototype.loadEnviroment=function(){this.varManagerModule=VarManagerFactory.getInstance()};B.prototype.repaintCatalogue=function(C){this.catalogue.emptyResourceList();this.catalogue.loadCatalogue(C)};B.prototype.igadgetLoaded=function(){this.dragboardModule.igadgetLoaded()};B.prototype.continueLoading=function(C){if(C==Modules.prototype.VAR_MANAGER){this.showcaseModule=ShowcaseFactory.getInstance();return }if(C==Modules.prototype.SHOWCASE){this.dragboardModule=DragboardFactory.getInstance();return }if(C==Modules.prototype.DRAGBOARD){this.wiringModule=WiringFactory.getInstance();return }if(C==Modules.prototype.WIRING){this.contextManagerModule=ContextManagerFactory.getInstance();return }if(C==Modules.prototype.CONTEXT_MANAGER){this.catalogue=CatalogueFactory.getInstance();this.catalogue.loadCatalogue(URIs.GET_POST_RESOURCES);this.loadCompleted=true;environmentLoadedCallback();return }};B.prototype.log=function(C,D){switch(D){default:case Constants.Logging.ERROR_MSG:if(console){console.error(C)}break;case Constants.Logging.WARN_MSG:if(console){console.warn(C)}break;case Constants.Logging.INFO_MSG:if(console){console.info(C)}break}}}return new function(){this.getInstance=function(){if(A==null){A=new B()}return A}}}();